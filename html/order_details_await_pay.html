<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style type="text/css">
			.order-detail-head {
				position: relative;
				background-color: #FFFFFF;
				margin-bottom: 0.2rem;
			}

			.detail-head {
				width: 100%;
				height: 1.79rem;
				background: url("../image/icon/order-details-icon-01.png") center top no-repeat;
				background-size: cover;
				display: flex;
				align-items: center;
				padding-left: 0.45rem;
				position: relative;
			}

			.detail-head h3 {
				font-size: 0.35rem;
				color: #FFFFFF;
				font-weight: normal;
				margin-bottom: 0.23rem;
			}

			.detail-head p {
				font-size: 0.3rem;
				color: #FFFFFF;
			}

			.detail-head p span {
				min-width: 2.6rem;
				display: inline-block;
				/* margin-right: 0.25rem; */
			}

			.address-info {
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0.2rem 0.24rem;
				position: relative;
			}

			.address-info-right {
				flex-grow: 1;
				padding-left: 0.2rem;
				font-size: 0.3rem;
				color: #333333;
			}

			.address-info:after {
				content: '';
				position: absolute;
				display: block;
				bottom: 0;
				width: 100%;
				height: 1px;
				left: 0;
				background-color: #DDDDDD;
				transform: scaleY(0.5);
				-webkit-transform: scaleY(0.5);
			}

			.address-info img {
				width: 0.42rem;
				height: auto;
				flex-shrink: 0;
			}

			.address-info p {
				margin-bottom: 0;
				font-size: 0.26rem;
			}

			.address-top {
				display: flex;
				align-items: center;
				justify-content: space-between;
				margin-bottom: 0.1rem;
			}

			.address-top p {
				flex-grow: 1;
				color: #333333;
				font-size: 0.3rem;
				margin: 0;
			}

			.mui-btn-outlined {
				height: 0.4rem;
				width: 0.88rem;
				line-height: 0.4rem;
				padding: 0;
				font-size: 0.2rem;
				color: #999999;
				border-radius: 0.12rem;
			}

			.mui-btn:enabled:active {
				background-color: #DDDDDD;
				color: #000000;
			}

			.customer-info {
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0.17rem 0.2rem;
				font-size: 0.28rem;
			}

			.customer-info img {
				width: 0.8rem;
				object-fit: cover;
				height: 0.8rem;
				margin-right: 0.32rem;
				border-radius: 50%;
			}

			.customer-info div {
				display: flex;
				align-items: center;
			}

			.customer-info .mui-icon-arrowright {
				font-size: 0.32rem;
				color: #999999;
				margin-left: 0.1rem;
			}

			.mini-card {
				background-color: #FFFFFF;
				margin-bottom: 0.2rem;
			}

			.mini-card .mui-table-view-cell {
				padding: 0.2rem;
			}

			.mui-table-view:before,
			.mui-table-view:after {
				display: none;
			}

			.mui-table-view-cell:after {
				background-color: #DDDDDD;
			}

			.mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			.goods-info {
				display: flex;
				align-items: center;
				position: relative;
				overflow: hidden;
			}

			.goods-info .goods-img {
				position: relative;
				overflow: hidden;
				width: 1.39rem;
				height: 1.39rem;
				flex-shrink: 0;
			}

			.goods-info .goods-img img {
				object-fit: cover;
				width: 100%;
				height: 100%;
			}

			.goods-info .goods-img span {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 0.2rem;
				height: 0.32rem;
				color: #333333;
				background-color: rgba(0, 0, 0, 0.5);
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				color: #FFFFFF;
			}

			.goods-desc {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				flex-grow: 1;
				padding-left: 0.25rem;
				height: 1.39rem;
				overflow: hidden;
			}

			.goods-desc p {
				max-width: 100%;
				font-size: 0.28rem;
				color: #333333;
			}

			.arguments-cont {
				display: flex;
				justify-content: space-between;
				align-items: center;
				font-size: 0.3rem;
				color: #333333;
			}

			.arguments-cont .mui-badge {
				font-size: 0.24rem;
				color: #999999;
				background-color: #F2F2F2;
				padding: 4px 8px;
			}

			.price-cont {
				font-size: 0.24rem;
				color: #333333;
			}

			.price-cont .price {
				margin-right: 0.3rem;
			}

			.mini-list-btm {
				display: flex;
				align-items: center;
				justify-content: space-between;
				font-size: 0.24rem;
				color: #333333;
				margin-top: 0.3rem;
			}

			.team-boss-name {
				color: #999999;
				margin-left: 0.1rem;
			}

			.royalty {
				color: #999999;
			}

			.royalty span {
				color: #F5CA3A;
			}

			.summary-container div {
				font-size: 0.3rem;
				color: #333333;
				display: flex;
				align-items: center;
				justify-content: space-between;
				margin-bottom: 0.2rem;
			}

			.summary-container .mui-table-view-cell div:last-of-type {
				margin-bottom: 0;
			}

			.await-pay-sum {
				color: #FF0000;
			}

			.net-profit-sum {
				color: #CC9C2D;
			}

			.last-conatiner {
				padding: 0.2rem;
				padding-bottom: 0.9rem;
				margin-bottom: 0;
			}

			.last-conatiner ul {
				margin: 0;
				padding: 0;
				list-style: none;
			}

			.last-conatiner li {
				display: flex;
				align-items: center;
				justify-content: space-between;
				font-size: 0.24rem;
				color: #999999;
				margin-bottom: 0.2rem;
			}

			/* 如果是分销商 */
			.team-name-cont {
				font-size: 0.24rem;
				color: #333333;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
			<h1 class="mui-title">订单详情</h1>
		</header>
		<div id="mui-content" class="mui-content " v-cloak>
			<div class="order-detail-head">
				<div class="detail-head">
					<div>
						<h3>等待买家付款</h3>
						<p><span id="count_down">00小时00分00秒后自动取消</span></p>
					</div>
				</div>
				<div class="address-info">
					<img src="../image/icon/order-details-icon-02.png">
					<div class="address-info-right">
						<div class="address-top">
							<p>
								<span>{{recipients}}</span>
								<span>{{phone}}</span>
							</p>
							<!-- <button type="button" class="mui-btn mui-btn-outlined modification-address">修改</button> -->
						</div>
						<p>{{address}}{{address_detail}}</p>
					</div>
				</div>
				<div class="customer-info">
					<div>
						<img :src="detail.user_avatar">
						<span>{{detail.user_name}}</span>
					</div>
					<div @tap="contact(detail.to_uid,detail.user_name,detail.user_avatar)">
						<span>联系TA</span>
						<span class="mui-icon mui-icon-arrowright"></span>
					</div>
				</div>
			</div>
			<div class="mini-card">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" v-for="(goods,index) in goods_item" :key="index">
						<div class="goods-info">
							<div class="goods-img">
								<img :src="goods.cover">
								<span v-if="detail.team_order==1">分销商品</span>
							</div>
							<div class="goods-desc">
								<p class="mui-ellipsis goods-title">{{goods.name}}</p>
								<div class="arguments-cont">
									<div v-if="goods.content" class="mui-badge">{{goods.content}}</div>
									<div class="price-cont">
										<span class="price">&yen;{{goods.price}}</span>
										<span>x{{goods.number}}</span>
									</div>
								</div>
								<div v-if="detail.team_order==1&&sales==2" class="team-name-cont">
									<span v-if="goods.team_info.name" class="price">货源：{{goods.team_info.name}}</span>
								</div>
							</div>
						</div>
						<div v-if="detail.team_order==1&&sales==2">
							<div>分销商：{{goods.team_info.name}}<span class="team-boss-name">[{{detail.to_user_name}}]</span></div>
							<div class="royalty">提成：<span>&yen;{{goods.commission}}</span></div>
						</div>
					</li>
				</ul>
			</div>
			<div class="mini-card">
				<ul class="mui-table-view summary-container">
					<li class="mui-table-view-cell">
						<div>
							<span v-if="goods_item">共{{goods_item.length}}件商品</span><span>&yen;{{detail.total_price}}</span>
						</div>
						<div>
							<span>运费</span>
							<span>
								<template v-if="detail.freight>0">{{detail.freight}}</template>
								<template v-else>包邮</template>
							</span>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div>
							<span>待付款</span><span class="await-pay-sum">&yen;{{detail.total_price}}</span>
						</div>
						<div v-if="detail.team_order==1">
							<!-- 队长 -->
							<template v-if="sales==1">
								<span>净收益</span>
								<span class="net-profit-sum">&yen;{{detail.total_income}}</span>
							</template>
							<template v-else>
								<span>提成</span>
								<span class="net-profit-sum">&yen;{{detail.total_commission}}</span>
							</template>
						</div>
					</li>
				</ul>
			</div>
			<div class="mini-card last-conatiner">
				<ul>
					<li>
						<span>订单编号：{{detail.out_trade_no}}</span>
						<button type="button" class="mui-btn mui-btn-outlined" @tap="copy_fun(detail.out_trade_no)">复制</button>
					</li>
					<li>
						<span>订单状态：未支付</span>
					</li>
					<li>
						<span>下单时间：{{detail.create_time}}</span>
					</li>
				</ul>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var userInfo = getUserInfo();
			// 倒计时
			var endtimer = "";
			var app = new Vue({
				el: "#mui-content",
				data: {
					recipients: '',
					phone: '',
					address: '',
					address_detail: '',
					order_id: '',
					sales: '',
					goods_item: [],
					detail: {}
				},
				created: function() {
					// 初始化字体大小
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束	
				},
				methods: {
					// 联系买家
					contact: function(cid, chatName, avatar) {
						openPage('dialog.html', 'dialog', '#f7f7f7', {
							cid: cid,
							chatName: chatName,
							avatar: avatar,
							barStyle: 'dark'
						});
					},
					//  复制方法
					copy_fun: function(copy) {
						//判断是安卓还是ios
						if (mui.os.ios) {
							//ios
							var UIPasteboard = plus.ios.importClass("UIPasteboard");
							var generalPasteboard = UIPasteboard.generalPasteboard();
							//设置/获取文本内容:
							generalPasteboard.plusCallMethod({
								setValue: copy,
								forPasteboardType: "public.utf8-plain-text"
							});
							generalPasteboard.plusCallMethod({
								valueForPasteboardType: "public.utf8-plain-text"
							});
							message("已成功复制到剪贴板");
						} else {
							//安卓
							var context = plus.android.importClass("android.content.Context");
							var main = plus.android.runtimeMainActivity();
							var clip = main.getSystemService(context.CLIPBOARD_SERVICE);
							plus.android.invoke(clip, "setText", copy);
							message("已成功复制到剪贴板");
						}
					}
				},
				mounted: function() {
					mui.init({
						beforeback: function() {
							//plus.navigator.setStatusBarStyle("light");
						}
					});
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						app.order_id = self.orderId;
						app.sales = self.sales;
						getDetailData();
					})
				}
			})
			// 修改地址
			mui(".mui-content").on('tap', '.modification-address', function() {
				openPage('modification_of_receiving_address.html', 'modification_of_receiving_address', '#f7f7f7', {
					recipients: app.recipients,
					phone: app.phone,
					address: app.address,
					address_detail: app.address_detail,
				}, "zoom-fade-out")
			})
			
			window.addEventListener('getaddress', function(event) {
				// 接收地址更改
				app.recipients = event.detail.recipients
				app.phone = event.detail.phone
				app.address_detail = event.detail.address_detail
			});
			
			window.addEventListener('editAddressSuccess', function(event) {
				// 接收地址更改
				getDetailData();
			});
			
			// 倒计时
			function clock() {
				var today = new Date(), //当前时间
					h = today.getHours(),
					m = today.getMinutes(),
					s = today.getSeconds();
				var stopTime = new Date(endtimer), //结束时间
					stopH = stopTime.getHours(),
					stopM = stopTime.getMinutes(),
					stopS = stopTime.getSeconds();
				var shenyu = stopTime.getTime() - today.getTime(),
					shengyuD = parseInt(shenyu / (60 * 60 * 24 * 1000)),
					D = parseInt(shenyu) - parseInt(shengyuD * 60 * 60 * 24 * 1000),
					shengyuH = parseInt(D / (60 * 60 * 1000)),
					H = D - shengyuH * 60 * 60 * 1000,
					shengyuM = parseInt(H / (60 * 1000)),
					M = H - shengyuM * 60 * 1000;
				S = parseInt((shenyu - shengyuD * 60 * 60 * 24 * 1000 - shengyuH * 60 * 60 * 1000 - shengyuM * 60 * 1000) /
					1000);
				if (shengyuH > 0 || shengyuM > 0 || S > 0) {
					setTimeout(clock, 500);
					document.getElementById("count_down").innerText = (shengyuH + "小时" + shengyuM + "分" + S + "秒" + " " + "后自动取消");
				} else {
					// 倒计时结束
					document.getElementById("count_down").innerText = "订单已取消";
				}
			}
			// 详情资料
			function getDetailData() {
				mui.post($ajaxUrl + 'order&action=order_detail', {
					token: userInfo.token,
					order_id: app.order_id
				}, function(res) {
					logs(res);
					var data = res.data;
					if (res.errno == 0) {
						app.detail = data;
						app.recipients = data.name;
						app.phone = data.phone;
						app.address = data.address;
						app.address_detail = data.address_detail;
						app.goods_item = data.item;
						endtimer = data.over_time;
						// 开始倒计时
						clock();
					} else {}
				}, 'json');
			}
			function openDetail(){
				openPage('','','','',{
					
				})
			}
		</script>
	</body>

</html>
