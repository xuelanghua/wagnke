<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<style>
			.clearfix{
				clear: both;
			}
			input[type='button']:enabled:active, input[type='button'].mui-active:enabled,
			input[type='submit']:enabled:active,
			input[type='submit'].mui-active:enabled,
			input[type='reset']:enabled:active,
			input[type='reset'].mui-active:enabled,
			button:enabled:active,
			button.mui-active:enabled,
			.mui-btn:enabled:active,
			.mui-btn.mui-active:enabled
			{
				
			}
			header img{
				height: 17px;
				margin-top: 13px;
				margin-right: 10px;
			}
			.mui-bar{
				background-color: #FFFFFF;
			}
		
			.search{
				margin: 0.625rem;
				padding: 0 10px;
				border-radius: 0.3125rem;
				border: 1px solid #DDDDDD;
				background-color: #FFFFFF;
			}
			.mui-icon{
				font-size: 20px;
			}
			.search input{
				width: 90%;
				margin: 0;
				border: none;
				padding: 3px;
				font-size: 0.875rem;
			}
			
			.hd{
				font-size: 14px;
				border-top: 1px solid #DDDDDD;
				background-color: #F8F8F8;
			}
			.hd li{
				display: block;
				/* width: 20%; */
				width: 25%;
				float: left;
				padding: 10px 0;
				text-align: center;
			}
			.hd li.current{
				color: #F5CA3A;
				border-bottom: 2px solid #F5CA3A;
			}
			
			.example{
				width: 100%;
				margin-bottom: 66px;
			}
			.bd li{
				display: none;
			}
			.bd li.current{
				display: block;
			}
			.Record_list{
				margin-bottom: 10px;
				background-color: #FFFFFF;
			}
			.Record_list_tile{
				font-size: 14px;
				padding: 14px 15px;
				border-bottom: 1px solid #F2F2F2;
			}
			.Record_list_tile .mui-icon{
				color: #878787;
			}
			.commodity_information{
				padding: 13px 15px;
				border-bottom: 1px solid #F2F2F2;
			}
			.commodity_information_chart{
				width: 65px;
				height: 65px;
			}
			.commodity_information_chart img{
				width: 100%;
				height: 100%;
			}
			.jianshu{
				width: 76%;
				font-size: 12px;
				color: #999999;
			}
			.font{
				font-size: 14px;
				color: #000000;
				padding-bottom: 10px;
			}
			.total{
				font-size: 12px;
				margin-top: 10px;
				text-align: right;
			}
			.total span{
				font-size: 14px;
			}
			
			.purchaser{
				padding: 10px 15px;
				font-size: 14px;
			}
			.purchaser_chart{
				width: 31px;
				height: 31px;
				display: block;
			}
			.purchaser_chart img{
				width: 100%;
				height: 100%;
				border-radius: 50%;
			}
			.button{
				border: none;
				color: #F5CA3A;
				border: 1px solid #F5CA3A;
			}
			.button:enabled:active{
				color: #fff;
				background-color: #ecd482;
			}
			
			.current a{
				color: #333333;
			}
			
			.ship{
				margin-bottom: 5px;
				padding: 10px;
				background-color: #F8F8F8;
			}
			
			.lianxi{
				color: #999999;
				margin-right: 15px;
				border: 1px solid #999999;
			}
			
			.complete{
				color: #CC9C2D;
			}
			
			button{
				width: 80px;
			}
			
			.mui-search input {
				background-color: #fff;
				border-radius: 0.3125rem;
				border: 1px solid #DDD;
			}
			
			/* 弹出框 */
			#cover{
			    position: fixed;
				z-index: 9999;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
				background: #333333 none repeat scroll 0% 0%;
			}
			.tanchu{
				border-radius: 5px;
				background-color: #FFFFFF;
				position: fixed;
				z-index: 99999;
				width: 92%;
				top: 25%;
				left: 4%;
				right: 4%;
				display: none;
			}
			.tanchu_title{
				padding: 21px 0;
				font-size: 17px;
				text-align: center;
				border-bottom: 1px solid #F2F2F2;
			}
			.tanchu_input{
				padding: 35px 0;
				border-bottom: 1px solid #F2F2F2;
			}
			.tanchu_express{
				width: 90%;
				margin: 0 auto;
				padding: 10px 13px;
				font-size: 14px;
				background-color: #F2F2F2;
			}
			.tanchu_express input{
				width: 75%;
				border: none;
				margin: 0;
				font-size: 14px;
				background-color: #F2F2F2;
			}
			.tanchu_button{
				text-align: center;
				padding: 24px 0;
			}
			.tanchu_button button{
				color: #000000;
				background-color: #F5CA3A;
				border: none;
				padding: 12px 0;
				width: 50%;
				font-size: 14px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">订单管理</h1>
		</header>

		<div class="mui-content">
			<div class="mui-input-row mui-search" style="margin: 10px 10px -5px 10px;">
				<input type="search" class="mui-input-clear" name="goods_name" placeholder="搜索商品名称">
			</div>

			<div class="hd">
				<li class="current" data-status="1">待付款</li>
				<li data-status="2">待发货</li>
				<li data-status="3">已发货</li>
				<li data-status="4">已完成</li>
				<!-- <li data-status="5">退货</li> -->
				<div class="clearfix"></div>
			</div>
			<div class="example">
				<div class="bd">
					<li class="current" data-status="1">
						<!-- <div class="Record_list">
							<div class="Record_list_tile">
								<span>待付款(1天7小时后将自动取消订单)</span>
								<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>
							</div>
							<div class="commodity_information">
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="total">共1件商品合计:￥<span>25.00</span>(含运费:￥5.00)</div>
							</div>
							<div class="purchaser">
								<div class="mui-pull-left">
									<span class="purchaser_chart mui-pull-left">
										<img src="../image/bj.jpg">
									</span>
									<span class="mui-pull-left" style="margin: 5px 0 0 10px;">微信昵称</span>
									<div class="clearfix"></div>
								</div>
								<button class="mui-pull-right button">联系TA</button>
								<div class="clearfix"></div>
							</div>
						</div> -->
					</li>
					<li data-status="2">
						<!-- <div class="Record_list">
							<div class="Record_list_tile">
								<span>
									<span>付款时间：</span>
									<span>2018-08-21 18:20:20</span>
								</span>
								<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>
							</div>
							<div class="commodity_information">
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="total">共1件商品合计:￥<span>25.00</span>(含运费:￥5.00)</div>
							</div>
							<div class="purchaser">
								<div class="mui-pull-left">
									<span class="purchaser_chart mui-pull-left">
										<img src="../image/bj.jpg">
									</span>
									<span class="mui-pull-left" style="margin: 5px 0 0 10px;">微信昵称</span>
									<div class="clearfix"></div>
								</div>
								<div>
									<button class="mui-pull-right button">发货</button>
									<button class="mui-pull-right lianxi">联系TA</button>
								</div>
								<div class="clearfix"></div>
							</div>
						</div> -->
					</li>
					<li data-status="3">
						<!-- <div class="Record_list">
							<div class="Record_list_tile">
								<span>
									<span>发货时间：</span>
									<span>2018-08-21 18:20:20</span>
								</span>
								<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>
							</div>
							<div class="commodity_information">
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="total">共1件商品合计:￥<span>25.00</span>(含运费:￥5.00)</div>
							</div>
							<div class="purchaser">
								<div class="mui-pull-left">
									<span class="purchaser_chart mui-pull-left">
										<img src="../image/bj.jpg">
									</span>
									<span class="mui-pull-left" style="margin: 5px 0 0 10px;">微信昵称</span>
									<div class="clearfix"></div>
								</div>
								<div>
									<button class="mui-pull-right button">查看物流</button>
									<button class="mui-pull-right lianxi">联系TA</button>
								</div>
								<div class="clearfix"></div>
							</div>
						</div> -->
					</li>
					<li data-status="4">
						<!-- <div class="Record_list">
							<div class="Record_list_tile">
								<span class="complete">已完成</span>
								<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>
							</div>
							<div class="commodity_information">
								<div class="ship">
									<div class="commodity_information_chart mui-pull-left">
										<img src="../image/rotation_chart.png">
									</div>
									<div class="mui-pull-right jianshu">
										<div class="font">
											<span>旺客</span>
											<span class="mui-pull-right">￥20/件</span>
										</div>
										<div>
											<span>规格：默认</span>
											<span class="mui-pull-right">x1</span>
										</div>
									</div>
									<div class="clearfix"></div>
								</div>
								<div class="total">共1件商品合计:￥<span>25.00</span>(含运费:￥5.00)</div>
							</div>
							<div class="purchaser">
								<div class="mui-pull-left">
									<span class="purchaser_chart mui-pull-left">
										<img src="../image/bj.jpg">
									</span>
									<span class="mui-pull-left" style="margin: 5px 0 0 10px;">微信昵称</span>
									<div class="clearfix"></div>
								</div>
								<button class="mui-pull-right button">联系TA</button>
								<div class="clearfix"></div>
							</div>
						</div> -->
					</li>
				</div>
			</div>
			
			<!-- 弹出框 -->
			<div id="cover"></div>
			<div class="tanchu">
				<div class="tanchu_title">物流信息</div>
				<div class="tanchu_input">
					<div class="tanchu_express">
						物流公司<input type="text" name="express_company" />
					</div>
					<div class="tanchu_express" style="margin-top: 16px;">
						单号<input type="text" name="courier_number" style="margin-left: 10%;" />
					</div>
				</div>
				<div class="tanchu_button">
					<button type="button" class="mui-btn">确认发货</button>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				pullRefresh: {
					container: ".mui-content", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
					down: {
						style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
						color: '#2289FF', //可选，默认“#2BD009” 下拉刷新控件颜色
						height: '50px', //可选,默认50px.下拉刷新控件的高度,
						range: '100px', //可选 默认100px,控件可下拉拖拽的范围
						offset: '0px', //可选 默认0px,下拉刷新控件的起始位置
						auto: false, //可选,默认false.首次加载自动上拉刷新一次
						callback: function() {
							getOrderList(true);
						} //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
					}
				}
			})

			var userInfo = getUserInfo();
			var goodsName = '';
			var orderId = 0;
			mui.plusReady(function() {
				eventInit();
				getOrderList(false);
			})

			//事件初始化
			function eventInit() {
				//发货事件监听
				window.addEventListener('expressSuccess', function() {
					getOrderList(false);
				})
				//搜索监听
				document.onkeydown = function(event) {
					var e = event || window.event || arguments.callee.caller.arguments[0];
					if (e && e.keyCode == 13) { // enter 键
						goodsName = document.querySelector('input[name=goods_name]').value;
						getOrderList();
					}
				};

				//切换订单选项卡
				mui('.hd').on('tap', 'li', function() {
					mui('.hd li').each(function() {
						this.className = '';
					})
					var status = this.dataset.status;
					this.className = 'current';
					mui('.bd li').each(function() {
						this.className = '';
					})
					document.querySelector('.bd li[data-status="' + status + '"]').className = 'current';
				})
				
				//发货弹窗
				mui('.mui-content').on('tap', '#cover', function() {
					this.style.display = 'none';
					document.querySelector('.tanchu').style.display = 'none';
				})
				
				//发货
				mui('.mui-content').on('tap', '.tanchu_button', function() {
					var expressCompany = document.querySelector('input[name=express_company]').value;
					var courierNumber = document.querySelector('input[name=courier_number]').value;
					if (expressCompany.length == 0) {
						message('请填写物流公司!');
						return;
					}
					if (courierNumber.length == 0) {
						message('请填写物流单号!');
						return;
					}
					document.querySelector('#cover').style.display = 'none';
					document.querySelector('.tanchu').style.display = 'none';
					fnExpress(expressCompany, courierNumber, orderId);
				})
			}
			
			//订单列表事件
			function orderEvent() {
				//查看详情
				mui('.mui-content').on('tap', '.Record_list', function() {
					var orderId = this.dataset.id;
					var status = this.dataset.status;
					if (status == 1) {
						openDetailWin('order_details_1', orderId);
					} else if (status == 2) {
						openDetailWin('order_details_2', orderId);
					} else {
						openDetailWin('order_details_3', orderId);
					}
				})
				
				//聊天
				mui('.Record_list').on('tap', '.chat', function(e) {
					var userId = this.dataset.id;
					var nickname = this.dataset.name;
					fnOpenWin('dialog.html', 'dialog', {statusbar: {background: '#F7F7F7'}}, {cid: userId, chatName: nickname, barStyle: 'dark'}, 'slide-in-right');
					e.stopPropagation();
				})
				
				//发货
				mui('.Record_list').on('tap', '.deliver', function(e) {
					orderId = this.dataset.id;
					document.querySelector('.tanchu').style.display = 'block';
					document.querySelector('#cover').style.display = 'block';
					e.stopPropagation();
				})
				
				//查看物流
				mui('.Record_list').on('tap', '.logistics', function(e) {
					var orderId = this.dataset.id;
					fnOpenWin('logistics.html', 'logistics', {statusbar: {background: '#F7F7F7'}}, {orderId: orderId}, 'slide-in-right');
					e.stopPropagation();
				})
			}

			//获取订单列表
			function getOrderList(refresh) {
				plus.nativeUI.showWaiting();
				mui.post($ajaxUrl + 'order', {
					action: 'list',
					token: userInfo.token,
					goods_name: goodsName
				}, function(res) {
					var emptyContent =
						'<div style="padding: 30px 15px;text-align: center;color: #ccc;padding-right: 45px;">没有数据</div>';
					if (res.errno == 0) {
						var orderList = res.data;
						var str_1 = '';
						var str_2 = '';
						var str_3 = '';
						var str_4 = '';
						for (var i in orderList) {
							if (orderList[i].pay_status == 0) {
								str_1 += '<div class="Record_list goods-detail" data-status="1" data-id="' + orderList[i].id + '">';
								str_1 += '<div class="Record_list_tile">';
								str_1 += '<span>待付款(' + orderList[i].pay_text + '后将自动取消订单)</span>';
								str_1 += '<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>';
								str_1 += '</div>';
								str_1 += '<div class="commodity_information">';
								var goods = orderList[i].goods;
								var number = 0;
								for (var j in goods) {
									str_1 += '<div class="ship">';
									str_1 += '<div class="commodity_information_chart mui-pull-left">';
									str_1 += '<img src="' + goods[j].cover + '">';
									str_1 += '</div>';
									str_1 += '<div class="mui-pull-right jianshu">';
									str_1 += '<div class="font">';
									str_1 += '<span>' + goods[j].name + '</span>';
									str_1 += '<span class="mui-pull-right">￥' + goods[j].price + '/件</span>';
									str_1 += '</div>';
									str_1 += '<div>';
									if (goods[j].content.length == 0) {
										str_1 += '<span>规格：默认</span>';
									} else {
										str_1 += '<span>规格：' + goods[j].content + '</span>';
									}
									str_1 += '<span class="mui-pull-right">x' + goods[j].number + '</span>';
									str_1 += '</div>';
									str_1 += '</div>';
									str_1 += '<div class="clearfix"></div>';
									str_1 += '</div>';
									number += parseInt(goods[j].number);
								}
								str_1 += '<div class="total">共' + number + '件商品合计:￥<span>' + orderList[i].total_price + '</span>(含运费:￥' +
									orderList[i].freight + ')</div>';
								str_1 += '</div>';
								str_1 += '<div class="purchaser">';
								str_1 += '<div class="mui-pull-left">';
								str_1 += '<span class="purchaser_chart mui-pull-left">';
								str_1 += '<img src="' + orderList[i].avatar + '">';
								str_1 += '</span>';
								str_1 += '<span class="mui-pull-left" style="margin: 5px 0 0 10px;">' + orderList[i].nickname + '</span>';
								str_1 += '<div class="clearfix"></div>';
								str_1 += '</div>';
								str_1 += '<button class="mui-pull-right button chat" data-id="' + orderList[i].user_id + '" data-name="' +
									orderList[i].nickname + '">联系TA</button>';
								str_1 += '<div class="clearfix"></div>';
								str_1 += '</div>';
								str_1 += '</div>';
							} else if (orderList[i].pay_status == 1 && orderList[i].order_status == 0) {
								str_2 += '<div class="Record_list goods-detail" data-status="2" data-id="' + orderList[i].id + '">';
								str_2 += '<div class="Record_list_tile">';
								str_2 += '<span>';
								str_2 += '<span>付款时间：</span>';
								str_2 += '<span>' + orderList[i].pay_time + '</span>';
								str_2 += '</span>';
								str_2 += '<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>';
								str_2 += '</div>';
								str_2 += '<div class="commodity_information">';
								var goods = orderList[i].goods;
								var number = 0;
								for (var j in goods) {
									str_2 += '<div class="ship">';
									str_2 += '<div class="commodity_information_chart mui-pull-left">';
									str_2 += '<img src="' + goods[j].cover + '">';
									str_2 += '</div>';
									str_2 += '<div class="mui-pull-right jianshu">';
									str_2 += '<div class="font">';
									str_2 += '<span>' + goods[j].name + '</span>';
									str_2 += '<span class="mui-pull-right">￥' + goods[j].price + '/件</span>';
									str_2 += '</div>';
									str_2 += '<div>';
									if (goods[j].content.length == 0) {
										str_2 += '<span>规格：默认</span>';
									} else {
										str_2 += '<span>规格：' + goods[j].content + '</span>';
									}
									str_2 += '<span class="mui-pull-right">x' + goods[j].number + '</span>';
									str_2 += '</div>';
									str_2 += '</div>';
									str_2 += '<div class="clearfix"></div>';
									str_2 += '</div>';
									number += parseInt(goods[j].number);
								}
								str_2 += '<div class="total">共' + number + '件商品合计:￥<span>' + orderList[i].total_price + '</span>(含运费:￥' +
									orderList[i].freight + ')</div>';
								str_2 += '</div>';
								str_2 += '<div class="purchaser">';
								str_2 += '<div class="mui-pull-left">';
								str_2 += '<span class="purchaser_chart mui-pull-left">';
								str_2 += '<img src="' + orderList[i].avatar + '">';
								str_2 += '</span>';
								str_2 += '<span class="mui-pull-left" style="margin: 5px 0 0 10px;">' + orderList[i].nickname + '</span>';
								str_2 += '<div class="clearfix"></div>';
								str_2 += '</div>';
								str_2 += '<div>';
								str_2 += '<button class="mui-pull-right button deliver" data-id="' + orderList[i].id + '">发货</button>';
								str_2 += '<button class="mui-pull-right lianxi chat" data-id="' + orderList[i].user_id + '" data-name="' +
									orderList[i].nickname + '">联系TA</button>';
								str_2 += '</div>';
								str_2 += '<div class="clearfix"></div>';
								str_2 += '</div>';
								str_2 += '</div>';
							} else if (orderList[i].pay_status == 1 && orderList[i].order_status == 2) {
								str_3 += '<div class="Record_list goods-detail" data-status="3" data-id="' + orderList[i].id + '">';
								str_3 += '<div class="Record_list_tile">';
								str_3 += '<span>';
								str_3 += '<span>发货时间：</span>';
								str_3 += '<span>' + orderList[i].express_time + '</span>';
								str_3 += '</span>';
								str_3 += '<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>';
								str_3 += '</div>';
								str_3 += '<div class="commodity_information">';
								var goods = orderList[i].goods;
								var number = 0;
								for (var j in goods) {
									str_3 += '<div class="ship">';
									str_3 += '<div class="commodity_information_chart mui-pull-left">';
									str_3 += '<img src="' + goods[j].cover + '">';
									str_3 += '</div>';
									str_3 += '<div class="mui-pull-right jianshu">';
									str_3 += '<div class="font">';
									str_3 += '<span>' + goods[j].name + '</span>';
									str_3 += '<span class="mui-pull-right">￥' + goods[j].price + '/件</span>';
									str_3 += '</div>';
									str_3 += '<div>';
									if (goods[j].content.length == 0) {
										str_3 += '<span>规格：默认</span>';
									} else {
										str_3 += '<span>规格：' + goods[j].content + '</span>';
									}
									str_3 += '<span class="mui-pull-right">x' + goods[j].number + '</span>';
									str_3 += '</div>';
									str_3 += '</div>';
									str_3 += '<div class="clearfix"></div>';
									str_3 += '</div>';
									number += parseInt(goods[j].number);
								}
								str_3 += '<div class="total">共' + number + '件商品合计:￥<span>' + orderList[i].total_price + '</span>(含运费:￥' +
									orderList[i].freight + ')</div>';
								str_3 += '</div>';
								str_3 += '<div class="purchaser">';
								str_3 += '<div class="mui-pull-left">';
								str_3 += '<span class="purchaser_chart mui-pull-left">';
								str_3 += '<img src="' + orderList[i].avatar + '">';
								str_3 += '</span>';
								str_3 += '<span class="mui-pull-left" style="margin: 5px 0 0 10px;">' + orderList[i].nickname + '</span>';
								str_3 += '<div class="clearfix"></div>';
								str_3 += '</div>';
								str_3 += '<div>';
								str_3 += '<button class="mui-pull-right button logistics" data-id="' + orderList[i].id + '">查看物流</button>';
								str_3 += '<button class="mui-pull-right lianxi chat" data-id="' + orderList[i].user_id + '" data-name="' +
									orderList[i].nickname + '">联系TA</button>';
								str_3 += '</div>';
								str_3 += '<div class="clearfix"></div>';
								str_3 += '</div>';
								str_3 += '</div>';
							} else if (orderList[i].pay_status == 1 && orderList[i].order_status == 3) {
								str_4 += '<div class="Record_list goods-detail" data-status="4" data-id="' + orderList[i].id + '">';
								str_4 += '<div class="Record_list_tile">';
								str_4 += '<span class="complete">已完成</span>';
								str_4 += '<span class="mui-icon mui-icon-arrowright mui-pull-right"></span>';
								str_4 += '</div>';
								str_4 += '<div class="commodity_information">';
								var goods = orderList[i].goods;
								var number = 0;
								for (var j in goods) {
									str_4 += '<div class="ship">';
									str_4 += '<div class="commodity_information_chart mui-pull-left">';
									str_4 += '<img src="' + goods[j].cover + '">';
									str_4 += '</div>';
									str_4 += '<div class="mui-pull-right jianshu">';
									str_4 += '<div class="font">';
									str_4 += '<span>' + goods[j].name + '</span>';
									str_4 += '<span class="mui-pull-right">￥' + goods[j].price + '/件</span>';
									str_4 += '</div>';
									str_4 += '<div>';
									if (goods[j].content.length == 0) {
										str_4 += '<span>规格：默认</span>';
									} else {
										str_4 += '<span>规格：' + goods[j].content + '</span>';
									}
									str_4 += '<span class="mui-pull-right">x' + goods[j].number + '</span>';
									str_4 += '</div>';
									str_4 += '</div>';
									str_4 += '<div class="clearfix"></div>';
									str_4 += '</div>';
									number += parseInt(goods[j].number);
								}
								str_4 += '<div class="total">共' + number + '件商品合计:￥<span>' + orderList[i].total_price + '</span>(含运费:￥' +
									orderList[i].freight + ')</div>';
								str_4 += '</div>';
								str_4 += '<div class="purchaser">';
								str_4 += '<div class="mui-pull-left">';
								str_4 += '<span class="purchaser_chart mui-pull-left">';
								str_4 += '<img src="' + orderList[i].avatar + '">';
								str_4 += '</span>';
								str_4 += '<span class="mui-pull-left" style="margin: 5px 0 0 10px;">' + orderList[i].nickname + '</span>';
								str_4 += '<div class="clearfix"></div>';
								str_4 += '</div>';
								str_4 += '<button class="mui-pull-right button chat" data-id="' + orderList[i].user_id + '" data-name="' +
									orderList[i].nickname + '">联系TA</button>';
								str_4 += '<div class="clearfix"></div>';
								str_4 += '</div>';
								str_4 += '</div>';
							}
						}
						if (str_1.length != 0) {
							document.querySelector('.bd li[data-status="1"]').innerHTML = str_1;
						} else {
							document.querySelector('.bd li[data-status="1"]').innerHTML = emptyContent;
						}
						if (str_2.length != 0) {
							document.querySelector('.bd li[data-status="2"]').innerHTML = str_2;
						} else {
							document.querySelector('.bd li[data-status="2"]').innerHTML = emptyContent;
						}
						if (str_3.length != 0) {
							document.querySelector('.bd li[data-status="3"]').innerHTML = str_3;
						} else {
							document.querySelector('.bd li[data-status="3"]').innerHTML = emptyContent;
						}
						if (str_4.length != 0) {
							document.querySelector('.bd li[data-status="4"]').innerHTML = str_4;
						} else {
							document.querySelector('.bd li[data-status="4"]').innerHTML = emptyContent;
						}
					} else {
						mui('.bd li').each(function() {
							this.innerHTML = emptyContent;
						})
					}
					//结束下拉刷新
					if (refresh) {
						mui('.mui-content').pullRefresh().endPulldownToRefresh();
					} else {
						orderEvent();
					}
					plus.nativeUI.closeWaiting();
				}, 'json');
			}
			
			//打开订单详情页
			function openDetailWin(win, orderId) {
				fnOpenWin(win + '.html', win, {statusbar: {background: '#F7F7F7'}}, {orderId: orderId}, 'slide-in-right');
			}
			
			//发货
			function fnExpress(expressCompany, courierNumber, orderId) {
				mui.post($ajaxUrl + 'order', {
					action: 'express',
					token: userInfo.token,
					order_id: orderId,
					express_company: expressCompany,
					courier_number: courierNumber
				}, function(res) {
					if (res.errno == 0) {
						message('发货成功!');
						setTimeout(function() {
							getOrderList(false);
						}, 2000)
					} else {
						message(res.message);
					}
				}, 'json');
			}
		</script>
	</body>
</html>
