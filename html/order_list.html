<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<style type="text/css">
			.mui-bar {
				height: auto;
			}

			.mui-bar .mui-icon {
				position: absolute;
			}

			.mui-bar-nav~.mui-content {
				padding-top: 84px;
			}

			.order-type {
				width: 6.56rem;
				height: 1.1rem;
				border: 1px solid #000000;
				display: flex;
				align-items: center;
				justify-content: space-between;
				border-radius: 0.2rem;
				-webkit-transform: scale(0.5);
				transform: scale(0.5);
				overflow: hidden;
				margin: 0 auto;
				position: relative;
			}

			.order-type span {
				width: 50%;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 0.56rem;
				color: #333333;
				height: 100%;
				background: rgba(0, 0, 0, 0);
				z-index: 3;
				-webkit-transition: all 0.0.3 s ease-in-out;
				transition: all 0.0.3 s ease-in-out;
			}

			.order-type span.active {
				color: #DDDDDD;
			}

			.order-type i {
				position: absolute;
				left: 0;
				top: 0;
				height: 100%;
				width: 50%;
				background-color: #333333;
				z-index: 1;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
			}

			.header-top {
				display: flex;
				align-items: center;
				height: 44px;
				overflow: hidden;
				/* padding-top: 10px; */
			}

			.mui-control-content {
				background-color: transparent;
				height: 89vh;
			}

			.mui-segmented-control-inverted {
				width: 100%;
				position: relative;
				height: 44px;
			}

			.header-bottom {
				/* margin-top: 5px; */
				position: relative;
			}

			.header-bottom .mui-control-item {
				font-size: 0.28rem;
				touch-action: pan-y;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
			}

			.mui-segmented-control .mui-control-item {
				line-height: 44px;
			}

			.mui-bar .mui-segmented-control {
				top: 0;
			}

			.slider-progressBar {
				position: absolute;
				left: 0;
				bottom: 0;
				height: 2px;
				width: 20%;
				margin-left: 2.5%;
				background-color: #F5CA3A;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
				border-radius: 2px;
			}

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: #F5CA3A;
			}

			.order-list-groups {
				padding: 0;
				margin: 0;
				list-style: none;
				padding: 0.2rem 0 0.2rem;
				background: transparent;
			}

			.order-list {
				background: transparent;
				padding: 0.2rem;
			}

			.mui-card {
				border-radius: 0.1rem;
				margin: 0.2rem 0 0;
				box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);
			}

			.mui-card-footer:before,
			.mui-card-header:after {
				left: 15px;
				background-color: #ececec;
			}

			.mui-card-header {
				font-size: 0.3rem;
			}

			.mui-card-header .mui-icon {
				font-size: 0.36rem;
			}

			.mui-card-header .user-head-img {
				border-radius: 50%;
				object-fit: cover;
				width: 0.65rem;
				height: 0.65rem;
				margin-right: 0.25rem;
			}

			.flex-center {
				display: flex;
				align-items: center;
			}

			.cancel-time {
				color: #CC9C2D;
			}

			.order-inside-list {
				margin-bottom: 0.26rem;
				padding: 0.1rem 0;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.order-inside-list:last-of-type {
				margin-bottom: 0;
			}

			.inside-list-left {
				width: 1.5rem;
				height: 1.5rem;
				overflow: hidden;
				margin-right: 0.28rem;
				flex-shrink: 0;
				position: relative;
			}

			.goods-type-sign {
				position: absolute;
				width: 100%;
				height: 0.32rem;
				background-color: rgba(0, 0, 0, 0.5);
				bottom: 0;
				left: 0;
				font-size: 0.2rem;
				line-height: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #FFFFFF;
			}

			.inside-list-left img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.inside-list-right {
				flex-grow: 1;
				position: relative;
				width: 4.8rem;
				height: auto;
			}

			.inside-list-right p {
				width: 100%;
				font-size: 0.28rem;
				color: #333333;
				margin-bottom: 0;
				position: relative;
			}

			.inside-list-right:after {
				content: '';
				position: absolute;
				display: block;
				bottom: -0.2rem;
				width: 100%;
				height: 1px;
				background-color: #f5f6f7;
				transform: scaleY(0.5);
				-webkit-transform: scaleY(0.5);
			}

			.order-inside-list:last-of-type .inside-list-right:after {
				display: none;
			}

			.specification-cont {
				display: flex;
				align-items: center;
				justify-content: space-between;
				font-size: 0.24rem;
				padding: 0.1rem 0;
			}

			.specification-left {
				border-radius: 0.2rem;
				background-color: #F2F2F2;
				color: #999999;
				padding: 0 0.2rem;
				line-height: 1.6;
				font-size: 0.24rem;
			}

			.specification-right span:first-of-type {
				margin-right: 0.2rem;
			}

			.distribution-team {
				font-size: 0.24rem;
				color: #333333;
			}

			.distribution-team span {
				color: #999999;
				margin-left: 0.2rem;
			}

			.price-num {
				display: flex;
				justify-content: space-between;
				flex-grow: 1;
				width: 100%;
				padding: 0.1rem 0;
			}

			.mui-card-footer {
				flex-direction: column;
				font-size: 0.3rem;
				color: #333333;
			}

			.net-yield {
				width: 100%;
				display: flex;
				align-items: center;
				justify-content: flex-end;
			}

			.net-yield-number {
				color: #CC9C2D;
			}

			.mui-bar .mui-icon.show-search-btn {
				position: absolute;
				right: 20px;
				background-color: #eaeaea;
				border-radius: 50%;
				padding: 0.04rem;
				font-size: 0.42rem;
				color: #333333;
			}

			.mui-control-content {
				height: auto;
			}

			.deliver-goods {
				width: 100%;
				display: flex;
				align-items: center;
				justify-content: flex-end;
				padding-top: 0.1rem;
			}

			.deliver-goods .mui-btn-outlined {
				background-color: #F5CA3A;
				width: 1.3rem;
				height: 0.5rem;
				padding: 0;
				border: none;
				color: #FFFFFF;
			}

			.deliver-goods .mui-btn:enabled:active {
				background-color: #F0AD4E;
				color: #FFFFFF;
			}

			/* 发货窗口 */
			.deliver-goods-model {
				position: fixed;
				z-index: 1000;
				top: 25%;
				width: 6.46rem;
				height: 6.21rem;
				left: 0.52rem;
				margin: 0;
				/* border: 1px solid #000000; */
				border-radius: 0.1rem;
				box-shadow: none;
				display: none;
			}

			.mui-poppicker {
				z-index: 1045;
			}

			.deliver-goods-model .mui-card-header {
				justify-content: center;
				height: 1.19rem;
				font-size: 0.35rem;
				color: #474747;
				box-shadow: none;
			}

			.mui-card-header:after {
				background-color: #ececec;
			}

			.deliver-goods-model ul {
				padding: 0;
				margin: 0;
				list-style: none;
			}

			.mui-card-content-inner {
				padding: 0 0.3rem;
			}

			.deliver-goods-model li {
				margin: 0.5rem 0;
				border-radius: 0.1rem;
				background-color: #F2F2F2;
				display: flex;
				align-items: center;
				height: 1rem;
				padding: 0 0.2rem;
				position: relative;
			}

			.deliver-goods-model .first-section {
				justify-content: space-between;
			}

			.deliver-goods-model .second-section {
				padding-right: 0;
			}

			.deliver-goods-model .ensure-deliver-goods {
				font-size: 0.3rem;
				background-color: #F5CA3A;
				color: #FFFFFF;
				justify-content: center;
				margin-top: 0.7rem;
				margin-bottom: 0;
			}

			.express-title {
				color: #999999;
				margin-right: 0.4rem;
			}

			.express-title.mui-navigate-right:after {
				font-size: 0.36rem;
				right: 0.2rem;
			}

			.deliver-goods-model span {
				font-size: 0.3rem;
				flex-shrink: 0;
			}

			.deliver-goods-model input {
				margin: 0;
				padding: 0;
				height: 32px;
				/* width: 3.6rem; */
				flex-grow: 1;
				font-size: 0.28rem;
				margin: 0 0.2rem;
				border: none;
				background-color: transparent;
			}

			.deliver-goods-model .scan-btn {
				height: 100%;
				/* background-color: #0062CC; */
				padding: 0 0.2rem;
				display: inline-flex;
				flex-shrink: 0;
				align-items: center;
				border-radius: 0.1rem;
			}

			.scan-btn img {
				width: 0.36rem;
				height: 0.36rem;
			}

			/* 发货窗口完结 */
			/* 订单为空 */
			.void-list-container {
				width: 100%;
				padding-top: 30%;
				display: block;
			}

			.void-list-container img {
				display: block;
				width: 45%;
				margin: 0 auto;
			}

			/* 搜索*/
			.search-cont {
				/* background-color: #0062CC; */
				display: flex;
				align-items: center;
				position: relative;
				padding-top: 0;
				justify-content: space-between;
			}

			.search-cont .search-cont-inside {
				position: relative;
				margin-left: 2%;
				display: flex;
				flex-grow: 1;
			}

			.search-cont .search-cont-inside input {
				margin-bottom: 0;
				background-color: #DDDDDD;
				border-radius: 0.4rem;
				padding: 0.1rem 0.6rem;
				text-align: left;
				flex-grow: 1;
				margin: 0;
			}

			.search-cont .mui-icon-search {
				position: absolute;
				left: 0.1rem;
				font-size: 0.42rem;
			}

			.search-cont .mui-icon-clear {
				position: absolute;
				right: 0.1rem;
				font-size: 0.42rem;
				color: #999999;
			}

			.search-cont-inside {
				position: relative;
				display: flex;
				align-items: center;
				flex-grow: 1;
			}

			.search-btn {
				display: inline-flex;
				height: 32px;
				padding: 0 5px;
				align-items: center;
				justify-content: center;
				border-radius: 0.2rem;
				font-size: 0.28rem;
				color: #555555;
				flex-shrink: 0;
			}

			.search-container {
				margin-left: 0.5rem;
				/* background-color: #0062CC; */
				width: 100%;
				-webkit-transition: display 0.5s ease-in-out;
				transition: display 0.5s ease-in-out;
			}

			input::-webkit-input-placeholder {
				color: #999999;
				font-size: 0.26rem;
			}

			.change-container {
				display: flex;
				align-items: center;
				justify-content: space-between;
				width: 100%;
				-webkit-transition: display 0.5s ease-in-out;
				transition: display 0.5s ease-in-out;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>

	<body>
		<div id="mui-content" class="mui-clearfix" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<div class="header-top">
					<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
					<div v-show="isSeek" class="search-container">
						<form action="" onsumit="return false">
							<div class="mui-input-row search-cont">
								<div class="search-cont-inside">
									<span class="mui-icon mui-icon-search"></span>
									<input type="search" id="search" v-model="keyword" name="keyword" placeholder="产品名字/搜索订单">
									<span v-show="keyword" class="mui-icon mui-icon-clear" @tap="keyword=''"></span>
								</div>
								<span class="search-btn" @tap="cancelSearch">取消</span>
							</div>
						</form>
					</div>
					<div v-show="!isSeek" class="change-container">
						<div class="order-type">
							<i id="bg_full"></i>
							<span class="order-type-item active" data-order="1">供货订单</span>
							<span class="order-type-item" data-order="2">分销订单</span>
						</div>
						<span class="mui-icon mui-icon-search show-search-btn" @tap="starSearch"></span>
					</div>
				</div>

				<div class="header-bottom">
					<div class="mui-segmented-control mui-segmented-control-inverted">
						<a class="mui-control-item mui-active" data-sign="1" href="#item1mobile">
							待付款({{wait_payment}})
						</a>
						<a class="mui-control-item" data-sign="2" href="#item2mobile">
							待发货({{wait_deliver}})
						</a>
						<a class="mui-control-item" data-sign="3" href="#item3mobile">
							已发货({{wait_confirm}})
						</a>
						<a class="mui-control-item" data-sign="4" href="#item4mobile">
							已完成({{finish}})
						</a>
					</div>
					<div id="slider_progressBar" class="slider-progressBar"></div>
				</div>
			</header>
			<div class="mui-content">
				<div id="item1mobile" class="mui-control-content mui-active mui-clearfix">
					<ul class="order-list-groups">
						<li class="order-list" v-for="(al,idx) in await_list" :key="idx">
							<div class="mui-card">
								<div class="mui-card-header">
									<div class="flex-center" @tap="contact(al.user_id,al.user_name,al.user_avatar)">
										<img class="user-head-img" :src="al.user_avatar">
										<span class="user-name">{{al.user_name}}</span>
										<span class="mui-icon mui-icon-arrowright"></span>
									</div>
									<span class="cancel-time">
										<!-- <template v-if="countDown(al.over_time)>0">{{countDown(al.over_time)}}</template>
										<template v-else>0</template> -->
										{{countDown(al.over_time)}}分钟后自动取消
									</span>
								</div>
								<div class="mui-card-content">
									<div class="mui-card-content-inner">
										<div class="order-inside-list" v-for="(item,index) in al.item" :key="index" @tap="openOrderDetail('await',al.id)">
											<div class="inside-list-left">
												<img :src="item.cover">
												<div v-if="al.team_order==1" class="goods-type-sign">
													分销商品
												</div>
											</div>
											<div class="inside-list-right">
												<!-- <p class="mui-ellipsis">{{item.name}}</p> -->
												<div class="specification-cont">
													<div class="specification-left">
														{{item.content}}
													</div>
													<div class="specification-right">
														<span>&yen;{{item.price}}</span>
														<span>x&nbsp;{{item.number}}</span>
													</div>
												</div>
												<div v-if="sales==1&&al.team_order==1" class="distribution-team">
													分销商：{{item.team_info.name}}<span>[{{al.to_user_name}}]</span>
												</div>
												<div v-if="sales==2&&al.team_order==1" class="distribution-team">
													货源：{{item.team_info.name}}
												</div>
												<div v-if="sales==2&&al.team_order==9" class="distribution-team">
													货源：旺客官方
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="mui-card-footer">
									<div class="price-num">
										<span v-if="al.item">共{{al.item.length}}件商品</span>
										<span>待付款：&nbsp;&yen;{{al.total_price}}
											<template v-if="al.freight==0">(包邮)</template>
											<template v-else>(邮费:{{al.freight}})</template>
										</span>
									</div>
									<div v-show="sales==1&&al.team_order==1" class="net-yield">
										净收益：<span class="net-yield-number">&nbsp;&yen;{{al.income}}</span>
									</div>
									<div v-show="sales==2" class="net-yield">
										提成：<span class="net-yield-number">&nbsp;&yen;{{al.commission}}</span>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<div v-show="await_list_status" class="void-list-container">
						<img src="../image/icon/void-data.png">
					</div>
				</div>
				<div id="item2mobile" class="mui-control-content">
					<ul class="order-list-groups">
						<li class="order-list" v-for="(al,idx) in await_sgoods" :key="idx">
							<div class="mui-card">
								<div class="mui-card-header">
									<div class="flex-center" @tap="contact(al.user_id,al.user_name,al.user_avatar)">
										<img class="user-head-img" :src="al.user_avatar">
										<span class="user-name">{{al.user_name}}</span>
										<span class="mui-icon mui-icon-arrowright"></span>
									</div>
									<span class="cancel-time">
										已付款
									</span>
								</div>
								<div class="mui-card-content">
									<div class="mui-card-content-inner">
										<div class="order-inside-list" v-for="(item,index) in al.item" :key="index" @tap="openOrderDetail('sgoods',al.id)">
											<div class="inside-list-left">
												<img :src="item.cover">
												<div v-if="al.team_order==1" class="goods-type-sign">
													分销商品
												</div>
											</div>
											<div class="inside-list-right">
												<p class="mui-ellipsis">{{item.name}}</p>
												<div class="specification-cont">
													<div class="specification-left">
														{{item.content}}
													</div>
													<div class="specification-right">
														<span>&yen;{{item.price}}</span>
														<span>x&nbsp;{{item.number}}</span>
													</div>
												</div>
												<div v-if="sales==1&&al.team_order==1" class="distribution-team">
													分销商：{{item.team_info.name}}<span>[{{al.to_user_name}}]</span>
												</div>
												<div v-if="sales==2&&al.team_order==1" class="distribution-team">
													货源：{{item.team_info.name}}
												</div>
												<div v-if="sales==2&&al.team_order==9" class="distribution-team">
													货源：旺客官方
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="mui-card-footer">
									<div class="price-num">
										<span v-if="al.item">共{{al.item.length}}件商品</span>
										<span>实付款：&nbsp;&yen;{{al.total_price}}
											<template v-if="al.freight==0">(包邮)</template>
											<template v-else>(邮费:{{al.freight}})</template>
										</span>
									</div>
									<div v-show="sales==1&&al.team_order==1" class="net-yield">
										净收益：<span class="net-yield-number">&nbsp;&yen;{{al.income}}</span>
									</div>
									<div v-show="sales==2" class="net-yield">
										提成：<span class="net-yield-number">&nbsp;&yen;{{al.commission}}</span>
									</div>
									<div v-if="sales==1" class="deliver-goods">
										<button type="button" :data-ids="al.id" class="mui-btn mui-btn-outlined deliver-goods-btn">发货</button>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<div v-show="await_sgoods_status" class="void-list-container">
						<img src="../image/icon/void-data.png">
					</div>
				</div>
				<div id="item3mobile" class="mui-control-content">
					<ul class="order-list-groups">
						<li class="order-list" v-for="(al,idx) in send_after" :key="idx">
							<div class="mui-card">
								<div class="mui-card-header">
									<div class="flex-center" @tap="contact(al.user_id,al.user_name,al.user_avatar)">
										<img class="user-head-img" :src="al.user_avatar">
										<span class="user-name">{{al.user_name}}</span>
										<span class="mui-icon mui-icon-arrowright"></span>
									</div>
									<span class="cancel-time">
										已发货
									</span>
								</div>
								<div class="mui-card-content">
									<div class="mui-card-content-inner">
										<div class="order-inside-list" v-for="(item,index) in al.item" :key="index" @tap="openOrderDetail('shipped',al.id)">
											<div class="inside-list-left">
												<img :src="item.cover">
												<div v-if="al.team_order==1" class="goods-type-sign">
													分销商品
												</div>
											</div>
											<div class="inside-list-right">
												<p class="mui-ellipsis">{{item.name}}</p>
												<div class="specification-cont">
													<div class="specification-left">
														{{item.content}}
													</div>
													<div class="specification-right">
														<span>&yen;{{item.price}}</span>
														<span>x&nbsp;{{item.number}}</span>
													</div>
												</div>
												<div v-if="sales==1&&al.team_order==1" class="distribution-team">
													分销商：{{item.team_info.name}}<span>[{{al.to_user_name}}]</span>
												</div>
												<div v-if="sales==2&&al.team_order==1" class="distribution-team">
													货源：{{item.team_info.name}}
												</div>
												<div v-if="sales==2&&al.team_order==9" class="distribution-team">
													货源：旺客官方
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="mui-card-footer">
									<div class="price-num">
										<span v-if="al.item">共{{al.item.length}}件商品</span>
										<span>实付款：&nbsp;&yen;{{al.total_price}}
											<template v-if="al.freight==0">(包邮)</template>
											<template v-else>(邮费:{{al.freight}})</template>
										</span>
									</div>
									<div v-show="sales==1&&al.team_order==1" class="net-yield">
										净收益：<span class="net-yield-number">&nbsp;&yen;{{al.income}}</span>
									</div>
									<div v-show="sales==2" class="net-yield">
										提成：<span class="net-yield-number">&nbsp;&yen;{{al.commission}}</span>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<div v-show="send_after_status" class="void-list-container">
						<img src="../image/icon/void-data.png">
					</div>
				</div>
				<div id="item4mobile" class="mui-control-content">
					<ul class="order-list-groups">
						<li class="order-list" v-for="(al,idx) in finish_list" :key="idx">
							<div class="mui-card">
								<div class="mui-card-header">
									<div class="flex-center" @tap="contact(al.user_id,al.user_name,al.user_avatar)">
										<img class="user-head-img" :src="al.user_avatar">
										<span class="user-name">{{al.user_name}}</span>
										<span class="mui-icon mui-icon-arrowright"></span>
									</div>
									<span class="cancel-time">
										已完成
									</span>
								</div>
								<div class="mui-card-content">
									<div class="mui-card-content-inner">
										<div class="order-inside-list" v-for="(item,index) in al.item" :key="index" @tap="openOrderDetail('finish',al.id)">
											<div class="inside-list-left">
												<img :src="item.cover">
												<div v-if="al.team_order==1" class="goods-type-sign">
													分销商品
												</div>
											</div>
											<div class="inside-list-right">
												<p class="mui-ellipsis">{{item.name}}</p>
												<div class="specification-cont">
													<div class="specification-left">
														{{item.content}}
													</div>
													<div class="specification-right">
														<span>&yen;{{item.price}}</span>
														<span>x&nbsp;{{item.number}}</span>
													</div>
												</div>
												<div v-if="sales==1&&al.team_order==1" class="distribution-team">
													分销商：{{item.team_info.name}}<span>[{{al.to_user_name}}]</span>
												</div>
												<div v-if="sales==2&&al.team_order==1" class="distribution-team">
													货源：{{item.team_info.name}}
												</div>
												<div v-if="sales==2&&al.team_order==9" class="distribution-team">
													货源：旺客官方
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="mui-card-footer">
									<div class="price-num">
										<span v-if="al.item">共{{al.item.length}}件商品</span>
										<span>实付款：&nbsp;&yen;{{al.total_price}}
											<template v-if="al.freight==0">(包邮)</template>
											<template v-else>(邮费:{{al.freight}})</template>
										</span>
									</div>
									<div v-show="sales==1&&al.team_order==1" class="net-yield">
										净收益：<span class="net-yield-number">&nbsp;&yen;{{al.income}}</span>
									</div>
									<div v-show="sales==2" class="net-yield">
										提成：<span class="net-yield-number">&nbsp;&yen;{{al.commission}}</span>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<div v-show="finish_list_status" class="void-list-container">
						<img src="../image/icon/void-data.png">
					</div>
				</div>
				<!-- 发货窗口 -->
				<div class="mui-card deliver-goods-model">
					<div class="mui-card-header">发货</div>
					<div class="mui-card-content">
						<div class="mui-card-content-inner">
							<ul>
								<li class="first-section" id="express_company">
									<span>选择快递</span>
									<span class="express-title mui-navigate-right">{{express_name}}</span>
								</li>
								<li class="second-section">
									<span>快递单号</span>
									<input placeholder="请填写快递单号" v-model="express_num" type="number">
									<div class="scan-btn">
										<img src="../image/icon/order_details_await_sgoods_02.png">
									</div>
								</li>
								<li class="ensure-deliver-goods">
									确认发货
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var userInfo = getUserInfo();
			var pullDirection = "";
			var skip = 1;
			var mask = mui.createMask(function() {
				document.querySelector(".deliver-goods-model").style.display = "none";
			});
			var app = new Vue({
				el: "#mui-content",
				data: {
					// 1为供货订单 2为分销订单
					sales: 1,
					order_sign: 1,
					await_list: [],
					await_sgoods: [],
					send_after: [],
					finish_list: [],
					// 状态
					await_list_status: false,
					await_sgoods_status: false,
					send_after_status: false,
					finish_list_status: false,
					// 数量
					wait_payment: 0,
					wait_deliver: 0,
					wait_confirm: 0,
					finish: 0,
					// 发货相关
					address_detail: '',
					express_id: '',
					express_name: '请选择',
					express_num: '',
					current_id: '',
					// 搜索
					keyword: '',
					isSeek: false
				},
				created: function() {
					// 初始化字体大小
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束	
				},
				methods: {
					// 联系买家
					contact: function(cid, chatName, avatar) {
						if(cid==userInfo.id){
							message("不能和自己联系哟~");
							return false;
						}
						openPage('dialog.html', 'dialog', '#f7f7f7', {
							cid: cid,
							chatName: chatName,
							avatar: avatar,
							barStyle: 'dark'
						});
					},
					// 开始搜索
					starSearch: function() {
						app.isSeek = true;
						setTimeout(function() {
							document.getElementById("search").focus();
						}, 300)
					},
					// 取消搜索
					cancelSearch: function() {
						app.keyword = '';
						app.isSeek = false;
						skip = 1;
						getGoodsList();
					},
					// 打开详情
					openOrderDetail: function(type, id) {
						if (type == "await") {
							openPage('order_details_await_pay.html', 'order_details_await_pay', '#f7f7f7', {
								orderId: id,
								sales: app.sales
							}, "zoom-fade-out")
						} else if (type == "sgoods") {
							openPage('order_details_await_sgoods.html', 'order_details_await_sgoods', '#f7f7f7', {
								orderId: id,
								sales: app.sales
							}, "zoom-fade-out")
						} else if (type == "shipped") {
							openPage('order_details_shipped.html', 'order_details_shipped', '#f7f7f7', {
								orderId: id,
								sales: app.sales
							}, "zoom-fade-out")
						} else {
							openPage('order_details_finish.html', 'order_details_finish', '#f7f7f7', {
								orderId: id,
								sales: app.sales
							}, "zoom-fade-out")
						}
					},
					// 计算取消时间
					countDown: function(endtimer) {
						var startTime = new Date(); // 开始时间
						var endTime = new Date(endtimer);
						var timer = Math.floor((endTime - startTime) / 1000 / 60);
						return timer;
					}
				},
				mounted: function() {
					mui.init({
						swipeBack: false,
						beforeback: function() {
							//plus.navigator.setStatusBarStyle("light");
						},
						pullRefresh: {
							container: "#mui-content",
							up: {
								height: 50,
								auto: false,
								contentrefresh: "正在加载...",
								contentnomore: '没有更多数据了',
								callback: function() {
									pullDirection = "up";
									skip += 1;
									getGoodsList();
								}
							},
							down: {
								style: 'circle',
								color: '#2289FF',
								callback: function() {
									pullDirection = "down";
									mui('#mui-content').pullRefresh().refresh(true);
									skip = 1;
									getGoodsList();
									getOrderNum();
								}
							}
						}
					});

					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						plus.webview.currentWebview().setStyle({
							scrollIndicator: 'none'
						});
						getOrderNum();
						getGoodsList();
						// 重新开启滚动
						mui("body").on('tap', '.mui-btn', function() {
							mui('#mui-content').pullRefresh().setStopped(false);
						})
						mui('body').on('tap', '.mui-backdrop', function() {
							mui('#mui-content').pullRefresh().setStopped(false);
						})
					})
					// 初始化两次防止页面乱
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束
				}
			})
			// 切换订单类型
			mui('.mui-bar').on('tap', '.order-type-item', function() {
				var btn = document.querySelectorAll(".order-type-item");
				for (i = 0; i < btn.length; i++) {
					btn[i].classList.remove("active");
				}
				document.getElementById("bg_full").style.left = this.offsetLeft + 'px';
				this.classList.add("active");
				app.sales = this.dataset.order;
				mui('#mui-content').pullRefresh().refresh(true);
				skip = 1;
				getOrderNum();
				getGoodsList();
			})
			// 切换选项卡
			mui('.mui-bar').on('tap', '.mui-control-item', function() {
				document.getElementById("slider_progressBar").style.left = this.offsetLeft + 'px';
				app.order_sign = this.dataset.sign;
				mui('#mui-content').pullRefresh().refresh(true);
				skip = 1;
				getGoodsList();
			})
			// 发货
			mui(".mui-content").on('tap', '.deliver-goods-btn', function() {
				mask.show();
				app.current_id = this.dataset.ids;
				document.querySelector(".deliver-goods-model").style.display = "block";
				// 为了不让弹出滚动穿透
				document.querySelector(".deliver-goods-model").addEventListener("touchmove", mui.preventDefault);
			})
			// 确认发货
			mui(".mui-content").on('tap', '.ensure-deliver-goods', function() {
				document.activeElement.blur();
				if (app.express_id == '') {
					message('请选择快递！');
					return false;
				}
				if (app.express_num == '') {
					message('请填写快递单号！');
					return false;
				}
				mask.close();
				//发货
				mui.post($ajaxUrl + 'order', {
					action: 'express',
					token: userInfo.token,
					order_id: app.current_id,
					express_id: app.express_id,
					courier_number: app.express_num
				}, function(res) {
					if (res.errno == 0) {
						message('发货成功!');
						setTimeout(function() {
							getOrderNum();
							getGoodsList();
						}, 1500)
					} else {
						message(res.message);
					}
				}, 'json');

			})
			// 选择物流公司
			var userPicker = new mui.PopPicker();
			mui(".mui-content").on('tap', '#express_company', function() {
				mui('#mui-content').pullRefresh().setStopped(true);
				document.activeElement.blur();
				mui.post($ajaxUrl + 'util&action=express_list', {}, function(res) {
					if (res.errno == 0) {
						var data = res.data;
						data.forEach(function(item) {
							item.value = item.id;
							item.text = item.e_name;
							delete item.id;
							delete item.e_name;
						})
						userPicker.setData(data);
						userPicker.show(function(items) {
							mui('#mui-content').pullRefresh().setStopped(false);
							app.express_name = JSON.stringify(items[0].text).replace(/"/g, "");
							app.express_id = items[0].value;
						});
					} else {

					}
				}, 'json');
			})
			// 扫一扫
			mui(".mui-content").on('tap', '.scan-btn', function() {
				fnOpenWin('odd_scan.html', 'odd_scan', {
					statusbar: {
						background: '#000000'
					}
				}, '', 'slide-in-right')
				setStatusBar('#000000', 'light');
			})
			
			// 监听发货成功
			window.addEventListener('deliverSuccess', function(e) {
				getOrderNum();
				getGoodsList();
			}, false);
			
			// 监听扫码内容
			window.addEventListener('doit', function(e) {
				// 转数字
				var cont = parseInt(e.detail.content);
				// 判断是否为数字
				function myIsNaN(value) {
					return typeof value === 'number' && !isNaN(value);
				}
				if (myIsNaN(cont)) {
					app.express_num = cont;
					message("扫码成功！");
				} else {
					setTimeout(function() {
						plus.nativeUI.alert("扫码有误，请重新扫码！");
					}, 500);
				}
			}, false);

			// 获取订单列表
			function getGoodsList() {
				mui.post($ajaxUrl + 'order&action=order_list', {
					token: userInfo.token,
					type: app.sales,
					status: app.order_sign,
					skip: skip,
					limit: 6,
					goods_name: app.keyword
				}, function(res) {
					logs(res);
					if (res.errno == 0) {
						if (skip == 1) {
							if (app.order_sign == 1) {
								app.await_list = res.data;
								app.await_list_status = false;
							} else if (app.order_sign == 2) {
								app.await_sgoods = res.data;
								app.await_sgoods_status = false;
							} else if (app.order_sign == 3) {
								app.send_after = res.data;
								app.send_after_status = false;
							} else {
								app.finish_list = res.data;
								app.finish_list_status = false;
							}
						} else {
							if (app.order_sign == 1) {
								app.await_list = app.await_list.concat(res.data);
								app.await_list_status = false;
							} else if (app.order_sign == 2) {
								app.await_sgoods = app.await_sgoods.concat(res.data);
								app.await_sgoods_status = false;
							} else if (app.order_sign == 3) {
								app.send_after = app.send_after.concat(res.data);
								app.send_after_status = false;
							} else {
								app.finish_list = app.finish_list.concat(res.data);
								app.finish_list_status = false;
							}
						}
						if (pullDirection == "up") {
							mui('#mui-content').pullRefresh().endPullupToRefresh(false);
						} else if (pullDirection == "down") {
							mui('#mui-content').pullRefresh().endPulldownToRefresh();
						}
					} else {
						// 没有拿到数据
						if (skip == 1) {
							if (app.order_sign == 1) {
								app.await_list = [];
								app.await_list_status = true;
							} else if (app.order_sign == 2) {
								app.await_sgoods = [];
								app.await_sgoods_status = true;
							} else if (app.order_sign == 3) {
								app.send_after = [];
								app.send_after_status = true;
							} else { 
								app.finish_list = [];
								app.finish_list_status = true;
							}
						} else {

						}
						if (pullDirection == "up") {
							mui('#mui-content').pullRefresh().endPullupToRefresh(true);
						} else if (pullDirection == "down") {
							mui('#mui-content').pullRefresh().endPulldownToRefresh();
						}
					}
				}, 'json');
			}
			// 获取数量
			function getOrderNum() {
				mui.post($ajaxUrl + 'order&action=order_count', {
					token: userInfo.token,
					type: app.sales
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						app.wait_payment = res.data.wait_payment;
						app.wait_deliver = res.data.wait_deliver;
						app.wait_confirm = res.data.wait_confirm;
						app.finish = res.data.finish;
					} else {}
				}, 'json');
			}
			// 点击键盘的搜索
			document.getElementById("search").addEventListener("keypress", function(event) {
				if (app.keyword == '') {
					message("关键词不能为空");
					return false;
				}
				var keyword = app.keyword.replace(/^\s*|\s*$/g, "");
				if (event.keyCode == "13" && keyword != '') {
					document.activeElement.blur();
					if (app.keyword == '') {
						message("请输入关键词！");
						return false;
					}
					skip = 1;
					getGoodsList();
					event.preventDefault();
				} else {
					// message("请输入用户名或者电话");
				}
			});
		</script>
	</body>

</html>
