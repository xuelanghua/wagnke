<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>动态详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/vip-page.css" rel="stylesheet" />
	</head>

	<body class="mui-hidden">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">动态详情</h1>
		</header>
		<div id="mui-content" class="mui-content dynamics-detail-container">
			<div class="dynamics-title-cont">
				<div class="dynamics-title-left">
					<h2>{{title}}</h2>
					<p><span class="user-name">小飞飞</span><span class="release-time">{{create_time.substring(0,10)}}</span></p>
				</div>
			</div>
			<div class="dynamics-content">
				<p>{{content}}</p>
				<ul class="dynamics-img-group" :class="[cover.length==2||cover.length==5||cover.length==9?'active':'']" v-if="cover.length>0&&cover[0]!=''">
					<li v-for="img in cover"><img :src="img"></li>
				</ul>
			</div>
			<div class="comment-cont" v-if="comment.length>0||likes.length>0">
				<div class="thumbs-cont">
					<img src="../image/icon/give-the-thumbs-up.png">
					<span v-for="lists in likes">{{lists.nickName}}</span>
				</div>
				<div v-if="comment.length>0" class="comment-list">
					<ul>
						<li v-for="lists in comment">
							<p><span>{{lists.nickName}}</span>{{lists.content}}</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script src="../js/mui.zoom.js"></script>
		<script src="../js/mui.previewimage.js"></script>
		<script type="text/javascript">
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			document.querySelector(".mui-hidden").classList.remove("mui-hidden");
			// 初始化字体大小结束
			var tid = 0;
			var muiCont = new Vue({
				el: '#mui-content',
				data: {
					title: "",
					create_time: '',
					likes: [],
					content: '',
					cover: [],
					comment: []
				},
				created: function() {
					userInfo = getUserInfo();
				},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						tid = self.aid;
						getDynamicsDetail();
						setTimeout(function() {
							var images = [].slice.call(document.querySelectorAll('.dynamics-img-group img'));
							logs(muiCont.cover)
							var urls = [];
							images.forEach(function(item) {
								urls.push(item.src);
							});
							mui('.dynamics-img-group').on('tap', 'img', function() {
								var index = images.indexOf(this);
								plus.nativeUI.previewImage(urls, {
									current: index,
									loop: true,
									indicator: 'number'
								});
							});
						}, 200)
					});
				}
			});
			// mui.previewImage();
			mui.init();

			function getDynamicsDetail() {
				mui.post($ajaxUrl + 'timeline&action=detail', {
					token: userInfo.token,
					tid: tid
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						var data = res.data;
						muiCont.title = data.title;
						muiCont.cover = data.cover;
						muiCont.content = data.content;
						muiCont.create_time = data.create_time;
						muiCont.comment = data.comment.data;
						muiCont.likes = data.like.data;
					} else {
						message(res.message)
					}
				}, 'json')
			}
		</script>
	</body>

</html>
