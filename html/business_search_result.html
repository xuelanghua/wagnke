<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style type="text/css">
			body {
				touch-action: pan-y;
			}


			li {
				list-style: none;
				margin: 0;
				padding: 0;
			}

			.mui-row.mui-fullscreen .mui-col-xs-3,
			.mui-row.mui-fullscreen .mui-col-xs-9 {
				height: 100% !important;
				background-color: #FFFFFF;
			}

			.mui-row.mui-fullscreen .mui-col-xs-3 {
				background-color: #DDDDDD;
			}

			.mui-col-xs-3,
			.mui-control-content {
				overflow-y: scroll;
				overflow-x: hidden;
				height: 100%;
				-webkit-overflow-scrolling: touch;
			}

			.mui-segmented-control .mui-control-item {
				line-height: 50px;
				width: 100%;
				color: #999999 !important;
				font-size: 0.26rem;
			}

			.mui-segmented-control .mui-control-item.mui-active {
				color: #333333 !important;
			}

			.mui-plus-pullrefresh .mui-pull-bottom-pocket {
				background-color: #FFFFFF;
			}

			.mui-col-xs-9 {
				overflow-y: scroll;
				overflow-x: hidden;
				height: 100%;
				-webkit-overflow-scrolling: touch;
			}

			.mui-segmented-control {
				padding: 0;
				border: none;
			}

			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item {
				background-color: #F2F2F2;
				border-bottom: none;
				width: 100%;
			}

			.mui-segmented-control.mui-segmented-control-inverted.mui-segmented-control-vertical .mui-control-item.mui-active {
				border-bottom: none;
			}

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				background-color: #ffffff;
			}

			.mui-col-xs-9::-webkit-scrollbar,
			.mui-control-content::-webkit-scrollbar,
			.mui-segmented-control::-webkit-scrollbar,
			.mui-col-xs-3::-webkit-scrollbar {
				display: none;
			}

			.mui-bar-nav~.mui-content {
				padding-top: 86px;
				background-color: #ffffff;
				min-height: 100vh;
			}

			.mui-bar.mui-bar-nav {
				padding-left: 0;
				padding-right: 0;
				box-shadow: none;
				background-color: #FFFFFF;
			}

			.screen-bar {
				height: 40px;
				display: flex;
				background-color: #FFFFFF;
				z-index: 10;
				box-shadow: 0 3px 3px 1px rgba(225, 225, 225, 0.6);
				position: relative;
				overflow: visible;
			}

			.menu-cont {
				padding: 0 10px;
				width: 100%;
				display: flex;
				overflow: hidden;
				z-index: 12;
				position: relative;
				background-color: #FFFFFF;
			}

			.menu-cont.active .search-input {
				border-radius: 14px;
				flex-grow: 1;
			}

			.menu-cont.active form {
				display: flex;
				align-items: center;
				position: relative;
			}

			.search-cont {
				margin-right: 5px;
				width: 40px;
			}

			.menu-cont.active .search-cont {
				position: relative;
				width: 100%;
			}

			.menu-cont .mui-icon-search {
				position: absolute;
				left: 5px;
				font-size: 22px;
				z-index: 9;
			}

			.menu-cont .search-input {
				border-radius: 14px;
				text-align: left;
				width: 20px;
				position: relative;
				height: 28px;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
				flex-shrink: 0;
				margin-right: 5%;
			}

			.menu-cont.active .search-input {
				flex-grow: 1;
				padding-left: 40px;
				padding-right: 30px;
				background-color: #F2F2F2;
				flex-shrink: 0;
				border-radius: 14px;
			}

			.menu-cont.active .search-cont:after {
				content: '';
				background-color: rgba(0, 0, 0, .1);
				width: 1px;
				height: 40%;
				top: 30%;
				left: 32px;
				position: absolute;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
			}

			.search-cont input::-webkit-input-placeholder {
				color: #999999;
				font-size: 0.24rem;
			}

			.mui-action-back.mui-icon.mui-icon-left-nav {
				margin-left: 0;
			}

			.screen-cont {
				display: flex;
				height: 100%;
				align-items: center;
				flex-grow: 1;
				margin: 0;
				opacity: 1;
				-webkit-transform: scale(1);
				transform: scale(1);
				transform-origin: right center;
				-webkit-transform-origin: right center;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
				justify-content: space-between;
			}

			.menu-cont.active .screen-cont {
				margin-right: -100%;
				opacity: 0;
				-webkit-transform: scale(0);
				transform: scale(0);
				transform-origin: right center;
				-webkit-transform-origin: right center;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
			}

			.screen-item {
				margin: 0;
				width: 23%;
				display: flex;
				align-items: center;
				justify-content: center;
				background-color: #F2F2F2;
				padding: 3px 0;
				border-radius: 30px;
				font-size: 12px;
				color: #555555;
				position: relative;
				overflow: visible;
			}

			.screen-item .mui-icon {
				position: relative;
			}

			.mui-bar-nav.mui-bar .mui-icon.mui-icon-arrowdown,
			.mui-bar-nav.mui-bar .mui-icon.mui-icon-arrowup {
				position: relative;
				padding: 0;
				padding-left: 10px;
				font-size: 18px;
			}

			.menu-cont .screen-item.active {
				color: #F5CA3A;
				background-color: #ffffff;
			}

			.menu-cont .screen-item.active:after {
				content: '';
				display: block;
				position: absolute;
				width: 200%;
				height: 200%;
				border: 1px solid #F5CA3A;
				left: 0;
				top: 0;
				border-radius: 60px;
				transform-origin: 0 0;
				-webkit-transform-origin: 0 0;
				transform: scale(0.5, 0.5);
				-webkit-transform: scale(0.5, 0.5);
				box-sizing: border-box;
			}

			.team-select {
				top: -180px;
				position: absolute;
				left: 0;
				width: 100%;
				background-color: #F9F9F9;
				height: 205px;
				padding: 0;
				overflow: hidden;
				-webkit-transition: all 0.25s ease-in-out;
				transition: all 0.25s ease-in-out;
				display: block;
				z-index: 8;
				padding-bottom: 44px;
			}

			.team-select.active {
				top: 40px;
			}

			.team-select .mui-table-view {
				background: transparent;
			}

			.mui-table-view:before,
			.team-select .mui-table-view:after {
				height: 0;
			}

			.team-select .mui-table-view-cell {
				text-align: center;
			}

			.team-select .mui-table-view-cell.mui-active {
				background-color: #f2f2f2;
			}

			.team-select .mui-table-view-cell:after {
				left: 10px;
				right: 0;
				background-color: #F1F1F1;
			}

			.mui-backdrop {
				z-index: 9;
			}

			.team-list {
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 14px;
				position: relative;
				padding: 10px;
				background-color: #F9F9F9;
			}

			.team-list.active {
				color: #F5CA3A;
			}

			.team-list.active span {
				display: inline-flex;
				position: relative;
				font-size: 14px;
			}

			.team-list.active span:after {
				content: '';
				display: inline-block;
				width: 18px;
				height: 15px;
				position: absolute;
				background: url('../image/icon/draw-icono.png')center center no-repeat;
				background-size: contain;
				right: -25px;
			}

			/* 主力商品 */
			.primary-goods {
				padding-top: 0.2rem;
				background-color: #FFFFFF;
			}

			.goods-img img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			.change-list {
				font-size: 0.3rem;
				color: #CC9C2D;
			}

			.bottom-btn {
				position: absolute;
				bottom: 0;
				width: 100%;
				height: 44px;
				background-color: #FFFFFF;
				display: flex;
				align-items: center;
				justify-content: space-between;
				z-index: 10;
			}

			.bottom-btn:after {
				content: '';
				position: absolute;
				display: block;
				bottom: 0;
				width: 100%;
				height: 1px;
				background-color: #DDDDDD;
				transform: scaleY(0.5);
				-webkit-transform: scaleY(0.5);
			}

			.bottom-btn div {
				width: 50%;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				position: relative;
				color: #333333;
				font-size: 0.3rem;
			}

			.mui-scroll-wrapper {
				bottom: 44px;
			}

			.bottom-btn .right-btn {
				color: #F5CA3A;
			}

			.bottom-btn .right-btn:before {
				content: '';
				position: absolute;
				display: block;
				bottom: 0;
				left: 0;
				width: 1px;
				height: 80%;
				background-color: #DDDDDD;
				transform: scaleX(0.5);
				-webkit-transform: scaleX(0.5);
			}

			.mui-backdrop {
				background-color: rgba(0, 0, 0, 0.3);
			}

			.loading-more,
			.void-more {
				display: flex;
				padding: 0.3rem 0.2rem;
				font-size: 0.24rem;
				color: #999999;
				align-items: center;
				justify-content: center;
			}

			.void-more {
				font-size: 0.24rem;
			}

			.mui-bar-nav.mui-bar .mui-action-back {
				margin-right: 5px;
				padding-left: 5px;
				padding-right: 5px;
				color: #191919;
			}

			.mui-bar-nav.mui-bar .mui-icon-clear {
				position: absolute;
				right: 48px;
				font-size: 20px;
				color: #999999;
			}
			.cancel-btn {
				height: 36px;
				width: 40px;
				line-height: 36px;
				text-align: right;
				font-size: 15px;
				color: #666666;
				flex-shrink: 0;
			}

			.goods-container {
				padding: 0 0.2rem;
				background-color: #ffffff;
			}

			.goods-container.active {
				padding: 0.3rem 0.2rem 0;
			}

			.title-container {
				display: flex;
				align-items: center;
				justify-content: space-between;
				background-color: #FFFFFF;
				height: 44px;
				width: 100%;
				z-index: 99;
				position: relative;
				padding-right: 10px;
			}

			.change-list-cont {
				height: 100%;
				padding: 0 15px;
				margin-right: -5px;
				display: flex;
				align-items: center;
				justify-content: center;
				position: relative;
				z-index: 1045;
			}

			.change-list-style {
				width: 19px;
				height: auto;
			}

			.mui-table-view {
				background-color: #ffffff;
			}

			.goods-container .mui-table-view .mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			.goods-container .mui-table-view-cell:after {
				left: 85px;
				background-color: #DDDDDD;
			}

			.goods-container .mui-table-view:before,
			.goods-container .mui-table-view:after {
				height: 0;
			}

			.goods-container .mui-table-view-cell:last-child:after {
				height: 1px;
			}

			.goods-container .mui-table-view .mui-table-view-cell {
				padding: 15px 0;
				display: flex;
				align-items: center;
			}


			.goods-container .goods-img {
				width: 1.62rem;
				height: 1.62rem;
				display: flex;
				overflow: hidden;
				flex-shrink: 0;
				margin-right: 0.2rem;
			}

			.goods-container .goods-title {
				margin-bottom: 0.1rem;
				min-height: 0.8rem;
				display: flex;
				align-items: center;
			}

			.goods-container .goods-title p {
				font-size: 0.28rem;
				color: #333333;

				line-height: 1.4;
			}

			.goods-container .price {
				color: #F52E20;
				font-size: 0.24rem;
			}

			.goods-container .source-cont {
				color: #999999;
				font-size: 0.24rem;
				display: flex;
				align-items: center;
				line-height: 1;
				padding-top: 5px;
			}

			.goods-container .mui-icon-arrowright {
				font-size: 0.32rem;
			}

			.sign {
				height: 0.3rem;
				margin-top: 5px;
			}

			.goods-container.active {
				background-color: #F2F2F2;
			}

			.goods-container.active .mui-table-view {
				display: flex;
				justify-content: space-between;
				flex-wrap: wrap;
				background: transparent;
			}

			.goods-container.active .mui-table-view .mui-table-view-cell {
				display: inline-flex;
				flex-direction: column;
				width: 3.45rem;
				background-color: #007AFF;
				margin-bottom: 0.2rem;
				border-radius: 0.2rem;
				overflow: hidden;
				background-color: #FFFFFF;
				padding: 0;
				/* box-shadow: 2px 2px 3px 0px rgba(225,225,225,.6); */
			}

			.goods-container.active .goods-img {
				margin: 0;
				padding: 0;
				font-size: 0;
				line-height: 0;
				/* margin-bottom: 0.1rem; */
			}

			.goods-container.active .goods-info {
				padding: 0.1rem;
			}

			.goods-container.active .mui-table-view-cell:after {
				display: none;
			}

			.goods-container.active .goods-img {
				width: 100%;
				height: 3.31rem;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>
	<body>
		<div id="mui-content" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<div class="title-container">
					<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
					<h1 class="mui-title">{{pageTitle}}</h1>
					<div class="change-list-cont">
						<img v-show="listStyle" class="change-list-style" src="../image/icon/list-style-icon.png">
						<img v-show="!listStyle" class="change-list-style" src="../image/icon/card-style-icon.png">
					</div>
				</div>
				<div class="screen-bar">
					<div class="menu-cont">
						<!-- active -->
						<div class="mui-input-row search-cont">
							<form action="" onsumit="return false">
								<span class="mui-icon mui-icon-search"></span>
								<input class="search-input" v-model="keyword" type="search" id="search" placeholder="输入商品名称">
								<span class="mui-icon mui-icon-clear" v-show="keyword" @tap="keyword=''"></span>
								<span class="cancel-btn">取消</span>
							</form>
						</div>
						<div class="screen-cont">
							<div class="screen-item" :class="[currentIndex==t.id?'active':'']" v-for="(t,i) in options" @tap="filtrateGoods(i,t.id)">{{t.title}}<span
								 v-if="t.id==4" class="mui-icon" :class="currentIndex==3?'mui-icon-arrowup':'mui-icon-arrowdown'"></span></div>
						</div>
					</div>
					<!-- 下拉仓库选择 -->
					<div class="team-select">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<li class="mui-table-view-cell team-list" :class="[c.id==currentId?'active':'']" v-for="(c,i) in category"
									 @tap="changeCategory(c.id,c.title)" :key="i">
										<span>{{c.title}}</span>
									</li>
								</ul>
							</div>
						</div>
						<div class="bottom-btn">
							<div class="left-btn">取消</div>
							<div class="right-btn">确定</div>
						</div>
					</div>
				</div>
			</header>
			<!-- 内容区 -->
			<div class="mui-content">
				<div class="goods-container" :class="listStyle?'':'active'">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" v-for="i in 11">
							<div class="goods-img">
								<img src="../image/5E0eH.png">
							</div>
							<div class="goods-info">
								<div class="goods-title">
									<p class="mui-ellipsis-2">
										棉田园风风四件套全棉
									</p>
								</div>
								<div class="price">提成：&yen;50.00</div>
								<!-- 官方 -->
								<!-- <img class="sign" src="../image/discover/official-sign.png"> -->
								<!-- 个人 -->
								<div class="source-cont">店长：马飞飞<span class="mui-icon mui-icon-arrowright"></span></div>
								<!-- 团队 -->
								<div class="source-cont mui-hidden">团队：蓝精灵<span class="mui-icon mui-icon-arrowright"></span></div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/Zepto.min.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var userInfo = getUserInfo(),
				skip = 1,
				limit = 6,
				refresh = "";
			var mask = mui.createMask(function() {
				$('.team-select').removeClass("active");
			});
			var app = new Vue({
				el: "#mui-content",
				data: {
					classified: [],
					goods_list: [],
					void_tips: false,
					keyword:'',
					ltype: 1,
					sort_type: '',
					has_more: false,
					currentIndex: 0,
					currentId: 0,
					pageTitle: '商脉',
					listStyle: false,
					searchHistory:[],
					options: [{
						title: "销量",
						id: "1"
					}, {
						title: "价格",
						id: "2"
					}, {
						title: "好评度",
						id: "3"
					}, {
						title: "全部",
						id: "4"
					}],
					category: [{
						title: "全部",
						id: "4"
					}, {
						title: "个人",
						id: "5"
					}, {
						title: "企业仓",
						id: "6"
					}, {
						title: "旺客总仓",
						id: "7"
					}]
				},
				created: function() {
					// 初始化字体大小
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束	
				},
				methods: {
					openGoodsDetail: function(gid) {
						openPage('distributor_goods_detail.html', 'distributor_goods_detail', '#f7f7f7', {
							gid: gid
						})
					},
					// 点击筛选
					filtrateGoods: function(idx, _id) {
						if (_id == 4) {
							app.currentIndex = _id;
							mask.show();
							$('.team-select').addClass("active");
							return false;
						}
						mask.close();
						if (app.currentIndex == _id) {
							app.currentIndex = '-1';
						} else {
							app.currentIndex = _id;
							app.currentId = _id;
						}

					},
					changeCategory: function(_id, _nm) {
						app.currentId = _id;
						app.options[3].title = _nm;
					}
				},
				mounted: function() {
					mui(".mui-scroll-wrapper").scroll().refresh();
					mui.init({
						swipeBack: false,
					});
					// 初始化两次防止页面乱
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						plus.navigator.setStatusBarStyle("dark");
						// 获取搜索记录
						var searchHistory = JSON.parse(plus.storage.getItem('buisnesHistory'));
						if (searchHistory) {
							app.searchHistory = searchHistory;
						}
					})
					// 监听搜索
					document.getElementById("search").addEventListener("keypress", function(event) {
						var keywords = app.keyword.replace(/^\s*|\s*$/g, "");
						if (event.keyCode == "13") {
							if (keywords != '') {
								plus.key.hideSoftKeybord();
								var idx = app.searchHistory.indexOf(keywords);
								//没有则返回-1
								if (idx == -1) {
									app.searchHistory.unshift(keywords);
									if (app.searchHistory.length > 12) {
										app.searchHistory = app.searchHistory.splice(0, 12);
										plus.storage.setItem('buisnesHistory', JSON.stringify(app.searchHistory));
										mui.fire(plus.webview.currentWebview().opener(), 'renewal', {
											searchHistory: app.searchHistory
										});
									} else {
										plus.storage.setItem('buisnesHistory', JSON.stringify(app.searchHistory));
										mui.fire(plus.webview.currentWebview().opener(), 'renewal', {
											searchHistory: app.searchHistory
										});
									}
								} else {
									startSearch();
								}
								// 阻止页面刷新
								event.preventDefault();
							} else {
								message("请输入关键词！");
								// 阻止页面刷新
								event.preventDefault();
							}
						} else {
							// 点的不是搜索按钮
						}
					});
				}
			})
			// 点击搜索按钮
			mui(".mui-bar").on('tap', ".mui-icon-search", function() {
				mui(".menu-cont")[0].classList.add("active");
				mui(".search-cont input")[0].focus();
				app.currentIndex = -1;
				mask.show();
			})
			// 取消搜索
			mui(".mui-bar").on('tap', ".cancel-btn", function() {
				mui(".menu-cont")[0].classList.remove("active");
				mui(".search-cont input")[0].blur();
				mask.close();
			})
			// 取消仓库选择
			mui(".mui-bar").on('tap', ".left-btn", function(e) {
				mask.close();
			})
			// 确认仓库选择
			mui(".mui-bar").on('tap', ".right-btn", function(e) {
				mask.close();
				logs(app.currentId);
			})
			// 获取商品类型
			function getGoodsType() {
				mui.post($ajaxUrl + 'goods', {
					action: 'goods_category',
					token: userInfo.token
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						app.classified = res.data;
					}
				}, 'json');
			}

			// 获取产品列表
			function getGoodsList() {
				mui.post($ajaxUrl + 'goods', {
					token: userInfo.token,
					action: 'team_goods_list',
					type: app.ltype,
					sort_type: app.sort_type,
					goods_name: app.keyword,
					team: app.team.join(','),
					skip: skip,
					limit: limit
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						if (skip == 1) {
							app.goods_list = res.data;
							// if (refresh == 'down') {
							// 	mui('#segmentedControlContents').pullRefresh().endPulldownToRefresh();
							// }
						} else {
							app.goods_list = app.goods_list.concat(res.data);
							// mui('#segmentedControlContents').pullRefresh().endPullupToRefresh(false);
						}
						app.void_tips = false;
						app.has_more = res.extra.has_more;
					} else {
						app.has_more = false;
						if (skip == 1) {
							app.goods_list = [];
							app.void_tips = true;
						}
					}
				}, 'json');
			}
			// 加载更多
			mui(".mui-content").on("tap", ".loading-more", function() {
				skip += 1;
				getGoodsList();
			})
			mui('.mui-bar').on('tap', '.change-list-style', function() {
				app.listStyle = !app.listStyle;
			})
		</script>
	</body>

</html>
