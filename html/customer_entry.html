<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.dtpicker.css" rel="stylesheet" />
		<style>
			.clearfix{
				clear: both;
			}
			.mui-bar,.mui-content,body{
				background-color: #FFFFFF;
			}
			.customer_title{
				padding: 10px 0;
				font-size: 14px;
				text-align: center;
			}
			.customer_title div{
				width: 50%;
			}
			.customer_title img{
				height: 19px;
			}
			.customer_title span{
				display: block;
			}
			.nr,.nrs{
				padding: 5px 0;
			}
			.nr{
				border-right: 1px solid #F2F2F2;
			}
			
			.title_name{
				padding: 12px 10px;
				color: #2289FF;
				background-color: #F5F5F5;
			}
			.conetnt_list{
				padding: 5px 0;
				margin-left: 10px;
				font-size: 15px;
				border-bottom: 1px solid #F2F2F2;
			}
			.name{
				margin-top: 10px;
			}
			.conetnt_list input{
				width: 95%;
				padding: 0 5px 0 0;
				margin: 0;
				border: none;
				font-size: 15px;
				text-align: right;
				color: #999999;
			}
			.conetnt_list1{
				padding: 6px 10px 6px 0;
				margin-left: 10px;
				font-size: 15px;
				border-bottom: 1px solid #F2F2F2;
			}
			.conetnt_list1 input{
				width: 95%;
				padding: 0 5px 0 0;
				margin: 0;
				border: none;
				font-size: 15px;
				text-align: right;
				color: #999999;
			}
			.conetnt_list1 img{
				width: 7px;
				height: 12px;
				margin-top: 15px;
			}
			
			.conetnt_list input {
				width: 200px;
				margin-right: 8px;
			}
			.underline {
				color: red;
			}
			.mui-btn-primary.contact{
				background-color: #2289ff;
				width: 90%;
				margin-left: 5%;
				border: none;
				outline: none;
				height: 42px;
				padding: 0;
				font-size: 15px;
				margin-bottom: 30px;
			}
			.mui-btn-primary.contact:before,.mui-btn-primary.contact:after{
				display: none;
				box-shadow: none;
				border: none;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">客户录入</h1>
			<span class="mui-pull-right" style="margin-top: 11px;font-size: 15px;" id="save">保存</span>
		</header>

		<div class="mui-content">
			<!-- <div class="customer_title">
				<div class="mui-pull-left nr contact">
					<img src="../image/customerL.png">
					<span>通讯录录入</span>
				</div>
				<div class="mui-pull-right nrs">
					<img src="../image/customerR.png">
					<span>扫名片</span>
				</div>
				<div class="clearfix"></div>
			</div> -->

			<div class="title_name">
				联系信息
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">客户姓名<span class="underline">*</span></span>
				<span class="mui-pull-right">
					<input maxlength="5" type="text" name="name" />
				</span>
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">电话<span class="underline">*</span></span>
				<span class="mui-pull-right">
					<input maxlength="11" type="tel" name="mobile" />
				</span>
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">地址</span>
				<span class="mui-pull-right">
					<input type="text" name="address" />
				</span>
				<div class="clearfix"></div>
			</div>

			<div class="title_name">
				基本信息
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">公司名称<span class="underline">*</span></span>
				<span class="mui-pull-right">
					<input maxlength="13" type="text" name="company" />
				</span>
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">职位<span class="underline">*</span></span>
				<span class="mui-pull-right">
					<input maxlength="6" type="text" name="job" />
				</span>
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list">
				<span class="mui-pull-left name">所属行业</span>
				<span class="mui-pull-right">
					<input maxlength="6" type="text" name="industry" />
				</span>
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list1" data-type="birthday">
				<span class="mui-pull-left name">生日</span>
				<span class="mui-pull-right">
					<img src="../image/Marketing-codea.png">
				</span>
				<input type="text" name="birthday" class="mui-pull-right" style="width: 120px;" readonly value="">
				<div class="clearfix"></div>
			</div>
			<div class="conetnt_list1" data-type="anniversary">
				<span class="mui-pull-left name">纪念日</span>
				<span class="mui-pull-right">
					<img src="../image/Marketing-codea.png">
				</span>
				<input type="text" name="anniversary" class="mui-pull-right" style="width: 120px;" readonly value="">
				<div class="clearfix"></div>
			</div>
			<div style="text-align: center;margin-top: 25px;">
				<button type="button" class="mui-btn mui-btn-primary mui-btn-block contact">从通讯录导入</button>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.dtpicker.js"></script>
		<script src="../js/util.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				beforeback: function() {
					plus.navigator.setStatusBarStyle('light');
				}
			})

			var submitFlag = true;
			var userInfo = null;
			var self = null;
			var cid = 0;
			var type = 2;
			mui.plusReady(function() {
				getContactsInit();
				userInfo = getUserInfo();
				self = plus.webview.currentWebview();
				cid = self.cid;
				if (cid > 0) {
					type = 1;
				}
				mui('.mui-content').on('tap', '.conetnt_list1', function() {
					var type = this.dataset.type;
					var dt = datePick(function(e) {
						document.querySelector('input[name=' + type + ']').value = e.value;
					})
				})

				mui('.mui-content').on('tap', '.contact', function() {
					nativeCommon.contacts.getContact(function(name, phoneNumber){
						mui('input[name=name]')[0].value = name;
						mui('input[name=mobile]')[0].value = phoneNumber;
					});
				})

				document.getElementById('save').addEventListener('tap', function() {
					if (!submitFlag) return;
					var submitData = {
						name: document.querySelector('input[name=name]').value,
						mobile: document.querySelector('input[name=mobile]').value,
						address: document.querySelector('input[name=address]').value,
						company: document.querySelector('input[name=company]').value,
						job: document.querySelector('input[name=job]').value,
						industry: document.querySelector('input[name=industry]').value,
						birthday: document.querySelector('input[name=birthday]').value,
						anniversary: document.querySelector('input[name=anniversary]').value,
					}
					if (type == 1) {
						submitData.uid = cid;
					}
					if (submitData.name.length == 0) {
						message('请输入姓名!');
						return;
					}
					if (submitData.mobile.length == 0) {
						message('请输入电话!');
						return;
					}
					if (!/^1[\d]{10}$/.test(submitData.mobile)) {
						message('电话输入错误!');
						return;
					}
					if (submitData.company.length == 0) {
						message('请输入公司名称!');
						return;
					}
					if (submitData.job.length == 0) {
						message('请输入职位!');
						return;
					}
					logs(submitData);
					fnSubmit(submitData);
				})
			})

			function datePick(callback) {
				var dtpicker = new mui.DtPicker({
					type: "date", //设置日历初始视图模式
					value: "1990-09-16",
					beginDate: new Date(1930, 01, 01), //设置开始日期 
					endDate: new Date(2018, 12, 31), //设置结束日期 
					labels: ['年', '月', '日'], //设置默认标签区域提示语 
				})
				dtpicker.show(function(e) {
					callback(e);
				})
			}

			//提交数据
			function fnSubmit(data) {
				submitFlag = false;
				if (cid != 0) {}
				// plus.nativeUI.showWaiting('数据处理中!', 'div');
				mui.post($ajaxUrl + 'customer', {
					action: 'add',
					type: type,
					token: userInfo.token,
					data: data
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						message('录入成功!');
						mui.fire(plus.webview.getWebviewById('crm'), 'refreshCrm');
						setTimeout(function() {
							plus.webview.close('customer_entry');
						}, 2000);
					} else {
						message(res.message);
						submitFlag = true;
					}
					// showload(1);
				}, 'json')
			}
		</script>
	</body>
</html>
