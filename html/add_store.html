<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<style type="text/css">
			.save-edit {
				background-color: #f5ca3a;
				height: 42px;
				padding: 0;
				width: 94%;
				margin: 30px 3% 0;
				border-color: #f5ca3a;
				border-radius: 5px;
				font-size: 15px;
			}

			.mui-table-view-cell {
				min-height: 50px;
				padding: 0 10px;
				display: flex;
				align-items: center;
				font-size: 15px;
				position: relative;
				width: 100%;
				overflow: hidden;
			}

			.mui-table-view-cell .mui-icon {
				font-size: 32px;
				font-weight: 700;
				color: #333333;
			}

			.mui-table-view-cell input::-webkit-input-placeholder {
				font-size: 14px;
				color: #999999;
			}

			.mui-table-view-cell input {
				width: auto;
				margin-bottom: 0;
				padding: 0;
				height: auto;
				flex-grow: 1;
				border: none;
				font-size: 15px;
				color: #333;
				min-height: 50px;
			}

			.mui-table-view-cell .title {
				margin-right: 10px;
				color: #333333;
				flex-shrink: 0;
			}

			.mui-table-view-cell:after {
				background-color: #DDDDDD;
			}

			.mui-table-view-cell.mui-active {
				background-color: #F9F9F9;
			}

			.mui-navigate-right {
				color: #333333;
			}

			.mui-table-view-cell .mui-icon.mui-icon-location-filled {
				color: #f5ca3a;
				font-weight: bold;
				font-size: 16px;
			}

			.gray-tips {
				color: #999999;
			}

			.address {
				flex-grow: 1;
				word-wrap: wrap;
				padding-right: 5px;
			}

			.select-all {
				width: 56px;
				height: 21px;
				background-color: #F2F2F2;
				font-size: 12px;
				color: #333333;
				border-radius: 15px;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				line-height: 1;
				margin-top: -21px;
			}

			.business-head {
				padding: 30px 15px;
				border-bottom: 1px solid #F2F2F2;
			}

			.business-head h4 {
				margin: 0;
				padding: 0;
				font-weight: normal;
			}

			.select-all span:before {
				content: '';
				width: 9.5px;
				height: 9.5px;
				display: inline-block;
				margin-right: 5px;
				background: url('../image/icon/select-sign.png')center center no-repeat;
				background-size: contain;
			}

			.select-all.active {
				color: #FFFFFF;
				background-color: #F5CA3A;
			}

			.select-all.active span:before {
				background: url('../image/icon/select-sign-active.png')center center no-repeat;
				background-size: contain;
			}

			.business-hours {
				width: 90%;
				background-color: #FFFFFF;
				overflow: hidden;
				position: fixed;
				left: 5%;
				top: 28%;
				z-index: 1001;
				box-sizing: border-box;
				border-radius: 10px;
			}

			.business-body {
				display: flex;
				width: 100%;
				flex-wrap: wrap;
				justify-content: center;
				padding: 40px 10px 20px;
				box-sizing: border-box;
				border-bottom: 1px solid #F2F2F2;
			}

			.select-items {
				display: inline-flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				font-size: 14px;
				color: #999999;
				border: 1px solid #f2f2f2;
				border-radius: 5px;
				width: 23%;
				padding: 2px 5px 0;
				margin-right: 5px;
				margin-bottom: 15px;
				line-height: 1.4;
			}

			.select-items.active {
				color: #F5CA3A;
				background-color: #FFF3CC;
				border-color: #F5CA3A;
			}

			.select-items.active span:last-of-type {
				color: #F5CA3A;
			}

			.select-items span:last-of-type {
				color: #999999;
				font-size: 10px;
			}

			.opction-cont {
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px 0;
			}

			.opction-cont .mui-btn {
				width: 30%;
				border: none;
				color: #FFFFFF;
				background-color: #999999;
				padding: 0;
				line-height: 1;
				height: 36px;
				display: inline-flex;
				align-items: center;
				justify-content: center;
			}

			.opction-cont .mui-btn:enabled:active {
				border: none;
			}

			.opction-cont .mui-btn-blue {
				margin-left: 35px;
				background-color: #F5CA3A;
			}

			.opction-cont .mui-btn.mui-btn-blue:enabled:active {
				background-color: #d2a921;
			}

			.mui-bar {
				background-color: #FFFFFF;
			}

			.part-line {
				display: inline-block;
				height: 1px;
				width: 30px;
				background-color: #DDDDDD;
				margin: 0 5px;
				border-radius: 2px;
			}

			.opening-time,
			.closing-time {
				display: inline-block;
				width: 60px;
				height: 50px;
				line-height: 50px;
				text-align: center;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>

	<body>
		<div id="mui-content" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
				<h1 class="mui-title">添加门店</h1>
			</header>
			<div class="mui-content">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<span class="title">门店名称</span>
						<input type="text" v-model="store_name" placeholder="请输入门店名称（18字以内）">
					</li>
					<li class="mui-table-view-cell" @tap="showModel">
						<span class="title">营业日</span>
						<span v-if="select_week.length==0" class="gray-tips">请选择</span>
						<span>
							<template v-for="(d,i) in select_week" :key="i">{{d.zh}}
								<template v-if="i<select_week.length-1">、</template>
							</template>
						</span>
						<span class="mui-navigate-right"></span>
					</li>
					<li class="mui-table-view-cell">
						<span class="title">营业时间</span>
						<span class="opening-time" :class="opening_time=='请选择'?'gray-tips':''" @tap="choiceTimer('opening_time')">{{opening_time}}</span>
						<span class="part-line"></span>
						<span class="closing-time" :class="closing_time=='请选择'?'gray-tips':''" @tap="choiceTimer('closing_time')">{{closing_time}}</span>
						<span class="mui-navigate-right"></span>
					</li>
					<li class="mui-table-view-cell">
						<span class="title">电话</span>
						<input type="number" v-model="phone" placeholder="输入客服电话">
					</li>
					<li class="mui-table-view-cell">
						<span class="title">联系人</span>
						<input type="text" v-model="linkman" placeholder="输入联系人">
					</li>
					<li class="mui-table-view-cell" id="get_address">
						<span class="title">选择地址</span>
						<span class="gray-tips">点击获取</span>
						<span class="address">{{detail_address}}</span>
						<span class="mui-icon mui-icon-location-filled"></span>
					</li>
					<li class="mui-table-view-cell">
						<span class="title">详细地址</span>
						<input v-model="address_detail" type="text" placeholder="填写详细地址">
					</li>
				</ul>
				<button type="button" class="mui-btn mui-btn-warning mui-btn-block save-edit" @tap="addStore">保存</button>
			</div>
			<!-- 营业时间弹窗 -->
			<div class="business-hours" v-show="is_show">
				<div class="business-head">
					<h4 class="mui-text-center">选择营业日</h4>
					<div class="select-all mui-pull-right" :class="select_all?'active':''" @tap="selectAll">
						<span>全选</span>
					</div>
				</div>
				<div class="business-body">
					<div class="select-items" :class="w.s?'active':''" v-for="(w,index) in week" :key="index" @tap="selectItems(index)">
						<span>{{w.zh}}</span>
						<span>{{w.en}}</span>
					</div>
				</div>
				<div class="opction-cont">
					<button type="button" class="mui-btn mui-btn-gray">取消</button>
					<button type="button" class="mui-btn mui-btn-blue">确定</button>
				</div>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var userInfo = getUserInfo();
			var mask = mui.createMask(function() {
				app.is_show = false;
			});
			var app = new Vue({
				el: "#mui-content",
				data: {
					detail_address: '',
					is_show: false,
					select_all: false,
					select_week: [],
					week: [{
						zh: "周一",
						en: 'Monday',
						id: 1,
						s: false
					}, {
						zh: "周二",
						en: 'Tuesday',
						id: 2,
						s: false
					}, {
						zh: "周三",
						en: 'Wednesday',
						id: 3,
						s: false
					}, {
						zh: "周四",
						en: 'Thursday',
						id: 4,
						s: false
					}, {
						zh: "周五",
						en: 'Friday',
						id: 5,
						s: false
					}, {
						zh: "周六",
						en: 'Saturday',
						id: 6,
						s: false
					}, {
						zh: "周日",
						en: 'weekday',
						id: 7,
						s: false
					}],
					business_hours: [],
					store_name: '',
					opening_time: '请选择',
					closing_time: '请选择',
					linkman: '',
					phone: '',
					address: '云南省昆明市官渡区',
					address_detail: '云南省昆明市官渡区昌宏西路高原明珠商务楼a座701',
					longitude: '102.753138',
					latitude: '24.986966',
					shop_id: ''
				},
				methods: {
					showModel: function() {
						this.is_show = true;
						mask.show();
					},
					selectAll: function() {
						var _this = this;
						_this.select_all = !_this.select_all;
						if (_this.select_all) {
							for (var i = 0; i < _this.week.length; i++) {
								_this.week[i].s = true;
							}
						} else {
							for (var i = 0; i < _this.week.length; i++) {
								_this.week[i].s = false;
							}
						}
					},
					selectItems(i) {
						var _this = this;
						_this.week[i].s = !_this.week[i].s;
						if (!_this.week[i].s) {
							_this.select_all = false;
						}
					}
				},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						var datas = self.datas;
						logs(datas); 
						if (datas) {
							app.store_name = datas.name
							app.opening_time = datas.opening_time
							app.closing_time = datas.closing_time
							app.linkman = datas.linkman
							app.phone = datas.phone
							app.address = datas.address
							app.address_detail = datas.address_detail
							app.shop_id = datas.shop_id
						}
						mui('#mui-content').on('tap', '#get_address', function() {
							// var choice_address = plus.webview.create("choice_address.html", "choice_address");
							// choice_address.addEventListener('loaded', function() {
							// 	choice_address.show('zoom-fade-out');
							// })
							var choice_address = plus.webview.create("choose_address.html", "choose_address");
							choice_address.addEventListener('loaded', function() { 
								choice_address.show('zoom-fade-out');
							})
						})
					})
				}
			})
			mui('#mui-content').on('tap', '.mui-btn-gray', function() {
				mask.close();
			})
			mui('#mui-content').on('tap', '.mui-btn-blue', function() {
				app.select_week = [];
				for (var i = 0; i < app.week.length; i++) {
					if (app.week[i].s) {
						app.business_hours.push(app.week[i].id);
						app.select_week.push(app.week[i]);
					}
				}
				mask.close();
			})
			// 添加门店
			function addStore() {
				if (app.store_name == '') {
					message("请输入门店名称！");
					return false;
				}
				if (app.business_hours.length < 1) {
					message("请选择营业时间！");
					return false;
				}
				if (app.opening_time == '请选择') {
					message("请选择开始营业时间！");
					return false;
				}
				if (app.closing_time == '请选择') {
					message("请选择结束营业时间！");
					return false;
				}
				if (app.phone == '') {
					message("请填电话！");
					return false;
				}
				if (app.linkman == '') {
					message("请填写联系人！");
					return false;
				}
				if (app.address == '') {
					message("请选择地址！");
					return false;
				}
				if (app.address_detail == '') {
					message("请填写详细地址！");
					return false;
				}
				var datas = {
					token: userInfo.token,
					name: app.store_name,
					business_hours: app.business_hours,
					opening_time: app.opening_time,
					closing_time: app.closing_time,
					linkman: app.linkman,
					phone: app.phone,
					address: app.address,
					address_detail: app.address_detail,
					longitude: app.longitude,
					latitude: app.latitude,
					shop_id: app.shop_id //编辑传入门店id
				}
				mui.post($ajaxUrl + 'shop&action=add', datas, function(res) {
					if (res.errno == 0) {
						message("保存成功！");
						setTimeout(function() {
							mui.back();
						}, 1000)
					} else {
						message(res.message);
					}
				}, 'json');
			}
			// alert(JSON.stringify(res));
			var picker = null;

			function choiceTimer(obj) {
				if (picker) {
					picker.show(function(rs) {
						app[obj] = rs.value;
						picker.dispose();
						picker = null;
					});
				} else {
					picker = new mui.DtPicker({
						type: 'time'
					});
					picker.show(function(rs) {
						app[obj] = rs.value;
						// alert(JSON.stringify(rs))
					});
				}
			}
		</script>
	</body>

</html>
