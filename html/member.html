<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>会员中心</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style>
			.mui-bar{
				background-color: #FFFFFF;
				box-shadow: none;
			}
			.mui-content,body{
				background-color: #F5F5F5;
			}
			.clearfix{
				clear: both;
			}
			.member{
				height: 208px;
				background-color: #000000;
			}
			.member_chart{
				margin: -250px auto 0;
				text-align: center;
			}
			.member_chart img{
				width: 331px;
			}
			.member_title,.member_time{
				position: relative;
				top: 120px;
				font-size: 28px;
				left: -74px;
				color: #496187;
			}
			.member_time{
				top: 139px;
				font-size: 12px;
			}
			.member_chart_number,.button{
				width: 80%;
				top: 210px;
				color: #333333;
				font-size: 15px;
				margin: 0 auto;
				position: relative;
			}
			.number,.number1{
				width: 50%;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			.number1{
				border-left: 1px solid #999999;
			}
			.button{
				width: 40%;
				top: 240px;
				border: none;
				border-radius: 15px;
				color: #FFFFFF;
				box-shadow: 0 0 10px 5px #DDDDDD;
				background-color: #97A7C3;
			}
			
			.fans{
				font-size: 15px;
				border-top: 10px solid #e4e4e4;
			}
			.fans-title{
				padding: 15px;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				border-bottom: 1px solid #DDDDDD;
			}
			.fans-title .mui-navigate-right{
				display: inline-flex;
				padding-right: 20px;
				font-size: 13px;
				color: #999999;
				position: relative;
			}
			.fans-title .mui-navigate-right:after{
				right: 0;
				top: 50%;
				transform: translateY(-55%);
				-webkit-transform: translateY(-55%);
				font-size: 16px;
				color: #999999;
			}
			.fans_information{
				padding: 20px 15px;
				border-radius: 5px;
				margin-bottom: 15px;
				box-shadow: 0 0 10px 2px #DDDDDD;
			}
			.fans_information_chart{
				width: 40px;
				height: 40px;
				margin-top: 8px;
				border-radius: 50%;
			}
			.fans_information_chart img{
				width: 100%;
				height: 100%;
				border-radius: 50%;
			}
			.vip{
				padding: 2px 10px;
				font-size: 10px;
				color: #FFFFFF;
				margin-left: 10px;
				border-bottom-left-radius: 10px;
				border-top-right-radius: 10px;
				 background: linear-gradient(to right, #B7C4DC , #8A9BB9);
			}
			.time{
				font-size: 12px;
				margin-top: 10px;
				color: #999999;
			}
			.recommender{
				font-size: 12px;
				margin-top: 32px;
				color: #999999;
			}
			.my-equity{
				height: 100%;
				width: auto;
				padding: 0 10px;
				margin-right: -10px;
				font-size: 14px;
				position: relative;
				z-index: 12;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #333333;
			}
			[v-cloak] {
				display: none;
			}
			.more-and-more.mui-navigate-right:after{
				position: relative;
				font-size: 16px;
				display: inline-block;
				margin-left: 0px;
				color: #999999;
				transform: translateY(0);
				-webkit-transform: translateY(0);
				right: 0;
				top: 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">会员中心</h1>
			<div class="mui-pull-right my-equity">我的权益</div>
		</header>

		<div id="mui-content" class="mui-content" v-cloak>
			<div class="member"></div>
			<div class="member_chart">
				<div class="member_title">{{memberInfo.group_name}}</div>
				<div class="member_time">
					<span>到期：</span>
					<span>{{memberInfo.expire_time}}</span>
				</div>
				<div class="member_chart_number">
					<div class="mui-pull-left number">
						<span>我的粉丝</span>
						<span>{{memberInfo.fans_number||0}}</span>
						<span class="more-and-more mui-navigate-right"></span>
					</div>
					<div class="mui-pull-right number1">
						<span>推荐奖累计</span>
						<span>{{memberInfo.recommended_award||'0'}}</span>
						<span class="more-and-more mui-navigate-right"></span>
					</div>
					<div class="clearfix"></div>
				</div>
				<button class="button">续费/升级</button>
				<img src="../image/member1.png">
			</div>
			<div class="fans">
				<div class="fans-title"><span>我的粉丝({{memberInfo.fans_number||0}})</span> <span class="mui-pull-right mui-navigate-right">更多</span></div>
				<div v-if="fansLists.length>0">
					<div class="fans_information" v-for="(lists,index) in fansLists" :key="index">
						<div class="fans_information_chart mui-pull-left" :data-fid="list.id">
							<img :src="lists.avatarUrl">
						</div>
						<div class="flex-right mui-pull-left" style="margin-left: 15px;" :data-cid="list.id" :data-chatname="list.nickName"
						 :data-avatar="list.avatarUrl">
							<div>
								<span>{{lists.nickName}}</span>
								<span>
									<span class="vip">{{lists.group_name}}</span>
								</span>
							</div>
							<div class="time">
								<span>加入时间：</span>
								<span>{{lists.activation_time}}</span>
							</div>
						</div>
						<div class="mui-pull-right recommender" v-if="lists.direct==0">
							<span>推荐人：</span>
							<span>{{lists.recommend_user}}</span>
						</div>
						<div class="clearfix"></div>
					</div>
				</div>
				<div v-else style="margin: 36px 0;">
					<img style="width: 50%;display: block;margin: 0 auto;" class="no-friends" src="../image/icon/void-data.png">
					<p style="text-align: center;">您还没有粉丝</p>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/vue.min.js"></script>
		<script src="../js/util.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				beforeback: function() {
					plus.navigator.setStatusBarStyle('light');
				}
			});
			var userInfo = getUserInfo(),
				pageNum = 0;
			var app = new Vue({
				el: "#mui-content",
				data: {
					memberInfo: {},
					fansLists: []
				},
				created: function() {
					mui.init();
					mui.plusReady(function() {
						getMemberInfo();
						getFans();
					})
				},
				mounted: function() {
					mui.plusReady(function() {
						window.addEventListener('activateSuccess', function() {
							setTimeout(function() {
								getMemberInfo();
							}, 1000)
						})
						mui(".mui-content").on("tap", ".button", function() {
							openPage('renew.html', 'renew', '#f7f7f7', '');
						})

						// 跳转到粉丝页面
						mui(".mui-content").on("tap", ".mui-navigate-right,.number", function() {
							openPage('my_fans.html', 'my_fans', '#f7f7f7', '');
						})
						
						// 推荐奖累计
						mui(".mui-content").on("tap", ".number1", function() {
							openPage('award_reward.html', 'award_reward', '#f7f7f7', '');
						})

						// 我的权益
						mui("header").on('tap', '.my-equity', function() {
							openPage('equities_page.html', 'equities_page', '#f7f7f7', '');
						})

						mui(".mui-content").on('tap', '.fans_information_chart', function() {
							var fid = this.dataset.fid;
							openPage('friends_detail.html', 'friends_detail', '#f7f7f7', {
								fid: fid
							});
						})
						mui(".mui-content").on('tap', '.flex-right', function() {
							var cid = this.dataset.cid,
								chatName = this.dataset.chatname,
								avatar = this.dataset.avatar;
							logs(cid);
							openPage('dialog.html', 'dialog', '#f7f7f7', {
								cid: cid,
								chatName: chatName,
								avatar: avatar,
								barStyle: 'dark'
							});
						})
					})

				}
			})

			function getMemberInfo() {
				mui.post($ajaxUrl + 'member&action=member_info', {
					token: userInfo.token
				}, function(res) {
					if (res.errno) {
						message(res.message);
					} else {
						// 请求成功
						app.memberInfo = res.data;
					}
				}, 'json');
			}

			function getFans() {
				pageNum += 1;
				mui.post($ajaxUrl + 'member&action=fans', {
					token: userInfo.token,
					skip: pageNum,
					limit: 30
				}, function(res) {
					if (res.errno) {
						logs(res);
					} else {
						// 请求成功
						app.fansLists = res.data;
					}
				}, 'json');
			}
		</script>
	</body>

</html>
