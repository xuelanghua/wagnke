<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>目标详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/mui.picker.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<link href="../css/vip-page.css" rel="stylesheet" />
	</head>

	<body class="mui-hidden">
		<header class="mui-bar mui-bar-nav target-detail-header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">目标详情</h1>
			<h1 class="mui-pull-right my-target-menu">我的目标</h1>
		</header>
		<div id="targetDetail" class="mui-content target-detail-container">
			<div class="target-detail-heade">
				<div class="mui-row">
					<div class="mui-col-xs-6">
						<div class="mui-row">
							<div class="mui-col-xs-4" timeType="year"><i class="tab-item1"></i></div>
							<div class="mui-col-xs-4" timeType="month"><i class="tab-item2"></i></div>
							<div class="mui-col-xs-4" timeType="date"><i class="tab-item3 active"></i></div>
						</div>
					</div>
					<div class="mui-col-xs-6 timer-select">
						<i>&lt;</i>
						<span class="select-time" id='select-time'>2019-03-13</span>
						<i>&gt;</i>
					</div>
				</div>
			</div>
			<div class="target-detail-progress">
				<div class="mui-card">
					<div class="mui-card-header">
						<span>进度</span>
					</div>
					<div id="progress-container" class="mui-card-content progress-container">
						<ul id="progress-lists">
							<li class="progress-items exposure">
								<span class="title">曝光</span>
								<div class="progress-section">
									<p class="desc" id="exposure_rate_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="exposure_rate_progress">
										<span></span>
									</p>
								</div>
								<span class="data-desc" id="exposure_rate_text"></span>
							</li>
							<li class="progress-items toker">
								<span class="title">拓客</span>
								<div class="progress-section">
									<p class="desc" id="new_customer_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="new_customer_progress"><span></span></p>
								</div>
								<span class="data-desc" id="new_customer_text"></span>
							</li>
							<li class="progress-items evolve">
								<span class="title">客户跟进</span>
								<div class="progress-section">
									<p class="desc" id="customer_follow_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="customer_follow_progress"><span></span></p>
								</div>
								<span class="data-desc" id="customer_follow_text"></span>
							</li>
							<li class="progress-items communicate">
								<span class="title">有效沟通</span>
								<div class="progress-section">
									<p class="desc" id="communication_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="communication_progress"><span></span></p>
								</div>
								<span class="data-desc" id="communication_text"></span>
							</li>
							<li class="progress-items reporting">
								<span class="title">转介绍</span>
								<div class="progress-section">
									<p class="desc" id="share_card_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="share_card_progress"><span></span></p>
								</div>
								<span class="data-desc" id="share_card_text"></span>
							</li>
							<li class="progress-items deal">
								<span class="title">成交</span>
								<div class="progress-section">
									<p class="desc" id="deal_number">0/0</p>
									<p class="mui-progressbar mui-progressbar-in" id="deal_progress"><span></span></p>
								</div>
								<span class="data-desc" id="deal_text"></span>
							</li>
						</ul>
					</div>
				</div>
				<div class="mui-card">
					<div class="mui-card-header">
						<span>销售漏斗</span>
					</div>
					<div class="mui-card-content-inner sale-detail-list">
						<ul>
							<ul>
								<li>曝光&nbsp;<span id="exposure_rate_show"></span></li>
								<li>拓客&nbsp;<span id="new_customer_show"></span></li>
								<li>客户跟进&nbsp;<span id="customer_follow_show"></span></li>
								<li>有效沟通&nbsp;<span id="communication_show"></span></li>
								<li>转介绍&nbsp;<span id="share_card_show"></span></li>
								<li>成交金额&nbsp;<span id="deal_show"></span></li>
							</ul>
						</ul>
					</div>
				</div>
			</div>
			<!-- 我的目标弹窗开始-->
			<div class="target-modal-frame" >
				<div class="mui-card my-target-card">
					<div class="mui-card-header">
						<h2>我的目标</h2>
					</div>
					<div class="mui-card-content">
						<div class="target-list">
							<ul>
								<li><i class="target-tag-icon"></i><span>保时捷911价值1000000元将用600天来完成来完成来完成</span></li>
								<li>
									<i class="audio-tag-icon"></i>
									<audio class="mui-hidden" id="audio" controls="controls" src=""></audio>
									<div id="audio-control" class="play-control play">
										<div class="left-arrow"></div>
										<i class="play-status"></i>
										<div class="right-info mui-pull-right">
											<i></i>
											<span>30</span>
										</div>
									</div>
								</li>
							</ul>
						</div>
						<div class="target-tips">
							<h2 class="title">根据大数据计算</h2>
							<ol>
								<li>1、你需要每天开发3个客户</li>
								<li>2、每天沟通回访10个客户</li>
								<li>3、每天平均收款10000元</li>
							</ol>
						</div>
					</div>
					<div class="mui-card-footer">
						<button type="button" class="mui-btn mui-btn-blue close-btn">关闭</button>
						<button type="button" class="mui-btn mui-btn-blue">修改</button>
					</div>
				</div>
			</div>
			<!-- 我的目标弹窗结束 -->
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/Zepto.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/mui.picker.min.js"></script>
		<script type="text/javascript">
			mui.init();
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
			userInfo = getUserInfo();
			var selectTime = '2019-03-18';
			var timeType = '1';
			var optionsCont = {
				"type": "date"
			};
			var myDate = new Date();
			$("body").removeClass("mui-hidden");

			function userTargetStatistics() {
				mui.post($ajaxUrl + 'target', {
					action: 'detail',
					token: userInfo.token,
					date: selectTime, //"01" 
					pattern: timeType // 1天 2月 3年
				}, function(res) {
					var plan = res.data.plan;
					var finish = res.data.finish;
					for (var index in plan) {
						document.getElementById(index + '_number').innerText = finish[index] + '/' + plan[index];
						document.getElementById(index + '_show').innerText = finish[index];
						// 进度条控制
						// mui("#" + index + "_progress").progressbar().setProgress(finish[index]/plan[index]);
						mui("#" + index + "_progress").progressbar().setProgress(plan[index]);
						
						var rate = parseFloat((finish[index] / plan[index]).toFixed(1));
						if (rate < 1) {
							document.getElementById(index + '_text').innerText = '未达标';
						} else if (rate >= 1 && rate < 1.1) {
							document.getElementById(index + '_text').innerText = '已达标';
							document.getElementById(index + '_text').style.color = '#267CFF';
						} else if (rate >= 1.1 && rate < 1.5) {
							document.getElementById(index + '_text').innerText = '优秀';
							document.getElementById(index + '_text').style.color = '#267CFF';
						} else {
							document.getElementById(index + '_text').innerText = '英雄';
							document.getElementById(index + '_text').style.color = '#267CFF';
						}
					}
				}, 'json')
			}
			mui.plusReady(function() {
				plus.webview.currentWebview().setStyle({
					statusbar: {
						background: '#ffffff'
					},
					top: 0,
					bottom: 0
				});
			});
			userTargetStatistics();
			// 年月日切换
			mui(".target-detail-heade").on("tap", ".mui-col-xs-4", function(e) {
				var typs = this.getAttribute('timeType');
				var isYear = myDate.getFullYear();
				var isMonth = myDate.getMonth() + 1;
				var isDay = myDate.getDate();
				$(this).siblings('.mui-col-xs-4').children('i').removeClass("active");
				$(this).children('i').addClass('active');
				// logs(typs);
				if (typs == "year") {
					optionsCont = "year";
					selectTime = isYear + '-01';
					timeType = "3";
					userTargetStatistics();
				} else if (typs == "month") {
					optionsCont = {
						"type": "month",
						"beginYear": 2019,
						"endYear": 2029
					}
					selectTime = isYear + "-" + isMonth;
					timeType = "2";
					userTargetStatistics();
				} else {
					optionsCont = {
						"type": "date",
						"beginYear": 2019,
						"endYear": 2029
					}
					var itYear = myDate.getFullYear();
					selectTime = "" + isYear + "-" + isMonth + "-" + isDay;
					timeType = "1";
					userTargetStatistics();
				}
			})
			// 选择器
			var userPicker = new mui.PopPicker();
			userPicker.setData([{
				value: '2019',
				text: '2019'
			}, {
				value: '2020',
				text: '2020'
			}, {
				value: '2021',
				text: '2021'
			}, {
				value: '2022',
				text: '2022'
			}, {
				value: '2023',
				text: '2023'
			}, {
				value: '2024',
				text: '2024'
			}, {
				value: '2025',
				text: '2025'
			}, {
				value: '2026',
				text: '2026'
			}, {
				value: '2027',
				text: '2027'
			}, {
				value: '2028',
				text: '2028'
			}, {
				value: '2029',
				text: '2029'
			}]);
			// 日期选择器
			var btns = document.getElementById("select-time");
			btns.addEventListener('tap', function() {
				var _self = this;
				// logs(optionsCont);
				if (optionsCont == "year") {
					// 年选择
					userPicker.show(function(items) {
						btns.innerText = " " + items[0].text + " ";
						selectTime = items[0].text;
						timeType = "3";
						userTargetStatistics();
					});
				} else {
					// 年月日选择
					_self.picker = new mui.DtPicker(optionsCont);
					_self.picker.show(function(res) {
						btns.innerText = res.text;
						selectTime = res.text;
						timeType = "2";
						userTargetStatistics();
						_self.picker = null;
					});
				}
			}, false);
			// 显示我的目标
			mui(".mui-bar-nav").on("tap", ".my-target-menu", function(e) {
				$(".target-modal-frame").addClass("active");
			})
			// 关闭我的目标
			mui(".my-target-card .mui-card-footer").on("tap", ".close-btn", function() {
				var audio = document.getElementById("audio");
				$(".target-modal-frame").removeClass("active");
				$(".play-control .play-status").removeClass("active");
				$("#audio-control").addClass("play").removeClass("pause");
				getSong();
			})
			// 播放
			mui(".target-modal-frame .target-list").on("tap", ".play-control", function() {
				clicks();
			})
			// 获取音频

			// 渐变进度条
			// 	var progres = [90, 60, 70, 80, 60, 90];
			// 	var className = ["exposure", "toker", "evolve", "communicate", "reporting", "deal"];
			// 	mui.each(className, function(i, names) {
			// 		var p = 0;
			// 		var myVar = setInterval(function() {
			// 			p += 1;
			// 			mui('.progress-items.' + names + ' .progress-section').progressbar().setProgress(p);
			// 			if (p == progres[i]) {
			// 				p = 0;
			// 				clearInterval(myVar);
			// 			}
			// 		}, 20);
			// 	});
			//获取语音链接并插入dom中
			function getSong() {
				var audio = document.getElementById("audio");
				audio.src = "https://wangke.ynhost.cn/attachment/images/longbing_card_upload/2/5810912501639961.mp3";
				// audio.loop = true;
				playCotrol();
			}
			getSong();

			//点击播放/暂停
			function clicks() {
				var audio = document.getElementById("audio");
				if ($("#audio-control").hasClass("play")) {
					$("#audio-control").addClass("pause").removeClass("play");
					audio.play();
					$(".target-modal-frame .target-list .play-status").addClass("active");
				} else {
					$("#audio-control").addClass("play").removeClass("pause");
					$(".target-modal-frame .target-list .play-status").removeClass("active");
					audio.pause();
				}
			}

			//播放事件监听
			function playCotrol() {
				var audio = document.getElementById("audio");
				audio.addEventListener("loadeddata",
					function() {
						$("#control").addClass("play").removeClass("color_gray");
						var allTime = parseInt(audio.duration);
						$(".right-info span").text(allTime);
					}, false);
				audio.addEventListener("pause",
					function() {
						if (audio.currentTime == audio.duration) {
							audio.stop();
							audio.currentTime = 0;
						}
					}, false);
				audio.addEventListener("ended", function() {
					$("#audio-control .play-status").removeClass("active");
				}, false)
			}
		</script>
	</body>

</html>
