<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.dtpicker.css" rel="stylesheet" />
		<link href="../iconfont/iconfont.css" rel="stylesheet" />
		<style>
			.clearfix{
				clear: both;
			}
			.mui-title{
				color: #FFFFFF;
			}
			.mui-bar{
				box-shadow: none;
			}
			.title{
				height: 150px;
				background-color: #2289FF;
			}
			.info{
				width: 94%;
				position: absolute;
				top: 105px;
				left: 3%;
				box-shadow: 0 0 5px 0 #DDDEDE;
				padding: 0 10px 25px 10px;
				text-align: center;
				color: #999999;
				border-radius: 10px;
				background-color: #FFFFFF;
			}
			.infoL{
				width: 49%;
				font-size: 10px;
				margin-top: 6px;
			}
			.infoR{
				width: 49%;
				font-size: 10px;
				margin-top: -55px;
			}
			.rig{
				margin-left: 5px;
				color: #333333;
			}
			.xian{
				width: 1px;
				height: 40px;
				margin: 20px auto 0;
				background-color: #DDDDDD;
			}
			.infoL img{
				height: 25px;
				margin-right: 10px;
				margin-top: 12px;
			}
			.infoR img{
				height: 25px;
				margin-left: 10px;
				margin-top: 12px;
			}
			.head{
				width: 40%;
				text-align: center;
				margin: 0 auto;
			}
			.chart{
				width: 70px;
				height: 70px;
				margin: 0 auto;
				border-radius: 50%;
			}
			.chart img{
				width: 100%;
				height: 100%;
				margin-top: -30px;
				border-radius: 50%;
			}
			.name{
				font-size: 17px;
				color: #333333;
				margin-top: -15px;
			}
			.Grade{
				font-size: 12px;
				color: #f96b5e;
				margin-top: 10px;
			}
			.company{
				/* width: 60%; */
				overflow: hidden;
				text-overflow:ellipsis;
				white-space: nowrap;
				padding: 0 10px;
				display: block;
				border-radius: 10px;
				background-color: #68B0FF;
			}
			.position{
				padding: 0 10px;
				border-radius: 10px;
				margin-left: 15px;
				background-color: #F9D05E;
			}
			
			.function{
				padding: 35% 10px 26px 10px;
				font-size: 12px;
				color: #999999;
				background-color: #FFFFFF;
			}
			.button button{
				width: 45%;
				margin-top: 27px;
				padding: 10px 0;
				border-radius: 5px;
			}
			.buttonL{
				color: #FFFFFF;
				border: none;
				background-color: #2289FF;
			}
			.buttonR{
				color: #338CFF;
				border: 1px solid #338CFF;
			}
			
			*{
				padding: 0;
				margin: 0;
			}
			#example{
				width: 100%;
				margin-bottom: 66px;
				margin-top: 8px;
				background-color: #FFFFFF;
			}
			#example .hd ul li{
				display: block;
				/* width: 25%; */
				width: 33.333333%;
				float: left;
				padding: 19px 0;
				text-align: center;
				border-bottom: 1px solid #F2F2F2;
			}
			#example .hd ul li.current{
				color: #2289FF;
				border-bottom: 2px solid #2289FF;
			}
			#example .bd{
				margin: 0 10px;
				padding-bottom: 15px;
			}
			#example .bd ul li{
				display: none;
			}
			#example .bd ul li.current{
				display: block;
			}
			.Record_list{
				padding: 15px 0;
				font-size: 15px;
				border-bottom: 1px solid #F2F2F2;
			}
			
			.comment-input{
				width: 100%;
				position: fixed;
				bottom: 0;
				padding: 10px 15px 8px 15px;
				border-top: 1px solid #F2F2F2;
				background-color: #FFFFFF;
			}
			.input{
				width: 40%;
				background-color: #F5F6F8;
				padding: 7px 0 7px 11px;
				color: #999999;
				font-size: 15px;
				margin-top: 4px;
				border-radius: 25px;
			}
			.input img{
				width: 17px;
				height: 18px;
			}
			.comment-inputr{
				width: 60%;
				font-size: 12px;
			}
			.comment-inputr div{
				width: 33.33%;
				float: left;
				text-align: center;
			}
			.comment-inputr button{
				color: #FFFFFF;
				border: none;
				font-size: 15px;
				border-radius: 5px;
				margin-top: 5px;
				background-color: #2289FF;
			}
			.comment-inputr img{
				height: 21px;
			}
			.comment-inputr span{
				display: block;
				color: #999999;
				margin-top: -5px;
			}
			.comment-content{
				margin-bottom: 50px;
				padding-bottom: 20px;
			}
			.tanchu{
				padding: 19px;
				border-radius: 8px;
				background-color: #FFFFFF;
				position: fixed;
				z-index: 99999;
				width: 92%;
				top: 25%;
				left: 4%;
				right: 4%;
				display: none;
			}
			.tanchu textarea{
				border: none;
				font-size: 15px;
				background-color: #F5F6F8;
			}
			.tanchu button,
			.tibu button{
				width: 30%;
				background-color: #2289FF;
				color: #FFFFFF;
				border: none;
				margin: 0 auto;
				display: block;
				font-size: 15px;
				border-radius: 5px;
			}
			#cover{
			    position: fixed;
				z-index: 9999;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
				background: #333333 none repeat scroll 0% 0%;
			}
			
			.guaih{
				border-radius: 8px;
				background-color: #FFFFFF;
				position: fixed;
				z-index: 99999;
				width: 92%;
				top: 25%;
				left: 4%;
				right: 4%;
				display: none;
			}
			.tanchu-title{
				text-align: center;
				padding: 15px 0;
				border-bottom: 1px solid #F2F2F2;
			}
			.tanchu_content{
				font-size: 14px;
				padding: 20px 10px 40px 10px;
				color: #999999;
				border-bottom: 1px solid #F2F2F2;
			}
			.tanchu_content p{
				width: 4px;
				height: 4px;
				margin-top: 8px;
				border-radius: 50%;
				margin-right: 10px;
				background-color: #2289FF;
			}
			.tibu{
				padding: 15px 0;
			}
			.tibu button{
				width: 40%;
				text-align: center;
			}
			.tbuttonL{
				color: #2289FF;
				margin-left: 5%;
				border: 1px solid #2289FF;
			}
			.tbuttonR{
				background-color: #2289FF;
				color: #FFFFFF;
				margin-right: 5%;
				border: 1px solid #2289FF;
			}
			
			.dianh{
				text-align: center;
				font-size: 14px;
				color: #999999;
				padding-top: 5px;
			}
			.dianh img{
				width: 10px;
				float: left;
				margin-top: 3px;
				margin-left: 10%;
			}
			
			.current_chart{
				width: 40px;
				height: 40px;
				margin-top: 15px;
				border-radius: 50%;
			}
			.current_chart img{
				width: 100%;
				height: 100%;
				border-radius: 50%;
			}
			
			.shuj span{
				color: #2289FF;
			}
			
			.xinahsi{
				color: #6fb2ff;
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				overflow: hidden;
				float: left;
				padding: 5px 6px;
				margin-top: 10px;
				background-color: #F7F7F7;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #2289FF;color: #FFFFFF;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #FFFFFF;"></a>
			<h1 class="mui-title">客户详情</h1>
			<a href="javascript: void(0);" id="crm_edit">
				<div class="mui-pull-right" style="margin-top: 10px;font-size: 15px;color: #FFFFFF;">编辑</div>
			</a>
		</header>

		<div class="mui-content">
			<div class="title"></div>
			<div class="info">
				<div class="head">
					<div class="chart">
						<img src="../image/touxiang.png" id="crm_avatar">
					</div>
					<div class="name">
						<span id="crm_name">万贤</span>
						<!-- <span style="color: #2289FF;">(喵喵喵)</span> -->
					</div>
					<div class="Grade" id="crm_member">下级会员</div>
				</div>

				<div class="infoL mui-pull-left" id="deal_forcast">
					<img src="../image/infoL.png">
					<div>
						<span>预计成交日期</span>
						<span class="rig" id="deal_time">01/20</span>
					</div>
				</div>
				<div class="xian"></div>
				<div class="infoR mui-pull-right">
					<img src="../image/infoR.png">
					<div>
						<span>AI预计成功率</span>
						<span class="rig" id="deal_percent">50%</span>
					</div>
				</div>
				<div class="clearfix"></div>
			</div>
			<div class="function">
				<div>
					<span>电话</span>
					<span style="color: #000000;margin-left: 62px;" id="crm_mobile">13888888888</span>
				</div>
				<div style="margin-top: 15px;">
					<span class="mui-pull-left">公司&职位</span>
					<span class="mui-pull-left" style="margin-left: 32px;color: #FFFFFF;font-size: 10px;">
						<span class="company mui-pull-left" id="crm_company">云南万贤科技有限公司</span>
						<span class="position mui-pull-left" id="crm_job">总经理</span>
					</span>
					<div class="clearfix"></div>
				</div>
				<div style="margin-top: 15px;">
					<span>设置标签</span>
					<span style="margin-left: 40px;color: #2289FF;">[朋友]</span>
				</div>
				<div class="button">
					<button class="mui-pull-left buttonL" id="send_button">发消息</button>
					<button class="mui-pull-right buttonR" id="care_button">客情关怀</button>
					<div class="clearfix"></div>
				</div>
			</div>

			<div id="example">
				<div class="hd">
					<ul>
						<li class="current">AI分析</li>
						<li>跟进记录</li>
						<!-- <li>AI分析</li> -->
						<li>成交记录</li>
						<div class="clearfix"></div>
					</ul>
				</div>
				<div class="bd">
					<ul>
						<li class="current" id="view_container">
							<!-- <div class="current_chart mui-pull-left">
								<img src="../image/activation.png">
							</div>
							<div class="Record_list mui-pull-right" style="width: 85%;">
								<div class="mui-pull-left shuj" style="width: 70%;">
									<span>第9次查看</span>你的<span>名片</span>，以下速度快撒飞洒地方
								</div>
								<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 10px;">
									<span>02-28</span>
									<span>09:58</span>
								</div>
							</div>
							<div class="clearfix"></div> -->
						</li>
						<li id="follow_container">
							<!-- <div class="current_chart mui-pull-left">
								<img src="../image/activation.png">
							</div>
							<div class="Record_list mui-pull-right" style="width: 80%;">
								<div class="mui-pull-left" style="width: 60%;margin-top: 5px;">
									<span>新增记录:</span>
									<span style="color: #2289FF;">已成交</span>
								</div>
								<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 5px;">
									<span>02-28</span>
									<span>09:58</span>
								</div>
							</div>
							<div class="clearfix"></div>
							<div class="current_chart mui-pull-left">
								<img src="../image/activation.png">
							</div>
							<div class="Record_list mui-pull-right" style="width: 80%;">
								<div class="mui-pull-left" style="width: 60%;margin-top: 5px;">
									<span class="mui-pull-left">新增记录:</span>
								</div>
								<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 5px;">
									<span>02-28</span>
									<span>09:58</span>
								</div>
								<div class="xinahsi">已成交萨芬士大夫十大撒打发是大方式打</div>
							</div>
							<div class="clearfix"></div> -->
						</li>
						<!-- <li id="ai_container">
							<div style="padding: 30px 15px;text-align: center;color: #ccc;padding-right: 45px;">没有数据</div>
						</li> -->
						<li id="deal_container">
							<!-- <div class="Record_list">
								<div>
									<span class="mui-pull-left">万贤传单码</span>
									<span class="mui-pull-right">19800</span>
									<div class="clearfix"></div>
								</div>
								<div style="font-size: 14px;color: #999999;margin-top: 10px;">
									<span class="mui-pull-left">
										<span>定单号:</span>
										<span>20180508123652</span>
									</span>
									<span class="mui-pull-right">2018-05-08</span>
									<div class="clearfix"></div>
								</div>
							</div>
							<div class="Record_list">
								<div>
									<span class="mui-pull-left">万贤传单码</span>
									<span class="mui-pull-right">19800</span>
									<div class="clearfix"></div>
								</div>
								<div style="font-size: 14px;color: #999999;margin-top: 10px;">
									<span class="mui-pull-left">
										<span>定单号:</span>
										<span>20180508123652</span>
									</span>
									<span class="mui-pull-right">2018-05-08</span>
									<div class="clearfix"></div>
								</div>
							</div>
							<div class="Record_list">
								<div>
									<span class="mui-pull-left">万贤传单码</span>
									<span class="mui-pull-right">19800</span>
									<div class="clearfix"></div>
								</div>
								<div style="font-size: 14px;color: #999999;margin-top: 10px;">
									<span class="mui-pull-left">
										<span>定单号:</span>
										<span>20180508123652</span>
									</span>
									<span class="mui-pull-right">2018-05-08</span>
									<div class="clearfix"></div>
								</div>
							</div>
							<div class="Record_list">
								<div>
									<span class="mui-pull-left">万贤传单码</span>
									<span class="mui-pull-right">19800</span>
									<div class="clearfix"></div>
								</div>
								<div style="font-size: 14px;color: #999999;margin-top: 10px;">
									<span class="mui-pull-left">
										<span>定单号:</span>
										<span>20180508123652</span>
									</span>
									<span class="mui-pull-right">2018-05-08</span>
									<div class="clearfix"></div>
								</div>
							</div> -->
						</li>
					</ul>
				</div>
			</div>

			<div class="comment-input">
				<div class="input mui-pull-left">
					<img src="../image/shuru.png">
					<span style="margin-left: 10px;">跟进记录...</span>
				</div>
				<div class="comment-inputr mui-pull-right">
					<div style="margin-left: 10px;" id="deal_flag">
						<!-- <img src="../image/wdeal.png"> -->
						<span id="deal_icon" style="margin-top: 3px;margin-bottom: 2px;"><i class="iconfont icon-user-flag" style="font-size: 23px;"></i></span>
						<span id="deal_title" id="deal_title">未成交</span>
					</div>
					<button id="share_card">分享名片</button>
					<button id="call_up">电话</button>
				</div>
				<div class="clearfix"></div>
			</div>

			<!-- 弹出框 -->
			<div id="cover"></div>
			<div class="tanchu">
				<textarea rows="8" name="content" placeholder="请输入..." /></textarea>
				<button class="button" id="follow_publish">发 布</button>
			</div>

			<!-- 客情关怀 弹出框 -->
			<div id="cover"></div>
			<div class="guaih">
				<div class="tanchu-title">
					客情关怀
				</div>
				<div class="tanchu_content">
					<div style="color: #000000;margin-bottom: 10px;">开启客情关怀将在以下特定日期进行消息提示</div>
					<div>
						<p class="mui-pull-left"></p>
						<span class="mui-pull-left">
							<span>生日：</span>
							<span id="birthday">12-28</span>
						</span>
						<div class="clearfix"></div>
					</div>
					<div>
						<p class="mui-pull-left"></p>
						<span class="mui-pull-left">
							<span>纪念日：</span>
							<span id="anniversary">12-28</span>
						</span>
						<div class="clearfix"></div>
					</div>
				</div>
				<div class="tibu">
					<!-- <button class="tbuttonL mui-pull-left">放弃</button> -->
					<button class="tbutton" id="notice_button">开启</button>
					<div class="clearfix"></div>
				</div>
			</div>

		</div>
	</body>
	<script src="../js/mui.js"></script>
	<script src="../js/mui.picker.js"></script>
	<script src="../js/mui.dtpicker.js"></script>
	<script src="../js/util.js"></script>
	<script type="text/javascript">
		mui.init({
			swipeBack: true
		})

		var cid = 0;
		var userId = 0;
		var chatName = '';
		var avatar = '';
		var dealFlag = 0;
		var noticeStatus = 0;
		var userInfo = getUserInfo();
		mui.plusReady(function() {
			var self = plus.webview.currentWebview();
			cid = self.cid;

			getCustomerInfo();
			
			window.addEventListener('editCustomer', function() {
				getCustomerInfo();
			})

			document.getElementById('call_up').addEventListener('tap', function() { 
				var phone = this.dataset.phone;
				plus.device.dial(phone);
			})

			document.querySelector('.input').addEventListener('tap', function() {
				document.getElementById('cover').style.display = 'block';
				document.querySelector('.tanchu').style.display = 'block';
			})

			document.querySelector('#care_button').addEventListener('tap', function() {
				document.getElementById('cover').style.display = 'block';
				document.querySelector('.guaih').style.display = 'block';
			})
			
			document.querySelector('#send_button').addEventListener('tap', function() {
				// console.log('openWin');
				fnOpenWin('dialog.html', 'dialog', {statusbar: {background: '#F7F7F7'}}, {cid: 7088, chatName: chatName, avatar: avatar, barStyle: 'light'}, 'slide-in-right');
				plus.navigator.setStatusBarStyle('dark');
			})
			
			document.getElementById('cover').addEventListener('tap', function() {
				this.style.display = 'none';
				document.querySelector('.guaih').style.display = 'none';
				document.querySelector('.tanchu').style.display = 'none';
			})
			
			document.querySelector('#deal_forcast').addEventListener('tap', function() {
				var dt = datePick(function(e) {
					var selectedDate = e.value;
					mui.post($ajaxUrl + 'customer', {action: 'forcast', date: selectedDate, token: userInfo.token, cid: cid}, function(res) {
						logs(res);
						if (res.errno == 0) {
							message('设置成功!');
							getCustomerInfo();
						} else {
							message('设置失败!');
						}
					}, 'json')
				})
			})

			mui('.mui-content').on('tap', '#deal_flag', function() {
				if (dealFlag == 1) {
					mui.post($ajaxUrl + 'customer', {
						action: 'mark',
						cid: cid,
						token: userInfo.token,
						mark: 1
					}, function(res) {
						if (res.errno == 0) {
							getCustomerInfo();
							document.getElementById('deal_icon').style.color = '#999';
							document.getElementById('deal_title').innerText = '未成交';
							document.getElementById('deal_title').style.color = '#999';
							dealFlag = 0;
						}
					}, 'json')
				} else {
					mui.post($ajaxUrl + 'customer', {
						action: 'mark',
						cid: cid,
						token: userInfo.token,
						mark: 2
					}, function(res) {
						if (res.errno == 0) {
							getCustomerInfo();
							document.getElementById('deal_icon').style.color = 'red';
							document.getElementById('deal_title').innerText = '已成交';
							document.getElementById('deal_title').style.color = 'red';
							dealFlag = 1;
						}
					}, 'json')
				}
			})

			mui('.mui-content').on('tap', '#follow_publish', function() {
				var content = document.querySelector('textarea[name=content]').value;
				content = content.replace(/^\s*|\s*$/g, "");
				if (content.length == 0) {
					message('请输入跟进内容!');
					return;
				}
				document.getElementById('cover').style.display = 'none';
				document.querySelector('.tanchu').style.display = 'none';
				mui.post($ajaxUrl + 'customer', {
					action: 'follow',
					cid: cid,
					token: userInfo.token,
					content: content
				}, function(res) {
					if (res.errno == 0) {
						message('跟进成功!');
						getCustomerInfo();
					} else {
						message(res.message);
					}
				}, 'json')
			})
			
			mui('.mui-content').on('tap', '#notice_button', function() {
				document.getElementById('cover').style.display = 'none';
				document.querySelector('.guaih').style.display = 'none';
				if (noticeStatus == 1) {
					mui.post($ajaxUrl + 'customer', {
						action: 'notice',
						cid: cid,
						token: userInfo.token,
						notice: 0
					}, function(res) {
						if (res.errno == 0) {
							message('关闭成功!');
							getCustomerInfo();
							noticeStatus = 0;
						} else {
							message('关闭失败!');
						}
					}, 'json')
				} else {
					mui.post($ajaxUrl + 'customer', {
						action: 'notice',
						cid: cid,
						token: userInfo.token,
						notice: 1
					}, function(res) {
						logs(res);
						if (res.errno == 0) {
							message('开启成功!');
							getCustomerInfo();
							noticeStatus = 1;
						} else {
							message('开启失败!');
						}
					}, 'json')
				}
			})
			
			mui('header').on('tap', '#crm_edit', function() {
				fnOpenWin('customer_edit.html', 'customer_edit', {statusbar: {background: '#FFF'}}, {cid: cid}, 'slide-in-right');
				plus.navigator.setStatusBarStyle('dark');
			})
			
			hd = document.getElementsByClassName("hd")[0].getElementsByTagName("li");
			bd = document.getElementsByClassName("bd")[0].getElementsByTagName("li");
			for (var i = 0; i < hd.length; i++) {
				hd[i].addEventListener('tap', function() {
					doTabs(this);
				})
			}
		})
		
		function datePick(callback) {
			var dtpicker = new mui.DtPicker({
				type: "date", //设置日历初始视图模式
				value: "1990-09-16",
				beginDate: new Date(2019, 02, 03), //设置开始日期 
				endDate: new Date(2025, 12, 31), //设置结束日期 
				labels: ['年', '月', '日'], //设置默认标签区域提示语 
			})
			dtpicker.show(function(e) {
				callback(e);
			})
		}

		function getCustomerInfo() {
			plus.nativeUI.showWaiting();
			mui.post($ajaxUrl + 'customer', {
				action: 'detail',
				token: userInfo.token,
				id: cid,
				type: 'crm'
			}, function(res) {
				// logs(res);
				if (res.errno == 0) {
					var data = res.data;
					chatName = data.name;
					userId = data.uid;
					avatar = data.headimgurl;
					if (data.headimgurl.length != 0) {
						document.getElementById('crm_avatar').src = data.headimgurl;
					}
					document.getElementById('crm_name').innerText = data.name;
					document.getElementById('crm_mobile').innerText = data.mobile;
					document.getElementById('call_up').dataset.phone = data.mobile;
					document.getElementById('crm_company').innerText = data.company;
					document.getElementById('crm_job').innerText = data.job;
					var follow = data.follow;
					var html = '';
					if (follow.length > 0) {
						for (var i in follow) {
							if (follow[i].mark == 1 || follow[i].mark == 2) {
								html += '<div class="current_chart mui-pull-left">';
								if (data.headimgurl.length != 0) {
									html += '<img src="' + data.headimgurl + '" >';
								} else {
									html += '<img src="../image/user_default.png" >';
								}
								html += '</div>';
								html += '<div class="Record_list mui-pull-right"style="width: 85%;">';
								html += '<div class="mui-pull-left"style="width: 60%;margin-top: 5px;">';
								html += '<span>新增记录:</span>';
								if (follow[i].mark == 1) {
									html += '<span style="color: #2289FF;">开始跟进</span>';
								} else {
									html += '<span style="color: #2289FF;">已成交</span>';
								}
								html += '</div>';
								html += '<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 5px;">';
								html += '<span>' + follow[i].create_time + '</span>';
								html += '</div>';
								html += '</div>';
								html += '<div class="clearfix"></div>';
							} else {
								html += '<div class="current_chart mui-pull-left">';
								if (data.headimgurl.length != 0) {
									html += '<img src="' + data.headimgurl + '" >';
								} else {
									html += '<img src="../image/user_default.png" >';
								}
								html += '</div>';
								html += '<div class="Record_list mui-pull-right"style="width: 85%;">';
								html += '<div class="mui-pull-left"style="width: 60%;margin-top: 5px;">';
								html += '<span class="mui-pull-left">新增记录:</span>';
								html += '</div>';
								html += '<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 5px;">';
								html += '<span>' + follow[i].create_time + '</span>';
								html += '</div>';
								html += '<div class="xinahsi">' + follow[i].content + '</div>';
								html += '</div>';
								html += '<div class="clearfix"></div>'; 
							}
						}
					} else {
						html += '<div style="padding: 30px 15px;text-align: center;color: #ccc;padding-right: 45px;">没有数据</div>';
					}
					document.querySelector('#follow_container').innerHTML = html;
					
					var viewHtml = '';
					if (data.view.length > 0) {
						var viewList = data.view;
						for (var k in viewList) {
							viewHtml +='<div class="current_chart mui-pull-left">';
								if (data.headimgurl.length != 0) {
									viewHtml += '<img src="' + data.headimgurl + '" >';
								} else {
									viewHtml += '<img src="../image/user_default.png" >';
								}
							viewHtml +='</div>';
							viewHtml +='<div class="Record_list mui-pull-right" style="width: 85%;">';
								viewHtml +='<div class="mui-pull-left shuj" style="width: 70%;">';
									if (viewList[k].sign == 'praise' && viewList[k].type == 1) {
										viewHtml +='TA给你的<span>录音</span>点赞了, 看来TA对你的介绍<span>非常感兴趣</span>';
									} else if (viewList[k].sign == 'praise' && viewList[k].type == 2) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看</span>你的<span>名片</span>,TA正在了解你';
										} else if (viewList[k].count > 1 && viewList[k].count < 5) {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>名片</span>,你成功的吸引了TA';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>名片</span>,高意向客户,立即主动沟通';
										}
									} else if (viewList[k].sign == 'praise' && viewList[k].type == 3) {
										viewHtml +='TA给你点赞了, 看来TA觉得你<span>非常靠谱</span>';
									} else if (viewList[k].sign == 'praise' && viewList[k].type == 4) {
										if (viewList[k].count == 1) {
											viewHtml +='<span>首次分享</span>了你的<span>名片</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次分享</span>了你的<span>名片</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 1) {
										if (viewList[k].count == 1) {
											viewHtml +='TA<span>首次</span>保存了你的电话, 请随时保持电话畅通';
										} else {
											viewHtml +='TA<span>第' + viewList[k].count + '次</span>保存了你的电话, 请随时保持电话畅通';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 2) {
										if (viewList[k].count == 1) {
											viewHtml +='<span>首次拨打</span>你的<span>手机号</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次拨打</span>你的<span>手机号</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 3) {
										if (viewList[k].count == 1) {
											viewHtml +='<span>首次拨打</span>你的<span>座机号</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次拨打</span>你的<span>座机号</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 4) {
										if (viewList[k].count == 1) {
											viewHtml +='TA<span>首次</span>复制了你的微信, 请随时查看微信通讯录';
										} else {
											viewHtml +='TA<span>第' + viewList[k].count + '次</span>复制了你的微信, 请随时查看微信通讯录';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 5) {
										if (viewList[k].count == 1) {
											viewHtml +='TA<span>首次</span>复制了你的邮箱, 可随时邮寄文件给你';
										} else {
											viewHtml +='TA<span>第' + viewList[k].count + '次</span>复制了你的邮箱, 可随时邮寄文件给你';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 6) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次复制</span>你公司的<span>名称</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次复制</span>你公司的<span>名称</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 7) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看</span>你公司的<span>定位</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你公司的<span>定位</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 8) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次咨询</span>你的<span>产品</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次咨询</span>你的<span>产品</span>';
										}
									} else if (viewList[k].sign == 'copy' && viewList[k].type == 9) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次播放</span>你的<span>语音</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次播放</span>你的<span>语音</span>';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 1) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看</span>你的<span>商城</span>,尽快把握商机';
										} else if (viewList[k].count == 2) {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>商城</span>,潜在购买客户';
										} else if (viewList[k].count == 3) {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>商城</span>,高意向客户成交在望';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>商城</span>,购买欲望强烈';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 2) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看</span>你的<span>商品(' + viewList[k].target_name + ')详情</span>,尽快把握商机';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>商品(' + viewList[k].target_name + ')详情</span>,尽快把握商机';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 3) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看</span>你的<span>动态</span>';
										} else if (viewList[k].count == 2) {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>动态</span>,赶快主动沟通';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看</span>你的<span>动态</span>,高意向客户成交在望';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 4) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次点赞</span>了你的<span>动态</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次点赞</span>了你的<span>动态</span>';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 5) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次评论</span>了你的<span>动态</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次评论</span>了你的<span>动态</span>';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 6) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次查看公司官网</span>,看来他对公司感兴趣';
										} else if (viewList[k].count == 2) {
											viewHtml +='<span>第' + viewList[k].count + '次查看公司官网</span>,赶快主动沟通';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次查看公司官网</span>,高意向客户成交在望';
										}
									} else if (viewList[k].sign == 'view' && viewList[k].type == 7) {
										if (viewList[k].count == 1) { 
											viewHtml +='<span>首次浏览</span>你的<span>动态(' + viewList[k].target_name + ')详情</span>';
										} else {
											viewHtml +='<span>第' + viewList[k].count + '次浏览</span>你的<span>动态(' + viewList[k].target_name + ')详情</span>';
										}
									}
								viewHtml +='</div>';
								viewHtml +='<div class="mui-pull-right" style="font-size: 14px;color: #999999;margin-top: 10px;">';
									viewHtml +='<span>' + viewList[k].create_time + '</span>';
								viewHtml +='</div>';
							viewHtml +='</div>';
							viewHtml +='<div class="clearfix"></div>';
						}
					} else {
						viewHtml += '<div style="padding: 30px 15px;text-align: center;color: #ccc;padding-right: 45px;">没有数据</div>';
					}
					document.querySelector('#view_container').innerHTML = viewHtml;
					
					var dealHtml = '';
					if (data.deal.length > 0) {
						var dealList = data.deal;
						for (var j in dealList) {
							dealHtml += '<div class="Record_list">';
								dealHtml += '<div>';
									dealHtml += '<span class="mui-pull-left">' + dealList[j].name + '</span>';
									dealHtml += '<span class="mui-pull-right">' + dealList[j].total_price + '</span>';
									dealHtml += '<div class="clearfix"></div>';
								dealHtml += '</div>';
								dealHtml += '<div style="font-size: 14px;color: #999999;margin-top: 10px;">';
									dealHtml += '<span class="mui-pull-right">' + dealList[j].create_time + '</span>';
									dealHtml += '<div class="clearfix"></div>';
								dealHtml += '</div>';
							dealHtml += '</div>';
						}
					} else {
						dealHtml += '<div style="padding: 30px 15px;text-align: center;color: #ccc;padding-right: 45px;">没有数据</div>';
					}
					document.querySelector('#deal_container').innerHTML = dealHtml;

					if (data.mark == 2) {
						document.getElementById('deal_icon').style.color = 'red';
						document.getElementById('deal_title').innerText = '已成交';
						document.getElementById('deal_title').style.color = 'red';
						dealFlag = 1;
					}
					
					if (data.birthday.length != 0) {
						document.getElementById('birthday').innerText = data.birthday;
					} else {
						document.getElementById('birthday').innerText = '未填写';
					}
					if (data.anniversary.length != 0) {
						document.getElementById('anniversary').innerText = data.anniversary;
					} else {
						document.getElementById('anniversary').innerText = '未填写';
					}
					if (data.is_notice == 1) {
						document.getElementById('notice_button').innerText = '关闭';
						noticeStatus = 1;
					}
					document.getElementById('deal_time').innerText = data.date;
					document.getElementById('deal_percent').innerText = data.rate;
					if (data.member == 1) {
						document.getElementById('crm_member').innerText = '下级会员';
					} else {
						document.getElementById('crm_member').innerText = '';
					}
				} else {
					message(res.message);
					setTimeout(function() {
						plus.webview.close('crm_detail_app');
					}, 2000)
				}
				plus.nativeUI.closeWaiting();
			}, 'json')
		}

		function doTabs(obj) {
			for (var i = 0; i < hd.length; i++) {
				if (hd[i] == obj) {
					hd[i].className = "current";
					bd[i].className = "current";
				} else {
					hd[i].className = "";
					bd[i].className = "";
				}
			}
		}
	</script>
</html>
