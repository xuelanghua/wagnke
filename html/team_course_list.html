<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			/* 团队课程 */
			.team-class-container {
				padding-bottom: 1.1rem;
			}

			.team-class-container .mui-table-view {
				/* padding: 0 0.2rem; */
			}

			.team-class-container .mui-table-view-cell {
				padding: 0 0.2rem;
				height: 2.29rem;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.team-class-container .mui-table-view-cell:after {
				left: 0.2rem;
				right: 0.2rem;
			}

			.goods-img {
				width: 2.27rem;
				height: 1.61rem;
				overflow: hidden;
				margin-right: 0.24rem;
				flex-shrink: 0;
			}

			.goods-img img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.goods-right-cont {
				max-width: 4.58rem;
				flex-grow: 1;
			}

			.streaming-status {
				height: 0.6rem;
				display: flex;
				align-items: center;
				font-size: 0.24rem;
				color: #2289FF;
				align-items: center;
			}


			.hear-cont {
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.hear-cont p {
				margin: 0;
				font-size: 0.24rem;
				color: #999999;
			}

			.delete-course,
			.more-option {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				width: 1.14rem;
				height: 0.4rem;
				background-color: #DDDDDD;
				border-radius: 0.2rem;
				font-size: 0.24rem;
				color: #999999;
				line-height: 1;
				position: relative;
			}

			.delete-course img {
				width: 0.27rem;
				height: 0.27rem;
				margin-right: 0.1rem;
			}

			.more-option {
				width: 0.77rem;
				height: 0.32rem;
				line-height: 1;
				position: relative;
			}

			.more-option .mui-icon {
				font-size: 0.38rem;
			}

			.mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			/* 更多 菜单 */
			.hear-cont .menu-list {
				width: 3.29rem;
				height: 0.8rem;
				position: absolute;
				z-index: 999;
				display: none;
				align-items: center;
				justify-content: flex-end;
				overflow: visible;
				padding: 0;
				right: 0.8rem;
				transition: all 0.2s ease-in-out;
				-webkit-transition: all 0.2s ease-in-out;
			}

			.hear-cont .menu-list.active {
				display: flex;
			}

			.loading-cont {
				height: 0.6rem;
				align-items: center;
				font-size: 0.24rem;
				color: #2289FF;
				align-items: center;
				display: inline-flex;
				align-items: center;
			}

			.loading-cont img {
				width: 0.38rem;
				margin-right: 0.1rem;
			}

			.menu-body {
				display: flex;
				flex-grow: 1;
				align-items: center;
				position: relative;
				background-color: #2e2e2e;
				height: 1rem;
				margin-right: 0.22rem;
				border-radius: 0.1rem;
				z-index: 999;
				height: 100%;
			}

			.menu-body .item {
				height: 100%;
				font-size: 0.26rem;
				color: #FFFFFF;
				display: flex;
				align-items: center;
				flex-grow: 1;
				justify-content: center;
				position: relative;
			}

			.menu-body .item img {
				width: 0.3rem;
				height: 0.3rem;
				margin-right: 0.1rem;
			}

			.menu-body .item1:after {
				content: '';
				display: block;
				position: absolute;
				width: 1px;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
				background-color: #DDDDDD;
				height: 80%;
				right: 0;
			}

			.menu-arrow {
				position: absolute;
				z-index: 9;
				overflow: hidden;
				width: 12px;
				height: 20px;
				top: 50%;
				right: -12px;
				margin-top: -12px;
				background-color: transparent;
			}

			.menu-arrow::after {
				top: 0;
				left: -18px;
				background: #2e2e2e;
				position: absolute;
				width: 22px;
				height: 22px;
				content: '';
				-webkit-transform: rotate(45deg);
				transform: rotate(45deg);
				border-radius: 1px;
			}

			.mui-backdrop {
				background-color: rgba(0, 0, 0, 0);
			}

			.create-course-btn {
				position: fixed;
				width: 100%;
				height: 1.1rem;
				background-color: #2289ff;
				color: #FFFFFF;
				font-size: 0.3rem;
				display: flex;
				align-items: center;
				justify-content: center;
				bottom: 0;
				z-index: 99;
			}

			.mui-ellipsis-2 {
				font-size: 0.28rem;
				color: #040404;
			}

			.void-course-tips {
				display: none;
				align-items: center;
				justify-content: center;
				font-size: 0.32rem;
				color: #999999;
				padding: 1rem 0 0;
			}

			.void-tips-cont {
				height: 1.2rem;
				padding-left: 0.2rem;
				display: flex;
				align-items: center;
				background-color: rgb(250, 250, 250);
				color: #DDDDDD;
			}

			.nav-right-btn {
				height: 44px;
				position: relative;
				align-items: center;
				justify-content: center;
				padding: 0 10px;
				z-index: 16;
				font-size: 14px;
				color: #333333;
				/* background-color: #007AFF; */
				margin-right: -10px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
			<h1 class="mui-title">课程列表</h1>
			<div class="nav-right-btn mui-pull-right">
				学习进度
			</div>
		</header>
		<div id="mui-content" class="mui-content " v-cloak>
			<div class="team-class-container">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" v-for="(c,idx) in teamCourse" :key="idx">
						<div class="goods-img" @tap="streaming(c.state, c.id,  c.title,c.teacher_name,c.start_time,c.end_time,c.teacher_id)">
							<img :src="c.cover_url">
						</div>
						<div class="goods-right-cont">
							<p class="mui-ellipsis-2" @tap="streaming(c.state, c.id,  c.title,c.teacher_name,c.start_time,c.end_time,c.teacher_id)">
								{{c.title}}
							</p>
							<div class="streaming-status" @tap="streaming(c.state, c.id,  c.title,c.teacher_name,c.start_time,c.end_time,c.teacher_id)">
								<p>主讲人：{{c.teacher_name}}</p>
							</div>
							<div class="hear-cont" v-if="c.state==0">
								<p @tap="streaming(c.state, c.id,  c.title,c.teacher_name,c.start_time,c.end_time,c.teacher_id)">开播：{{c.start_time}}</p>
								<div class="menu-list" :class="'menu-cont'+idx">
									<div class="menu-body">
										<!-- 箭头 -->
										<div class="menu-arrow"></div>
										<div class="item item1" @tap="editCourse(idx)"><img src="../image/icon/team-class-edit-icon.png">编辑</div>
										<div class="item" @tap="delCourse(c.id)"><img src="../image/icon/delete-team-class-w-icon.png">删除</div>
									</div>
								</div>
								<div v-if="role==1" class="more-option" @tap="showEdit(idx)">
									<span class="mui-icon mui-icon-more-filled"></span>
								</div>
							</div>
							<div v-else-if="c.state==1" class="hear-cont">
								<div class="loading-cont"><img src="../image/discover/loading.gif">培训中</div>
								<div v-if="role==1" class="delete-course" @tap="delCourse(c.id)"><img src="../image/icon/delete-team-class-icon.png">删除</div>
							</div>
							<div v-else class="hear-cont">
								<p>结束：{{c.end_time}}</p>
							</div>
						</div>
					</li>
					<!-- <li class="mui-table-view-cell">
						<div class="goods-img" @tap="streaming(1)">
							<img src="../image/5E0eH.png">
						</div>
						<div class="goods-right-cont">
							<p class="mui-ellipsis-2" @tap="streaming(1)">葫芦娃葫芦娃一根藤上七朵花，风吹雨打都不怕，啦啦啦啦啦啦啦啦啦啦，都不怕，都不怕~</p>
							<div class="streaming-status">
								<p>主讲人：old six</p>
							</div>
							<div class="hear-cont">
								<div class="loading-cont"><img src="../image/discover/loading.gif">培训中</div>
								<div class="delete-course"><img src="../image/icon/delete-team-class-icon.png">删除</div>
							</div>
						</div>
					</li> -->
				</ul>
				<div class="void-course-tips">
					暂无团队课程~
				</div>
			</div>
			<div class="create-course-btn">
				创建课程
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var userInfo = getUserInfo();
			var menuidx = '';
			var mask = mui.createMask(function() {
				if (menuidx !== '') {
					var target = document.querySelector('.menu-cont' + menuidx);
					target.classList.remove("active");
					// menuidx = '';
				}
			});
			var app = new Vue({
				el: "#mui-content",
				data: {
					teamCourse: [],
					tid: '',
					role: 0
				},
				created: function() {
					// 初始化字体大小
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束	
				},
				methods: {
					// 显示编辑菜单
					showEdit: function(i) {
						menuidx = i;
						var target = document.querySelector('.menu-cont' + i);
						target.classList.add("active");
						// if (target.classList.contains("active")) {
							mask.show();
						// } else {
							// mask.close();
						// }
					},
					//直播详情
					streaming: function(state, courseId, title, p, s, e, teid) {
						// 直播页面
						if (state != 0) {
							openPage("live_streaming.html", "live_streaming", "#f7f7f7", {
								tid: app.tid,
								courseId: courseId,
								courseTitle: title,
								teacherId: teid
							});
						} else {
							// 未开播提示
							openPage("premiere_prompt.html", "premiere_prompt", "#f7f7f7", {
								title: title,
								// 主讲人
								person: p,
								// 开始时间
								s_time: s,
								// 结束时间
								e_time: e
							});
						}
					},
					// 删除课程
					delCourse: function(course_id, idx) {
						if (menuidx != '') {
							var target = document.querySelector('.menu-cont' + idx);
							target.classList.remove("active");
						}
						plus.nativeUI.confirm("确认删除课程吗？", function(e) {
							mask.close();
							if (e.index == 1) {
								// 取消
							} else {
								mui.post($ajaxUrl + 'team&action=delete_course', {
									token: userInfo.token,
									course_id: course_id
								}, function(res) {
									if (res.errno == 0) {
										message("已删除");
										teamCourse();
										if (app.teamCourse.length == 0) {
											document.querySelector(".void-course-tips").style.display = "flex";
										}
									} else {}
								}, 'json');
							}
						})
					},
					// 编辑课程
					editCourse: function(idx) {
						var target = document.querySelector('.menu-cont' + menuidx);
						target.classList.remove("active");
						mask.close();
						openPage('create_course.html', 'create_course', '#f7f7f7', {
							edit: true,
							title: "编辑课程",
							course: app.teamCourse[idx],
							tid: app.tid
						});
					}
				},
				mounted: function() {
					mui.init({
						beforeback: function() {
							//plus.navigator.setStatusBarStyle("light");
						}
					});
					mui.plusReady(function() {
						var _self_webview = plus.webview.currentWebview();
						//plus.navigator.setStatusBarStyle("dark");
						app.tid = _self_webview.tid;
						app.role = _self_webview.role;
						teamCourse();
					})
					// 初始化两次防止页面乱
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束
				}
			})
			// 获取团队课程
			function teamCourse() {
				mui.post($ajaxUrl + 'team&action=course_list', {
					token: userInfo.token,
					team_id: app.tid
				}, function(res) {
					logs(res);
					if (res.errno == 0) {
						app.teamCourse = res.data;
						document.querySelector(".void-course-tips").style.display = "none";
					} else {
						app.teamCourse = [];
						document.querySelector(".void-course-tips").style.display = "flex";
					}
				}, 'json');
			}
			// 创建课程
			mui(".mui-content").on("tap", ".create-course-btn", function() {
				if (app.role==1) {
					openPage('create_course.html', 'create_course', '#f7f7f7', {
						tid: app.tid,
						title: '创建课程'
					});
				} else {
					plus.nativeUI.alert("您不是本团队的创建者，无创建课程权限，请悉知。");
				}
			})
			// 添加课程
			window.addEventListener('addCourse', function(e) {
				teamCourse();
			});
			// 学习进度
			mui(".mui-bar").on("tap", ".nav-right-btn", function() {
				openPage('learning_progress.html', 'learning_progress', '#f7f7f7', {
					tid: app.tid,
				});
			})
		</script>
	</body>

</html>
