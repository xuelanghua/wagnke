<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/showLoading.css" rel="stylesheet" />
		<style>
			.clearfix{
				clear: both;
			}
			p{
				color: #333333;
			}
			.mui-bar{
				background-color: #FFFFFF;
			}
			.more{
				margin-top: 0.625rem;
				font-size: 0.9375rem;
				color: #333333;
			}
			.mui-popover{
				height: 0;
			}
			.mui-popover .mui-popover-arrow{
				top: -18px;
			}
			.mui-popover .mui-popover-arrow:after{
				background-color: #333333;
			}
			.mui-backdrop{
				background: none;
			}
			.nr{
				background: #333333;
				color: #FFFFFF;
			}
			
			.mui-content{
				padding: 0;
			}
			.search{
				margin: 0.625rem;
				padding: 0 10px;
				border-radius: 0.3125rem;
				border: 1px solid #DDDDDD;
				background-color: #FFFFFF;
			}
			.mui-icon{
				font-size: 20px;
			}
			.search input{
				width: 90%;
				margin: 0;
				border: none;
				padding: 3px;
				font-size: 0.875rem;
			}
			
			.mui-card .mui-control-content {
				padding: 10px;
			}
			.mui-control-content {
				
			}
			.mui-segmented-control{
				border: none;
				background-color: #FFFFFF;
				border-radius: 0;
			}
			.mui-segmented-control .mui-control-item.mui-active {
				background-color: #FFFFFF;
				color: #F4CA3A;
				border-bottom: 2px solid #F4CA3A;
			}
			.mui-segmented-control .mui-control-item{
				border-left: none;
				font-size: 15px;
				color: #000000;
			}
			.newly_added{
				border-bottom: 1px solid #F2F2F2;
			}
			
			.chart{
				width: 1.6rem;
				height: 1.6rem;
				flex-shrink: 0;
			}
			.chart img{
				width: 100%;
				height: 100%;
			}
			.customer_information{
				font-size: 14px;
			}
			
			
			.customer-content{
				flex-grow: 1;
				padding-left: 0.2rem;
			}
			/* .customer-content h4{
				font-size: 16px;
				color: #FE4F4F;
				margin-top: 20px;
			} */
			.genduo{
				background-color: #EAEBED;
				font-size: 20px;
				color: #8F8F8F;
				line-height: 5px;
				padding: 0 8px 10px 8px;
				border-radius: 10px;
				position: absolute;
				right: 0;
			}
			.mui-table-view-cell{
				padding: 15px;
			}
			.playb{
				width: auto;
				position: absolute;
				padding: 10px 0 5px 0;
				right: 16%;
				border-radius: 5px;
				background-color: rgba(51,51,51,0.85);
				display: none;
				bottom: 2px;
			}
			.jiao{
				width: 0;
				height: 0;
				border-top: 10px solid transparent;
				border-bottom: 7px solid transparent;
				border-left: 10px solid #515151;
				float: right;
				margin-top: 10px;
				margin-right: -9px;
			}
			.play{
				width: auto;
				color: #FFFFFF;
				font-size: 12px;
				float: left;
				margin-left: 5px;
				text-align: center;
				padding: 0 0.2rem;
				line-height: 1.6;
				position: relative;
			}
			.play:after{
				content: '';
				position: absolute;
				width: 1px;
				height: 30%;
				top: 35%;
				right: 0;
				background-color: #DDDDDD;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
				opacity: 0.2;
			}
			.play:last-of-type:after{
				display: none;
			}
			.play img{
				width: 16px;
				margin: 0;
			}
			.add_merchandise{
				width: 100%;
				position: fixed;
				bottom: 0;
				padding: 15px 0;
				border: none;
				border-radius: 0;
				font-size: 16px;
				background-color: #F4CA3A;
				color: #ffffff;
			}
			.mui-table-view-cell.mui-active{
				background: #FFFFFF;
			}
			
			.mui-search input {
				background-color: #fff;
				border-radius: 0.3125rem;
				border: 1px solid #DDD;
			}
			
			/* 弹窗样式 */
			.mask-cont {
				position: fixed;
				width: 100%;
				top: 0;
				bottom: 0;
				display: flex;
				align-items: center;
				flex-direction: column;
				justify-content: center;
				background: rgba(0, 0, 0, .5);
				z-index: 9;
			}
			
			.tips-cont {
				width: 6.26rem;
				height: 7.9rem;
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			
			.tips-cont .tips-body {
				display: flex;
				align-items: center;
				flex-direction: column;
				width: 6.26rem;
				height: 6.6rem;
				background: #ffffff url("../image/tips-top-bg.jpg")center top no-repeat;
				background-size: 100% auto;
				padding-top: 3.6rem;
				border-radius: 0.1rem;
			}
			
			.tips-cont .tips-body p {
				color: #333333;
				font-size: 0.3rem;
				margin-bottom: 0.9rem;
			}
			
			.tips-cont .tips-body .immediately {
				width: 3.86rem;
				height: 0.88rem;
				background-color: #f5ca3a;
				color: #FFFFFF;
				font-size: 0.36rem;
				line-height: 0.88rem;
				text-align: center;
				border-radius: 0.45rem;
			}
			.mui-table-view::before,.mui-table-view::after{
				height: 0;
			}
			.mui-table-view{
				background: transparent;
			}
			.mui-table-view-cell{
				background-color: #FFFFFF;
				display: flex;
				align-items: center;
			}
			.mui-bar-nav~.mui-content{
				padding-top: 135px;
				padding-bottom: 60px;
			}
			.mui-scroll{
				padding-bottom: 60px;
			}
			.hot-sign {
				height: 0.24rem;
				width: auto;
				margin-right: 0.2rem;
			}
			.right-bottom-cont{
				display: flex;
				align-items: center;
				position: relative;
				color: #999999;
				font-size: 0.24rem;
			}
			.price-container{
				font-size: 0.24rem;
				padding: 0.1rem 0;
			}
			.right-bottom-cont span:first-of-type,
			.price-container span:first-of-type{
				margin-right: 0.44rem;
			}
			.price-container span:first-of-type{
				color: #F52E20;
			}
		</style>
		<script type="text/javascript">
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
		</script>
	</head>
	<body id="body_tap">
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">企业仓管理</h1>
		</header>
		<div class="mui-content" id="mui-content">
			<div style="position: fixed;top:44px;z-index: 12;background-color: #F5F6F8;width: 100%;">
				<div class="mui-input-row mui-search" style="margin: 10px 10px -5px 10px;">
					<input type="search" class="mui-input-clear" name="goods_name" placeholder="搜索商品名称">
				</div>
				<div class="newly_added">
					<div id="segmentedControl" class="mui-segmented-control">
						<a class="mui-control-item mui-active" href="#item1">出售中(<span id="on_sale">0</span>)</a>
						<a class="mui-control-item" href="#item2">售罄的(<span id="sale_out">0</span>)</a>
						<a class="mui-control-item" href="#item3">仓库中(<span id="off_sale">0</span>)</a>
					</div>
				</div>
			</div>
			<div id="goods_container">
				<div id="item1" class="mui-control-content mui-active">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view" id="item1_list" style="margin_botton: 25px;">
								<li class="mui-table-view-cell" v-for="i in 6">
									<div class="chart">
										<img src="../image/bj.jpg">
									</div>
									<div class="customer-content">
										<div class="customer_information mui-ellipsis-2" @tap="openGoodsDetail(125,i)">
											内蒙古风干牛肉干 蒙亮手撕牛肉248g蒙亮手撕牛肉248g蒙亮手撕牛肉248g蒙亮手撕牛肉248g蒙亮手撕牛肉248g
										</div>
										<div class="price-container">
											<span>提成：&yen;50.00</span>
											<span>供货价：&yen;500.00</span>
										</div>
										<div class="right-bottom-cont">
											<img class="hot-sign" src="../image/icon/team-detail-goods-icon-03.png">
											<span>销量：83</span>
											<span>库存：283</span>
											<span class="genduo">...</span>
										</div>
										<div class="playb mui-clearfix">
											<div class="jiao"></div>
											<div class="play" data-type="edit">
												<img src="../image/edit.png" />
												<div>编辑</div>
											</div>
											<div class="play" data-type="off">
												<img src="../image/lower_shelf.png" />
												<div>下架</div>
											</div>
											<div class="play" data-type="off">
												<img src="../image/on_sale.png" />
												<div>上架</div>
											</div>
											<div class="play" data-type="jh">
												<img src="../image/icon/qyecjh-icon.png" />
												<div>拣货</div>
											</div>
											<div class="play" data-type="del">
												<img src="../image/delete.png" />
												<div style="margin-top: -1px;">删除</div>
											</div>
											<div class="play" data-type="share">
												<img src="../image/extension.png" />
												<div>推广</div>
											</div>
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div id="item2" class="mui-control-content">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view" id="item2_list">
								<li class="mui-table-view-cell">
									<div class="chart mui-pull-left">
										<img src="../image/bj.jpg">
									</div>
									<div class="mui-pull-right customer-content">
										<div class="customer_information">
											内蒙古风干牛肉干 蒙亮手撕牛肉248g
										</div>
										<h4>￥58.00</h4>
										<div style="font-size: 12px;">
											<span class="mui-pull-left">库存：283</span>
											<span class="mui-pull-right genduo">...</span>
										</div>
										<div class="playb">
											<div class="jiao"></div>
											<div class="play" data-type="edit">
												<img src="../image/edit.png" />
												<div>编辑</div>
											</div>
											<div class="play" data-type="off">
												<img src="../image/lower_shelf.png" />
												<div>下架</div>
											</div>
											<div class="play" data-type="del">
												<img src="../image/delete.png" />
												<div style="margin-top: -1px;">删除</div>
											</div>
											<div class="play" data-type="share">
												<img src="../image/extension.png" />
												<div>推广</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div id="item3" class="mui-control-content">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view" id="item3_list">
								<li class="mui-table-view-cell">
									<div class="chart mui-pull-left">
										<img src="../image/bj.jpg">
									</div>
									<div class="mui-pull-right customer-content">
										<div class="customer_information">
											内蒙古风干牛肉干 蒙亮手撕牛肉248g
										</div>
										<h4>￥58.00</h4>
										<div style="font-size: 12px;">
											<span class="mui-pull-left">库存：283</span>
											<span class="mui-pull-right genduo">...</span>
										</div>
										<div class="playb">
											<div class="jiao"></div>
											<div class="play" data-type="edit">
												<img src="../image/edit.png" />
												<div>编辑</div>
											</div>
											<div class="play" data-type="off">
												<img src="../image/lower_shelf.png" />
												<div>下架</div>
											</div>
											<div class="play" data-type="del">
												<img src="../image/delete.png" />
												<div style="margin-top: -1px;">删除</div>
											</div>
											<div class="play" data-type="share">
												<img src="../image/extension.png" />
												<div>推广</div>
											</div>
											<div class="clearfix"></div>
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<button class="add_merchandise" id="add_goods">添加分销商品</button>
		</div>
		<div class="mask-cont mui-hidden">
			<div class="tips-cont">
				<div class="tips-body">
					<p>您的商品位已达上限，请购买更多商品位</p>
					<span class="immediately">立即购买</span>
				</div>
				<img class="hide_qrcode" src="../image/Close.png" style="width: 28px;height: 28px;margin-top: 30px;">
			</div>
		</div>
	</body>
</html>
<script src="../js/mui.js"></script>
<script src="../js/util.js"></script>
<script src="../js/vue.min.js"></script>
<script type="text/javascript">
	var userInfo = getUserInfo();
	var goodsName = '';
	var app = new Vue({
		el: "#mui-content",
		data: {

		},
		created: function() {
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束	
		},
		methods: {
			openGoodsDetail: function(gid, type) {
				// if (type == 1) {
				// if (type < 2) {
				// 	openPage('distributor_goods_detail_bio.html', 'distributor_goods_detail_bio', '#f7f7f7', {
				// 		gid: gid
				// 	})
				// } else {
				// 	openPage('distributor_goods_detail_mine.html', 'distributor_goods_detail_mine', '#f7f7f7', {
				// 		gid: gid
				// 	})
				// }
				
				openPage('distributor_goods_detail_mine.html', 'distributor_goods_detail_mine', '#f7f7f7', {
					gid: gid
				})
			}
		},
		mounted: function() {
			if (mui.os.ios) {
				mui.init({
					swipeBack: true,
					pullRefresh: {
						container: "#goods_container",
						down: {
							style: 'circle',
							color: '#2289FF',
							height: '50px',
							range: '100px',
							offset: '0px',
							auto: false,
							callback: function() {
								getGoodsList(true);
							}
						}
					}
				});
			} else {
				mui.init({
					swipeBack: false,
					pullRefresh: {
						container: "#goods_container",
						down: {
							style: 'circle',
							color: '#2289FF',
							height: '50px',
							range: '100px',
							offset: '0px',
							auto: false,
							callback: function() {
								getGoodsList(true);
							}
						}
					}
				});
			}
			eventInit();
			mui.plusReady(function() {
				window.addEventListener('goodsAddSuccess', function() {
					getGoodsList(false);
				})
				getGoodsList(false);
				var originalHeight = document.documentElement.clientHeight || document.body.clientHeight;
				window.onresize = function() {
					//软键盘弹起与隐藏  都会引起窗口的高度发生变化
					var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
					var paddeds = document.getElementById("add_goods");
					if (resizeHeight * 1 < originalHeight * 1) {
						paddeds.style.zIndex = '-1';
						paddeds.style.display = 'none';
					} else {
						paddeds.style.zIndex = '999';
						paddeds.style.display = 'block';
					}
				}
			})
		}
	})

	function eventInit() {
		// 搜索
		document.onkeydown = function(event) {
			var e = event || window.event || arguments.callee.caller.arguments[0];
			if (e && e.keyCode == 13) { // enter 键
				goodsName = document.querySelector('input[name=goods_name]').value;
				getGoodsList();
			}
		};
		//展示商品弹窗
		mui(".mui-table-view").on('tap', '.genduo', function(e) {
			document.querySelector(".playb").style.display = 'block';
			e.stopPropagation();
		})
		//点击窗口关闭商品操作弹窗
		document.addEventListener('tap', function() {
			mui('.playb').each(function() {
				this.style.display = 'none';
			})
		})
		mui('.mui-content').on('tap', '.play', function(e) {
			var type = this.dataset.type;
			var id = this.dataset.id;
			if (type == 'off') {
				//下架按钮
				changeGoodsStatus(0, id);
			} else if (type == 'on') {
				//上架按钮
				changeGoodsStatus(1, id);
			} else if (type == 'del') {
				//删除框
				plus.nativeUI.confirm('确认删除该商品?', function(e) {
					if (e.index == 0) {
						changeGoodsStatus(-1, id);
					}
				})
			} else if (type == 'edit') {
				//打开编辑页面
				mui.openWindow({
					id: 'goods_edit',
					url: 'goods_edit.html',
					show: {
						aniShow: 'slide-in-right'
					},
					extras: { //extras里面的就是参数了
						goods_id: id
					},
					styles: {
						statusbar: {
							background: '#FFF',
						},
					}
				});
			}
		})
		//添加商品
		document.getElementById('add_goods').addEventListener('tap', function() {
			mui.get($ajaxUrl + 'member', {
				action: 'check_goods_number',
				token: userInfo.token
			}, function(res) {
				// logs(res); 
				if (res.errno == 0) {
					fnOpenWin('goods_add.html', 'goods_add', {
						statusbar: {
							background: '#FFF'
						}
					}, '', 'slide-in-right');
				} else {
					document.querySelector(".mask-cont").classList.remove('mui-hidden');
				}
			}, 'json');

		})
		// 立即购买商品位
		mui(".mask-cont").on("tap", ".immediately", function() {
			document.querySelector(".mask-cont").classList.add('mui-hidden');
			openPage("buy_goods_booth.html", 'buy_goods_booth', '#f7f7f7', '');
		})
		// 关闭提示弹窗
		mui(".mask-cont").on("tap", ".hide_qrcode", function() {
			document.querySelector(".mask-cont").classList.add('mui-hidden');
		})
	}
	//获取商品列表
	function getGoodsList(refresh) {
		showload(0);
		mui.post($ajaxUrl + 'goods', {
			action: 'goods_list',
			token: userInfo.token,
			goods_name: goodsName
		}, function(res) {
			logs(res);
			if (refresh) {
				mui('#goods_container').pullRefresh().endPulldownToRefresh();
			}
			showload(1);
		}, 'json');
	}
	//改变商品状态
	function changeGoodsStatus(status, goods_id) {
		mui.post($ajaxUrl + 'goods', {
			action: 'change_status',
			token: userInfo.token,
			status: status,
			goods_id: goods_id
		}, function(res) {
			// logs(res);
			if (res.errno == 0) {
				message('操作成功!');
				setTimeout(function() {
					getGoodsList();
				}, 2000);
			} else {
				message('操作失败!');
			}
		}, 'json');
	}
	// 取消搜索
	mui('.mui-content').on('tap', '.mui-icon-clear', function() {
		var e = event || window.event || arguments.callee.caller.arguments[0];
		if (e && e.keyCode == 13) { // enter 键
			goodsName = '';
			getGoodsList();
		}
	})
</script>
