<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>好友详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/vip-page.css" rel="stylesheet" />
		<link href="../css/mui.picker.min.css" rel="stylesheet" />
	</head>
	<body class="mui-hidden">
		<header class="mui-bar mui-bar-nav friends-detail-header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title"></h1>
			<span class="mui-pull-right mui-icon">···</span>
		</header>
		<div  id="mui-content" class="mui-content friends-detail-container">
			<!-- 名片样式一 -->
			<div v-if="cardType=='cardType2'" class="first-card-container">
				<div class="card">
					<img class="user-head-img" :src="friendData.avatar">
					<div class="card-left-cont">
						<ul>
							<li id="first-row">{{friendData.company}}</li>
							<li id="second-row">{{friendData.name}}</li>
							<li id="third-row">{{friendData.job}}</li>
							<li id="fourth-row">{{friendData.phone}}</li>
							<li id="fifth-row">{{friendData.email}}</li>
							<li id="sixth-row">{{friendData.company_address}}</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- 名片样式一结束 -->
			<!-- 名片样式二 -->
			<div class="second-card-container" v-else>
				<div class="card">
					<img class="user-head-img" :src="friendData.avatar">
					<div class="user-info">
						<h4>{{friendData.name}}</h4>
						<p>{{friendData.job==''?'还未填写':friendData.job}}</p>
						<p>{{friendData.company_address==''?'还未填写':friendData.company_address}}</p>
					</div>
				</div>
			</div>
			<!-- 名片样式二结束 -->
			<!-- 名片信息 -->
			<!-- mui-icon-arrowdown -->
			<div class="show-card-info" id="showInfo"><span id="descText">展开全部名片信息</span><i class="mui-icon mui-icon-arrowup"></i></div>
			<div class="card-info-container">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell"><i>手机</i><span>{{friendData.phone==""?"暂无":friendData.phone}}</span><a v-if="friendData.phone"
						 :href="'tel:'+friendData.phone">拨打</a></li>
					<li class="mui-table-view-cell" v-if="cardType=='cardType1'"><i>座机</i><span>{{friendData.telephone==""?"暂无":friendData.telephone}}</span><a
						 v-if="friendData.telephone" href="tel:13700696591">拨打</a></li>
					<li class="mui-table-view-cell"><i>微信</i><span>{{friendData.wechat==""?"暂无":friendData.wechat}}</span><a v-if="friendData.wechat"
						 href="javascript:void(0)" @tap="copy_fun(friendData.wechat)">复制</a></li>
					<li class="mui-table-view-cell" v-if="cardType=='cardType1'"><i>邮箱</i><span>{{friendData.email==""?"暂无":friendData.email}}</span><a
						 v-if="friendData.email" href="javascript:void(0)" @tap="copy_fun(friendData.email)">复制</a></li>
					<li class="mui-table-view-cell"><i>公司</i><span>{{friendData.company==""?"暂无":friendData.company}}</span><a v-if="friendData.company"
						 href="javascript:void(0)" @tap="copy_fun(friendData.company)">复制</a></li>
					<li class="mui-table-view-cell"><i>地址</i><span>{{friendData.company_address==""?"暂无":friendData.company_address}}</span></li>
				</ul>
			</div>
			<div class="operation-btn-cont">
				<button type="button">分享名片</button>
				<button type="button" @tap="addAddressList">同步到通讯录</button>
			</div>
			<!-- 浏览记录 -->
			<div class="browse-record">
				<div class="browse-record-left">
					<ul class="browse-record-img-cont">
						<li class="browse-record-img" v-for="(items,index) in friendData.card_view" v-if="index<7" :key="index">
							<img :src="items.avatarUrl">
						</li>
						<span>···</span>
					</ul>
					<p>最近{{friendData.card_count}}人浏览</p>
				</div>
				<div id="reliable-btn" class="browse-record-right" @tap="reliable">
					<span class="click-heart"></span>
					<span>靠谱:{{friendData.like_count}}</span>
				</div>
			</div>
			<h5 class="personality-desc">个性签名</h5>
			<div class="personality-cont">
				<p v-html="friendData.desc"></p>
				<div class="user-info">
					<div class="user-head-img"><img src="../image/kaol.jpg"></div>
					<!-- 添加 play是播放状态的图标-->
					<div id="audio-control" class="play-control">
						<div class="left-arrow"></div>
						<i class="play-status"></i>
						<div class="right-info mui-pull-right">
							<i></i>
							<span id="timer-num">{{friendData.voice_time}}</span>
						</div>
					</div>
					<div class="click-agree" @tap="clickAgree">
						<span class="agree-icon"></span>
						<span>点赞</span>
					</div>
				</div>
			</div>
			<h5 class="personality-desc">主推商品</h5>
			<div class="goods-window">
				<ul class="goods-lists" v-if="friendData.goods !== undefined && friendData.goods.length >0 ">
					<li class="goods-item" v-for="(goods,index) in friendData.goods" :key="index">
						<div class="goods-img">
							<img src="../image/kaol.jpg">
						</div>
						<div class="goods-desc">
							<p class="goods-title mui-ellipsis-2">旺课，旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课旺课</p>
							<p class="spec">规格：默认</p>
							<p class="price">&yen;<span id="goods-price">20.00</span></p>
						</div>
					</li>
				</ul>
				<div v-else style="font-size: 0.28rem;color: #999999;">
					暂无商品
				</div>
			</div>
			<h5 class="personality-desc">图片展示</h5>
			<div class="img-show">
				<img :src="img" v-for="img in friendData.images">
			</div>
			<div class="add-friend-btn">
				<img src="../image/icon/add_friends_icon.png" class="constrain-img">
				<span>添加好友</span>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script src="../js/Zepto.min.js"></script>
		<script type="text/javascript">
			mui.init();
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			var fid = "";
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
			// 跳转到更多页面
			mui(".friends-detail-header").on("tap", "span", function() {
				fnOpenWin('friends_detail_more.html', 'friends_detail_more', {
					statusbar: {
						background: '#f7f7f7'
					}
				}, '', 'slide-in-right');
			})
			// 实例化vue对象
			var muiCont = new Vue({
				el: '#mui-content',
				data: {
					cardType: 'cardType1',
					friendData: {},
					contName: '',
					phoneNum: '',
					audiourl: ""
				},
				created: function() {},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						fid = self.fid;
						getFriendsInfo();
						// 音频播放
						var voice = null;
						var playstatus = 0;
						var voice = plus.audio.createPlayer(muiCont.audiourl);
						mui(".mui-content").on("tap", ".play-control", function() {
							if (plus.audio == undefined) {
								message("设备没有准备好！");
								return;
							}
							if (playstatus == 0) {
								voice.play(function() {
									voice.stop();
									// 播放完成停止播放
									playstatus == 0;
									$(".play-control").removeClass("play");
								}, function(e) {
									message("播放失败");
									$(".play-control").removeClass("play");
								});
								playstatus = 1;
								$(".play-control").addClass("play");
							} else if (playstatus == 1) {
								voice.pause();
								$(".play-control").removeClass("play");
								playstatus = 2;
							} else {
								voice.resume();
								playstatus = 1;
								$(".play-control").addClass("play");
							}
						})
					})
				}
			});
		
			// 获取资料
			function getFriendsInfo() {
				var userInfo = getUserInfo();
				mui.post($ajaxUrl + 'customer&action=detail&type=friend', {
					token: userInfo.token,
					user_id: fid
				}, function(res) {
					logs(res);
					var data = res.data;
					if (res.errno == 0) {
						muiCont.cardType = data.card_type;
						muiCont.contName = data.name;
						muiCont.phoneNum = data.phone;
						muiCont.friendData = data;
						muiCont.audiourl=data.voice;
						mui(".mui-title")[0].innerText=data.name;
					} else {
						message(res.errno.message)
					}
				}, 'json')
			}
			$("#showInfo").click(function() {
				$(this).find("i").toggleClass("mui-icon-arrowdown");
				var descText = $("#descText").text();
				if (descText == "展开全部名片信息") {
					$("#descText").text("收起以下名片信息");
				} else {
					$("#descText").text("展开全部名片信息");
				}
				$(".card-info-container").slideToggle();
			})
			$("body").removeClass("mui-hidden");
			// 点赞
			function clickAgree() {
				$(".click-agree").toggleClass('active');
			}
			// 靠谱
			function reliable() {
				$("#reliable-btn").toggleClass('active');
			}
			//  复制方法
			function copy_fun(copy) {
				//判断是安卓还是ios
				if (mui.os.ios) {
					//ios
					var UIPasteboard = plus.ios.importClass("UIPasteboard");
					var generalPasteboard = UIPasteboard.generalPasteboard();
					//设置/获取文本内容:
					generalPasteboard.plusCallMethod({
						setValue: copy,
						forPasteboardType: "public.utf8-plain-text"
					});
					generalPasteboard.plusCallMethod({
						valueForPasteboardType: "public.utf8-plain-text"
					});
					message("已成功复制到剪贴板");
				} else {
					//安卓
					var context = plus.android.importClass("android.content.Context");
					var main = plus.android.runtimeMainActivity();
					var clip = main.getSystemService(context.CLIPBOARD_SERVICE);
					plus.android.invoke(clip, "setText", copy);
					message("已成功复制到剪贴板");
				}
			}

			// 添加到通讯录
			function addAddressList() {
				plus.contacts.getAddressBook(plus.contacts.ADDRESSBOOK_PHONE, function(addressbook) {
					plus.nativeUI.confirm('确认将' + muiCont.contName + '（' + muiCont.phoneNum + '）添加到通讯录吗？', function(e) {
						if (e.index == 0) {
							var contact = addressbook.create();
							contact.name = {
								givenName: muiCont.contName
							};
							contact.phoneNumbers = [{
								type: "手机",
								value: muiCont.phoneNum,
								preferred: true
							}];
							contact.save(function() {
								message("添加成功");
							}, function() {
								message("添加失败");
							});
						} else {}
					}, {
						"title": "",
						"buttons": ["添加", "取消"],
						"verticalAlign": "bottom"
					});
				}, function(e) {
					message("添加失败");
				});
			}
		</script>
	</body>
</html>
