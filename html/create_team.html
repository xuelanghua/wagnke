<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>创建团队</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.create-team-container {
				background-color: #ffffff;
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			input.team-name[type=text] {
				width: 5.5rem;
				border: none;
				border-bottom: 1px solid #2289FF;
				border-radius: 0;
				margin-top: 0.9rem;
				margin-bottom: 0.8rem;
				text-align: center;
				font-size: 0.35rem;
				color: #333333;
			}

			input.team-name::-webkit-input-placeholder,
			textarea::-webkit-input-placeholder {
				color: #999999;
				font-size: 0.3rem;
				text-align: center;
			}

			textarea::-webkit-input-placeholder {
				text-align: justify;
			}

			.team-notice {
				width: 5.5rem;
				border-color: #2289FF;
				border-radius: 0.1rem;
				font-size: 0.3rem;
				color: #333333;
				padding: 0.15rem;
				margin-bottom: 0.5rem;
			}

			.invite-team-members {
				width: 100%;
				display: block;
				padding: 0.5rem 0.2rem;
			}

			.user-head-img {
				width: 0.82rem;
				height: 0.82rem;
				overflow: hidden;
				border-radius: 50%;
			}

			.user-head-img img {
				width: 100%;
				height: 100%;
			}

			.invite-team-members ul {
				margin: 0;
				padding: 0;
				list-style: none;
				display: flex;
				align-items: center;
				justify-content: flex-start;
				flex-direction: row;
				flex-wrap: wrap;
				width: 100%;
				overflow: hidden;
			}

			.invite-team-members h2 {
				font-size: 0.3rem;
				color: #333333;
				font-weight: normal;
				margin-bottom: 0.1rem;
			}

			.invite-team-members li {
				display: inline-flex;
				position: relative;
				padding-top: 0.1rem;
				padding-right: 0.1rem;
				margin-right: 0.09rem;
				margin-top: 0.2rem;
			}

			.invite-team-members li .mui-icon {
				position: absolute;
				right: 5px;
				top: 5px;
				color: #ffffff;
				background-color: #f42d2d;
				border-radius: 50%;
				padding: 0;
				font-size: 14px;
			}

			.mui-btn {
				width: 7.1rem;
				height: 0.99rem;
				border-radius: 0.1rem;
				background-color: #2289ff;
				padding: 0;
				font-size: 0.3rem;
				margin-top: 0.45rem;
				margin-bottom: 0.45rem;
			}

			.invite-team-members ul.mui-table-view {
				margin-bottom: 10px;
			}

			.mui-table-view .mui-table-view-cell {
				display: flex;
				width: 100%;
				align-items: center;
				justify-content: space-between;
				margin: 0;
				margin-bottom: 0.06rem;
				padding: 0;
				height: 1.2rem;
				font-size: 0.30rem;
			}

			.mui-switch-blue.mui-active {
				border: 2px solid #2289ff;
				background-color: #2289ff;
			}

			.mui-table-view .mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			[v-cloak] {
				display: none;
			}

			.mui-table-view:after {
				display: none;
			}

			.mui-table-view-cell:after {
				left: 0;
			}

			.mui-table-view-cell:last-child:after {
				height: 1px;
				left: 0;
			}

			.mui-table-view-cell {
				height: 1rem;
			}

			.mui-input-row {
				width: 100%;
			}

			.team-type {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.team-type.mui-radio input[type=radio] {
				position: absolute;
				top: 50%;
				margin-top: -14px;
			}

			.team-type label {
				padding-left: 0;
			}

			.team-type p {
				font-size: 0.24rem;
				color: #999999;
			}

			.team-type .title {
				font-size: 0.3rem;
				color: #333333;
				margin-bottom: 2px;
			}

			.cover-list .select-img {
				margin-right: 0.7rem;
				color: #999999;
			}

			.cover-list .mui-navigate-right:after {
				color: #999999;
				font-size: 0.36rem;
			}

			.cover-img {
				width: 80px;
				max-height: 1rem;
				object-fit: cover;
				margin-right: 0.7rem;
			}
		</style>
		<script type="text/javascript">
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">创建团队</h1>
		</header>

		<div id="create-team" class="mui-content create-team-container" v-cloak>
			<input class="team-name" type="text" v-model="teamName" maxlength="10" placeholder="填写团队名称（2~10个字）" />
			<textarea class="team-notice" rows="6" cols="3" v-model="notice" maxlength="150" placeholder="填写团队公告"></textarea>
			<div class="invite-team-members">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell cover-list">
						<div class="mui-input-row mui-radio team-type" data-team="2">
							<span class="mui-navigate-right">团队封面</span>
							<img v-if="coverImg" class="cover-img" :src="coverImg">
							<span v-else class="select-img">请选择</span>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="mui-input-row mui-radio team-type" data-team="2">
							<label for="data-team">
								<p class="title">数据团队</p>
								<p>只展示团队数据。</p>
							</label>
							<input id="data_team" name="team" type="radio" checked="checked">
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="mui-input-row mui-radio team-type" data-team="1">
							<label for="official_team">
								<p class="title">正式团队</p>
								<p>即可以查看团队数据，又可以进行团队分销。</p>
							</label>
							<input id="official_team" name="team" type="radio">
						</div>
					</li>
					<li class="mui-table-view-cell">
						<span>数据查看</span>
						<div class="mui-switch mui-switch-blue">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
				</ul>
				<h2 class="title">邀请团队成员({{uids.length}})</h2>
				<ul>
					<li v-for="(list,index) in imagePath" :key="index" @tap="delChecked(index)">
						<div class="user-head-img">
							<img :src="list" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<!--<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li>
					<li>
						<div class="user-head-img">
							<img type="image" src="../image/bj.jpg" />
						</div>
						<span class="mui-icon mui-icon-closeempty"></span>
					</li> -->
					<li>
						<div class="user-head-img member-selection">
							<img type="image" src="../image/team-detail-img05.png" />
						</div>
					</li>
				</ul>
			</div>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block" id="create-group">提交</button>
		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/util.js"></script>
	<script src="../js/vue.min.js"></script>
	<script type="text/javascript">
		mui.init();
		var userInfo = getUserInfo();
		var app = new Vue({
			el: '#create-team',
			data: {
				headImg: [],
				uids: [],
				teamName: '',
				notice: '',
				imagePath: [],
				data_status: false,
				teamType: '2',
				coverImg: '',
				uploadCover: 'images/6/2019/05/team_bg.jpg'
			},
			mounted: function() {
				// mui('.mui-content .mui-switch').each(function() {
				// 	//toggle.classList.contains('mui-active') 可识别该toggle的开关状态
				// 	// this.parentNode.querySelector('span').innerText = '状态：' + (this.classList.contains('mui-active') ? 'true' : 'false');
				// 	this.addEventListener('toggle', function(event) {
				// 		//event.detail.isActive 可直接获取当前状态
				// 		// this.parentNode.querySelector('span').innerText = '状态：' + (event.detail.isActive ? 'true' : 'false');
				// 	});
				// });
			},
			methods: {
				delChecked: function(i) {
					this.imagePath.splice(i, 1);
					this.uids.splice(i, 1);
				}
			}
		})
		mui(".mui-content").on('tap', '.member-selection', function() {
			openPage('team_member_selection.html', 'team_member_selection', '#f7f7f7', {
				uids: app.uids
			})
		})
		// 创建团队
		mui(".mui-content").on('tap', '#create-group', function() {
			document.activeElement.blur();
			// logs(app.uids);
			if(!app.teamName){
				message("团队名称不能为空");
				return;
			}else if(app.teamName.length>10){
				message("团队名称不能超过十个字");
				return;
			}
			mui.post($ajaxUrl + 'team&action=create', {
				token: userInfo.token,
				name: app.teamName,
				type: app.teamType,
				cover: app.uploadCover,
				notice: app.notice,
				uids: app.uids.join(","),
				data_status: app.data_status,
			}, function(res) {
				// logs(res);
				if (res.errno == 0) {
					message("创建成功！");
					mui.fire(plus.webview.getWebviewById('team_list'), 'refreshTeamList');
					mui.fire(plus.webview.getWebviewById('home'), 'refreshTeamList');
					setTimeout(function() {
						plus.webview.close('create_team');
						plus.webview.close('boss_team');
					}, 800)
				} else {
					message(res.message);
				}
			}, 'json');
		})
		window.addEventListener('doit', function(e) {
			//获取参数值
			app.imagePath = e.detail.imagePath;
			app.uids = e.detail.idGroup;
			// logs(e.detail)
		});
		// 查看数据权限
		mui('.mui-content').on('toggle', '.mui-switch', function(event) {
			if (event.detail.isActive) {
				app.data_status = 1;
			} else {
				app.data_status = 0;
			}
		})
		// 团队类型选择
		mui('.mui-content').on('tap', '.team-type', function() {
			app.teamType = this.dataset.team;
		})
		// 团队封面图选择
		var ratio = 550 / 290;
		mui('.mui-content').on('tap', '.cover-list', function() {
			document.activeElement.blur();
			var editButtons = new Array();
			editButtons.push({
				title: "拍照上传",
				style: "default"
			});
			editButtons.push({
				title: "从相册选择",
				style: "default"
			});
			plus.nativeUI.actionSheet({
				cancel: "取消",
				buttons: editButtons
			}, function(e) {
				var index = e.index;
				switch (index) {
					case 1:
						getImage(ratio); //拍照
						break;
					case 2:
						galleryImage(ratio); //相册选择
						break;
				}
			});
		});
		// 拍照获取图片
		function getImage() {
			var camera = plus.camera.getCamera();
			camera.captureImage(function(e) {
				plus.io.resolveLocalFileSystemURL(e, function(entry) {
					cropperImg(entry.toLocalURL(), 'create_team', ratio);
					// imageResize(entry.toLocalURL());
					// 其他操作,比如预览展示
				}, function(e) {
					console.log("读取拍照文件错误：" + e.message);
				});
			}, function(s) {
				console.log("error" + s);
			}, {
				filename: "_doc/camera/"
			})
		}
		// 从相册中选择图片 
		function galleryImage(cb) {
			// 从相册中选择图片
			plus.gallery.pick(function(e) {
				cropperImg(e, 'create_team', ratio);
			}, function(e) {
				console.log("取消选择图片");
			}, {
				filter: "image",
				multiple: false,
				maximum: 5,
				system: false,
				onmaxed: function() {
					plus.nativeUI.alert('最多只能选择1张图片');
				}
			});
		}
		window.addEventListener('cropperSuccess', function(event) {
			showload(0, 0, '图片加载中…', "rgba(0,0,0,0.5)");
			app.uploadCover = event.detail.filename;
			app.coverImg = event.detail.image;
			setTimeout(function() {
				showload(1);
			}, Math.floor(Math.random() * 1000 + 1000));
		})
		// })
	</script>
</html>
