<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/animate.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			.notice-container {
				height: 39px;
				width: 100%;
				background-color: #FFFFFF;
				position: relative;
				overflow: hidden;
			}

			.mui-icon-arrowright {
				position: absolute;
				right: 5px;
				top: 50%;
				margin-top: -10px;
				font-size: 20px;
			}

			.swiper-slide {
				height: 39px;
				display: flex;
				align-items: center;
				padding-left: 10px;
				color: #CC9C2D;
				font-size: 0.24rem;
			}

			.top-container {
				width: 100%;
				height: 5.56rem;
				background: #FFFFFF url("../image/icon/store-management-icon-01.png") center top no-repeat;
				background-size: 100%;
				overflow: hidden;
				position: relative;
			}

			.top-cont {
				position: absolute;
				width: 6.9rem;
				left: 50%;
				margin-left: -3.45rem;
				background-color: #FFFFFF;
				height: 4.58rem;
				bottom: 0.2rem;
				border-radius: 0.3rem;
				padding: 0 0.1rem;
			}

			.header-cont {
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0.42rem 0;
			}

			.last-header-cont:after {
				content: '';
				position: absolute;
				display: block;
				top: 0;
				left: 2%;
				width: 96%;
				height: 1px;
				background-color: #DDDDDD;
				-webkit-transform: scaleY(0.5);
				transform: scaleY(0.5);
			}

			.header-cont .header-items {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				color: #333333;
				font-size: 0.24rem;
				position: relative;
				width: 33.3333%;
				/* background-color: #0062CC; */
			}

			.header-cont .header-items span:last-of-type {
				color: #CC9C2D;
				font-size: 0.3rem;
				margin-top: 5px;
			}

			.asset-center {
				width: 4.37rem;
				height: 0.9rem;
				background-color: #F5CA3A;
				border-radius: 0.45rem;
				display: flex;
				align-items: center;
				justify-content: center;
				margin: 0 auto;
				color: #FFFFFF;
				font-size: 0.3rem;
			}

			.header-cont .header-items:nth-of-type(2):after,
			.header-cont .header-items:nth-of-type(2):before {
				content: '';
				width: 1px;
				height: 50%;
				top: 25%;
				background-color: #DDDDDD;
				position: absolute;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
			}

			.header-cont .header-items:nth-of-type(2):after {
				right: 0;
			}

			.header-cont .header-items:nth-of-type(2):before {
				left: 0;
			}

			.menu-card {
				border-radius: 0.3rem;
				position: relative;
				overflow: hidden;
				width: 92%;
				margin: 0.2rem auto;
				height: auto;
				background-color: #FFFFFF;
				padding: 0.2rem 0 0.3rem;
				box-sizing: border-box;
			}

			.headline {
				font-size: 0.3rem;
				color: #333333;
				margin-bottom: 0.3rem;
				padding-left: 0.2rem;
				padding-right: 0.2rem;
			}

			.menu-body {
				display: flex;
				align-items: center;
			}

			.menu-items {
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				width: 33.33333%;
				font-size: 0.24rem;
				color: #999999;
			}

			.menu-items img {
				height: 0.5rem;
				width: auto;
				margin-bottom: 0.15rem;
			}

			.menu-card-container {
				/* padding-bottom: 50px; */
				padding-bottom: 0.2rem;
			}

			/* 弹窗样式 */

			.mask-cont {
				position: fixed;
				width: 100%;
				top: 0;
				bottom: 0;
				display: flex;
				align-items: center;
				flex-direction: column;
				justify-content: center;
				background: rgba(0, 0, 0, .5);
				z-index: 9;
			}

			.tips-cont {
				position: fixed;
				width: 6.26rem;
				height: 7.9rem;
				top: 20%;
				left: 0.62rem;
				display: flex;
				flex-direction: column;
				align-items: center;
				z-index: 1045;
			}

			.tips-cont .tips-body {
				display: flex;
				align-items: center;
				flex-direction: column;
				width: 6.26rem;
				height: 6.6rem;
				background: #ffffff url("../image/tips-top-bg.jpg")center top no-repeat;
				background-size: 100% auto;
				padding-top: 3.6rem;
				border-radius: 0.1rem;
			}

			.tips-cont .tips-body p {
				color: #333333;
				font-size: 0.3rem;
				margin-bottom: 0.9rem;
			}

			.tips-cont .tips-body .immediately {
				width: 3.86rem;
				height: 0.88rem;
				background-color: #f5ca3a;
				color: #FFFFFF;
				font-size: 0.36rem;
				line-height: 0.88rem;
				text-align: center;
				border-radius: 0.45rem;
			}

			/* 主力商品 */
			.primary-goods .mui-table-view:before,
			.primary-goods .mui-table-view:after {
				height: 0;
			}

			.primary-goods .goods-list {
				position: relative;
				display: flex;
				align-items: center;
				padding: 0.36rem 0.2rem 0.2rem;
				overflow: hidden;
			}

			.primary-goods .goods-list:after {
				left: 2.3rem;
				background-color: #DDDDDD;
			}

			.primary-goods .goods-list:last-of-type:after {
				height: 1px;
			}

			.goods-list .goods-right {
				flex-grow: 1;
			}

			.goods-img {
				width: 2rem;
				height: 2rem;
				display: flex;
				overflow: hidden;
				flex-shrink: 0;
				margin-right: 0.28rem;
			}

			.goods-img img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.goods-list .goods-title {
				color: #333333;
				font-size: 0.28rem;
				margin-bottom: 0.28rem;
				min-height: 0.66rem;
			}

			.goods-list .goods-info {
				font-size: 0.24rem;
				color: #F52E20;
				padding-bottom: 0.05rem;
			}

			.price-text {
				color: #333333;
				margin-left: 0.44rem;
			}

			.goods-right-bottom {
				display: flex;
				align-items: center;
				position: relative;
				font-size: 0.24rem;
				color: #999999;
			}

			.goods-right-bottom span:first-of-type {
				margin-right: 0.32rem;
			}

			.goods-list .add-entrepot {
				width: 0.38rem;
				height: 0.38rem;
				position: absolute;
				right: 0.1rem;
				z-index: 6;
			}

			.team-name {
				position: relative;
				font-size: 0.24rem;
				color: #999999;
				margin-top: 5px;
				line-height: 1;
				padding: 0;
				overflow: hidden;
				display: flex;
				align-items: center;
				width: 0.9rem;
			}

			.mui-backdrop.mui-active {
				background-color: rgba(0, 0, 0, 0.3);
			}

			.mui-popover .mui-popover-arrow:after {
				background: #FFFFFF;
				/* box-shadow: 0 0 3px 0 rgba(0, 0, 0, .3); */
				z-index: 1;
			}

			.mui-popover-bottom .mui-table-view {
				background: #FFFFFF;
				color: #666;
				/* box-shadow: 0 0 3px 0 rgba(0, 0, 0, .3); */
				font-size: 14px;
				color: #999;
			}

			.mui-popover-bottom .mui-table-view-cell:after {
				left: 15px;
				right: 15px;
				background-color: #DDDDDD;
			}

			.team-name .mui-icon.mui-icon-arrowright {
				font-size: 15px;
				position: relative;
				top: 0;
				right: 0;
				margin-left: 0;
				margin-top: -1px;
			}

			.mui-table-view-cell.mui-active {
				background-color: #FFFFFF;
			}

			.goods-list:first-of-type {
				padding-top: 0;
			}

			.change-list {
				font-size: 0.3rem;
				color: #CC9C2D;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<span class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></span>
			<h1 class="mui-title">店铺管理</h1>
		</header>
		<div id="mui-content" class="mui-content " v-cloak>
			<div id="notice_container" class="notice-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide" :data-idx="index" v-for="(n,index) in notice">{{n.title}}</div>
				</div>
				<span class="mui-icon mui-icon-arrowright"></span>
			</div>
			<div class="top-container">
				<div class="top-cont">
					<div class="header-cont">
						<div class="header-items">
							<span>今日收益</span>
							<span>{{statistics.today}}</span>
						</div>
						<div class="header-items">
							<span>累计收益</span>
							<span>{{statistics.all}}</span>
						</div>
						<div class="header-items">
							<span>浏览量</span>
							<span>{{statistics.view}}</span>
						</div>
					</div>
					<div class="header-cont last-header-cont">
						<div class="header-items">
							<span>供货收益</span>
							<span>{{statistics.goods}}</span>
						</div>
						<div class="header-items">
							<span>分销收益</span>
							<span>{{statistics.commission}}</span>
						</div>
						<div class="header-items" id="deliver">
							<span>待发货</span>
							<span>{{statistics.deliver}}</span>
						</div>
					</div>
					<div class="asset-center">
						资产中心
					</div>
				</div>
			</div>
			<div class="menu-card-container">
				<div class="menu-card">
					<div class="headline">
						通用
					</div>
					<div class="menu-body">
						<div class="menu-items" id="shop_manage">
							<img src="../image/icon/store-management-icon-02.png">
							<span>店铺管理</span>
						</div>
						<div class="menu-items" id="order_manage">
							<img src="../image/icon/store-management-icon-03.png">
							<span>订单管理</span>
						</div>
						<div class="menu-items mui-hidden" id="sales_return">
							<img src="../image/icon/shop_index_01.png">
							<span>退货</span>
						</div>
					</div>
				</div>
				<div class="menu-card">
					<div class="headline">
						企业仓库
					</div>
					<div class="menu-body">
						<div class="menu-items" id="warehouse-management">
							<img src="../image/icon/store-management-icon-04.png">
							<span>企业仓管理</span>
						</div>
						<div class="menu-items" id="stock_goods">
							<img src="../image/icon/store-management-icon-05.png">
							<span>拣货分销</span>
						</div>
						<div class="menu-items" id="add_distribution_goods">
							<img src="../image/icon/store-management-icon-06.png">
							<span>添加分销商品</span>
						</div>
					</div>
				</div>
				<div class="menu-card">
					<div class="headline">
						个人商城
					</div>
					<div class="menu-body">
						<div class="menu-items" id="goods_manage">
							<img src="../image/icon/store-management-icon-07.png">
							<span>商品管理</span>
						</div>
						<div class="menu-items" id="goods_add">
							<img src="../image/icon/store-management-icon-08.png">
							<span>商品添加</span>
						</div>
					</div>
				</div>
				<div class="menu-card mui-hidden">
					<div class="headline">
						营销活动
					</div>
					<div class="menu-body">
						<div class="menu-items">
							<img src="../image/icon/store-management-icon-09.png">
							<span>拼团</span>
						</div>
						<div class="menu-items">
							<img src="../image/icon/store-management-icon-10.png">
							<span>砍价</span>
						</div>
					</div>
				</div>
				<!-- 爆款推荐 -->
				<div class="menu-card" v-if="hot_goods.length>0">
					<div class="headline">
						<span>爆款热荐</span>
						<span class="mui-pull-right change-list animated">换一批</span>
					</div>
					<div class="primary-goods">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell goods-list" v-for="(goods,index) in hot_goods" :key="index">
								<div class="goods-img" @tap="openGoodsDetail(goods.id)">
									<img :src="goods.cover">
								</div>
								<div class="goods-right">
									<p class="goods-title mui-ellipsis-2" @tap="openGoodsDetail(goods.id)">
										{{goods.name}}
									</p>
									<div class="goods-info" @tap="openGoodsDetail(goods.id)">
										<span class="wage-text">提成：&yen;{{goods.commission}}</span>
										<span class="price-text">供货价：&yen;{{goods.settlement_price}}</span>
									</div>
									<div class="goods-right-bottom">
										<span @tap="openGoodsDetail(goods.id)">销量&nbsp;{{goods.sale_count}}</span>
										<!-- <span @tap="openGoodsDetail(goods.id)">95%&nbsp;好评</span> -->
										<img v-if="goods.is_pick==0" :data-gid="goods.id" class="add-entrepot add-entrepot-btn" src="../image/icon/jianhuo-active.png">
										<img v-else class="add-entrepot" src="../image/icon/jianhuo.png">
									</div>
									<div class="team-name" :data-idx="index">
										<span>货源</span>
										<span class="mui-icon mui-icon-arrowright"></span>
									</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="tips-cont mui-hidden">
				<div class="tips-body">
					<p>您的商品位已达上限，请购买更多商品位</p>
					<span class="immediately">立即购买</span>
				</div>
				<img class="hide_qrcode" src="../image/Close.png" style="width: 28px;height: 28px;margin-top: 30px;">
			</div>
			<!-- 团队弹窗 -->
			<div id="bottomPopover" class="mui-popover mui-popover-bottom">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" v-for="(t,i) in team_list" :key="i" @tap="teamdetail(t.id,t.captain_uid)">
						{{t.name}}
					</li>
				</ul>
			</div>
		</div>

		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/swiper.min.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var skip = 1;
			var userInfo = getUserInfo();
			var mask = mui.createMask(function() {
				document.querySelector(".tips-cont").classList.add("mui-hidden");
			});
			var app = new Vue({
				el: "#mui-content",
				data: {
					// 公告
					notice: [],
					hot_goods: [],
					team_list: [],
					statistics: {
						all: 0.00,
						today: 0.00,
						goods: 0.00,
						commission: 0.00,
						view: 0,
						deliver: 0
					}
				},
				created: function() {
					// 初始化字体大小
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束	
				},
				methods: {
					openGoodsDetail: function(gid) {
						openPage('distributor_goods_detail.html', 'distributor_goods_detail', '#f7f7f7', {
							gid: gid
						})
						// openPage('distributor_goods_detail_mine.html', 'distributor_goods_detail_mine', '#f7f7f7', {
						// 	gid: gid
						// })
					},
					// 打开团队详情
					teamdetail: function(id, cpt) {
						openPage('team_detail.html', 'team_detail', '#f7f7f7', {
							teamid: id
						});
					}
				},
				mounted: function() {
					mui.init({
						beforeback: function() {
							plus.navigator.setStatusBarStyle("light");
						}
					});
					mui.plusReady(function() {
						getNotice();
						getHotGoodsList();
						getStatistics();
						var self = plus.webview.currentWebview();
						// 去掉滚动条
						self.setStyle({
							scrollIndicator: 'none',
						});
					})
					// 初始化两次防止页面乱
					var viewport = document.documentElement.clientWidth;
					if (viewport > 750) {
						viewport = 750
					}
					document.documentElement.style.fontSize = viewport / 7.5 + "px";
					// 初始化字体大小结束
				}
			})

			//公告滚动初始化
			function scrollInit() {
				var mySwiper = new Swiper('#notice_container', {
					direction: 'vertical',
					loop: true,
					autoplay: {
						delay: 3000,
						stopOnLastSlide: false,
						disableOnInteraction: false,
					},
				})
			}

			//获取统计数据
			function getStatistics() {
				mui.post($ajaxUrl + 'shop', {
					action: 'index',
					token: userInfo.token
				}, function(res) {
					logs(res);
					app.statistics = res.data;
				}, 'json');
			}

			//获取公告
			function getNotice() {
				mui.post($ajaxUrl + 'notice', {
					action: 'list'
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						app.notice = res.data;
						if (app.notice.length > 1) {
							setTimeout(function() {
								scrollInit();
							}, 500);
						}
					} else {
						console.log(res.message);
					}
				}, 'json')
			}
			// 查看公告详情
			mui(".mui-content").on("tap", ".swiper-slide", function() {
				var idx = this.dataset.idx;
				openPage('notice_detail.html', 'notice_detail', '#ffffff', {
					notice: app.notice[idx],
					page: 'shop_index'
				});
				// fnOpenWin('notice_detail.html', 'notice_detail', {
				// 	statusbar: {
				// 		background: '#ffffff'
				// 	}
				// }, {
				// 	notice: app.notice[idx],
				// 	page: 'shop_index'
				// }, 'slide-in-right');
			})
			// 资产中心
			mui(".mui-content").on("tap", ".asset-center", function() {
				plus.navigator.setStatusBarStyle("light");
				fnOpenWin('shop_asset_management.html', 'shop_asset_management', {
					statusbar: {
						background: '#f5c939'
					}
				}, '', 'slide-in-right');
			})
			//店铺管理
			mui(".mui-content").on("tap", "#shop_manage", function() {
				openPage('shop_setting.html', 'shop_setting', '#ffffff');
			});
			//退货
			mui(".mui-content").on("tap", "#sales_return", function() {
				openPage('sales_return.html', 'sales_return', '#f7f7f7');
			});

			//商品管理
			mui(".mui-content").on("tap", "#goods_manage", function() {
				openPage('goods_list.html', 'goods_list', '#ffffff');
			});

			//订单管理
			mui(".mui-content").on("tap", "#order_manage, #deliver", function() {
				openPage('order_list.html', 'order_list', '#f7f7f7');
			});

			//拣货分销
			mui(".mui-content").on("tap", "#stock_goods", function() {
				openPage('choose_goods.html', 'choose_goods', '#ffffff');
			});

			//添加分销商品
			mui(".mui-content").on("tap", "#add_distribution_goods", function() {
				openPage('add_distribution_goods.html', 'add_distribution_goods', '#f7f7f7');
			});
			//添加分销商品
			mui(".mui-content").on("tap", "#warehouse-management", function() {
				openPage('warehouse_management.html', 'warehouse_management', '#ffffff');
			});
			//添加商品
			document.getElementById('goods_add').addEventListener('tap', function() {
				mui.get($ajaxUrl + 'member', {
					action: 'check_goods_number',
					token: userInfo.token
				}, function(res) {
					if (res.errno == 0) {
						openPage('goods_add.html', 'goods_add', '#ffffff', '');
					} else {
						document.querySelector(".tips-cont").classList.remove("mui-hidden");
						mask.show();
					}
				}, 'json');
			});
			// 防止弹窗滑动穿透
			document.querySelector(".tips-cont").addEventListener("touchmove", mui.preventDefault);
			// 关闭提示弹窗
			mui(".mui-content").on("tap", ".hide_qrcode", function() {
				mask.close();
			})
			// 换一批
			mui(".mui-content").on("tap", ".change-list", function() {
				var _self = this;
				this.classList.add("tada");
				setTimeout(function() {
					_self.classList.remove("tada");
				}, 1000);
				skip += 1;
				showload();
				getHotGoodsList();
			})
			// 显示团队
			mui(".mui-content").on("tap", ".team-name", function() {
				var idx = this.dataset.idx;
				app.team_list = app.hot_goods[idx].team_info;
				mui('#bottomPopover').popover("show", this);
			})
			// 拣货
			mui(".mui-content").on("tap", ".add-entrepot-btn", function() {
				var gid = this.dataset.gid;
				openPage('setting_distribution_goods.html', 'setting_distribution_goods', '#f7f7f7', {
					gid: gid
				});
			})
			// 获取爆品
			function getHotGoodsList() {
				// logs(skip);
				mui.post($ajaxUrl + 'goods&action=team_hot_goods', {
					token: userInfo.token,
					skip: skip,
					limit: 4,
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						app.hot_goods = res.data;
						app.team_list = res.data[0].team_info;
						showload(1, 1200);
					} else {
						skip = 1;
						getHotGoodsList();
					}
				}, 'json');
			}
		</script>
	</body>

</html>
