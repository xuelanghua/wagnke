<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>加入团队</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.join-team-container {
				background-color: #ffffff;
			}

			.create-team-btn {
				height: 100%;
				display: flex;
				align-items: center;
				color: #2289ff;
				font-size: 0.3rem;
				position: relative;
				z-index: 999;
			}

			.search-cont .mui-icon-search {
				position: absolute;
				left: 0.25rem;
				color: #999999;
				top: 50%;
				transform: translateY(-50%);
			}

			.search-cont {
				position: relative;
				display: flex;
				width: 100%;
				padding: 0.3rem 0.2rem;
				align-items: center;
			}

			.search-cont img {
				width: 0.54rem;
				height: 0.54rem;
				margin: 0 0.3rem 0 0.5rem;
			}

			.search-cont input {
				margin-bottom: 0;
				padding-left: 0.6rem;
				padding-right: 0.6rem;
				border-radius: 0.1rem;
				background-color: #f2f2f2;
				border: none;
				height: 0.7rem;
				font-size: 0.3rem;
			}

			.search-cont input::-webkit-input-placeholder {
				color: #999999;
				font-size: 0.3rem;
			}



			.mui-input-row .mui-input-clear~.mui-icon-clear {
				position: absolute;
				right: 1.5rem;
				color: #999999;
				top: 0.45rem;
			}

			.search-cont::after {
				content: '';
				display: block;
				height: 1px;
				width: 100%;
				bottom: 0;
				left: 0;
				position: absolute;
				background-color: #dddddd;
				transform: scaleY(0.5);
				-webkit-transform: scaleY(0.5);
			}

			.mui-table-view::after,
			.mui-table-view::before {
				height: 0;
			}

			.mui-btn-outlined {
				width: 1.34rem;
				height: 0.6rem;
				padding: 0;
				border-radius: 0.1rem;
				font-size: 0.3rem;
				color: #2289ff;
				background-color: #ffffff;
				border-color: #2289FF;
			}

			.mui-btn:enabled:active,
			.mui-btn-outlined:active {
				background-color: #ffffff;
				color: #2289ff;
			}

			.mui-pull-left span {
				font-size: 0.3rem;
				color: #333333;

			}

			.mui-pull-left .num-cont {
				background-color: #2288FF;
				display: inline-flex;
				align-items: center;
				border-radius: 0.05rem;
				color: #FFFFFF;
				font-size: 0.2rem;
				height: 0.29rem;
				padding: 0 5px;
				overflow: hidden;
				margin-left: 0.05rem;
			}

			.num-cont img {
				width: 0.18rem;
				height: 0.18rem;
				margin-right: 0.1rem;
			}

			.team-section {
				display: flex;
				align-items: center;
				padding: 0;
			}

			.mui-pull-left p {
				margin-bottom: 0;
			}

			.team-num {
				color: #999999;
				font-size: 0.24rem;
			}

			.mui-table-view-cell {
				padding-top: 0.3rem;
			}

			/* 验证弹窗 */
			.join-team-verify {
				position: fixed;
				z-index: 996;
				top: 0;
				bottom: 0;
				width: 100%;
				background: rgba(0, 0, 0, 0.6);
				display: flex;
				align-items: center;
				justify-content: center;
				flex-direction: column;
				display: none;
			}


			.verift-body {
				width: 80%;
				background-color: #ffffff;
				border-radius: 0.2rem;
				position: relative;
				overflow: hidden;
				padding-top: 0.1rem;
			}

			.verift-footer:before {
				content: '';
				display: block;
				height: 1px;
				width: 100%;
				top: 0;
				left: 0;
				position: absolute;
				background-color: #dddddd;
				transform: scaleY(0.5);
				-webkit-transform: scaleY(0.5);
			}

			.verift-body textarea {
				margin-bottom: 0;
				border-color: #fefefe;
				margin-bottom: 1px;
				font-size: 0.3rem;
			}

			.verift-footer {
				position: relative;
				display: flex;
				justify-content: center;
			}

			.verift-footer .mui-btn {
				width: 100%;
				height: 100%;
				padding: 0.3rem 0.2rem;
			}

			.close-verify-window:before {
				content: '';
				display: block;
				height: 100%;
				width: 1PX;
				top: 0;
				bottom: 0;
				right: 0;
				position: absolute;
				background-color: #dddddd;
				transform: scaleX(0.5);
				-webkit-transform: scaleX(0.5);
			}

			.void-tips {
				width: 100%;
				padding: 2rem 0;
				text-align: center;
				color: #999999;
			}
		</style>
	</head>

	<body class="mui-hidden">
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">加入团队</h1>
			<span class="mui-pull-right create-team-btn">创建团队</span>
		</header>

		<div id="mui-content" class="mui-content join-team-container">
			<div class="mui-input-row search-cont">
				<span class="mui-icon mui-icon-search"></span>
				<input id="search" type="text" v-model="keywords" class="mui-input-clear" placeholder="团队名称/团队号">
				<img id="open-scan" src="../image/boos-team-img02.png">
			</div>
			<div class="search-result">
				<ul class="mui-table-view" v-if="result.length>0">
					<!-- <ul class="mui-table-view"> -->
					<li class="mui-table-view-cell" v-for="(items,index) in result" :key="index">
						<div class="mui-pull-left">
							<div class="team-section">
								<span>{{items.name}}</span>
								<span class="num-cont"><img src="../image/boos-team-img03.png" alt="">{{items.current_number}}人</span>
							</div>
							<p class="team-num">团队号:{{items.id}}</p>
						</div>
						<div class="mui-pull-right">
							<button type="button" class="mui-btn mui-btn-outlined" @tap="join(items.id)">加入</button>
						</div>
					</li>
					<!-- <li class="mui-table-view-cell">
						<div class="mui-pull-left">
							<div class="team-section">
								<span>我的小队</span>
								<span class="num-cont"><img src="../image/boos-team-img03.png" alt="">69人</span>
							</div>
							<p class="team-num">团队号:123456</p>
						</div>
						<div class="mui-pull-right">
							<button type="button" class="mui-btn mui-btn-outlined" @tap="join('12345')">加入</button>
						</div>
					</li> -->
				</ul>
				<div v-else class="void-tips">暂无相关结果~</div>
			</div>
			<div class="join-team-verify" v-show="isVerify">
				<div class="verift-body">
					<textarea v-model="remark" rows="3" placeholder="请输入验证信息"></textarea>
					<div class="verift-footer">
						<button type="button" class="mui-btn mui-btn-link close-verify-window">取消</button>
						<button type="button" class="mui-btn mui-btn-link send-verify">发送</button>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/util.js"></script>
	<script src="../js/vue.min.js"></script>
	<script type="text/javascript">
		mui.init();
		// 初始化字体大小
		var userInfo = getUserInfo();
		var viewport = document.documentElement.clientWidth;
		var teamid = '';
		if (viewport > 750) {
			viewport = 750
		}
		document.documentElement.style.fontSize = viewport / 7.5 + "px";
		document.querySelector(".mui-hidden").classList.remove("mui-hidden");
		// 初始化字体大小结束
		mui.plusReady(function() {})

		var app = new Vue({
			el: "#mui-content",
			data() {
				return {
					keywords: '',
					result: [],
					isVerify: false,
					teamId: '',
					remark: ''
				}
			},
			methods: {
				join: function(e) {
					mui('.join-team-verify')[0].style.display = "flex";
					this.teamId = e;
				}
			},
			mounted: function() {
				mui.plusReady(function() {
					var self = plus.webview.currentWebview();
					if (self.team_id) {
						app.keywords = self.team_id;
						mui.post($ajaxUrl + 'team&action=search', {
							token: userInfo.token,
							team: app.keywords
						}, function(res) {
							if (res.errno == 0) {
								app.result = res.data;
							} else {
								message(res.message);
								app.result = [];
							}
						}, 'json')
					}
					document.getElementById("search").addEventListener("keypress", function(event) {
						var keywords = '';
						keywords = app.keywords.replace(/^\s*|\s*$/g, "");
						if (event.keyCode == "13" && keywords != '') {
							plus.key.hideSoftKeybord();
							mui.post($ajaxUrl + 'team&action=search', {
								token: userInfo.token,
								team: keywords
							}, function(res) {
								logs(res);
								if (res.errno == 0) {
									app.result = res.data;
								} else {
									message(res.message);
									app.result = [];
								}
							}, 'json')
							// 阻止默认事件---阻止页面刷新
							event.preventDefault();
						} else {
							// message("请输入团队id或者团队名");
						}
					})
				})
				// 创建团队
				mui(".mui-bar").on("tap", ".create-team-btn", function() {
					if (userInfo.group_id < 2) {
						message('您没有创建团队的权限!', 'center');
					} else {
						openPage('create_team.html', 'create_team', '#f7f7f7', '');
					}
				})
				// 关闭验证弹窗
				mui(".mui-content").on("tap", ".close-verify-window", function(e) {
					mui(".join-team-verify")[0].style.display = "none";
				})
				// 发送验证
				mui(".mui-content").on("tap", ".send-verify", function(e) {
					mui.post($ajaxUrl + 'team&action=apply', {
						token: userInfo.token,
						team_id: app.teamId,
						remark: app.remark
					}, function(res) {
						logs(res);
						if (res.errno == 0) {
							app.result = res.data;
							message(res.message);
							mui.fire(plus.webview.getWebviewById('boss_team'), 'joinSuccess');
							setTimeout(function() {
								mui.back();
							}, 2000)
						} else {
							message(res.message);
						}
					}, 'json')
					// message('请求的id:' + app.teamId);
					mui(".join-team-verify")[0].style.display = "none";
				})
			}
		})
	</script>
</html>
