<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.css" rel="stylesheet" />
		<style>
			.mui-bar{
				background-color: #FFFFFF;
			}
			.clearfix{
				clear: both;
			}
			.chart img{
				width: 100%;
				height: 100%;
			}
			.bj{
				margin-top: -22px;
				height: 230px;
				background-color: #FFFFFF;
			}
			.target{
				width: 95%;
				position: relative;
				/* position: absolute; */
				/* left: 2.5%; */
				/* right: 2.5%; */
				margin-left: 2.5%;
				margin-right: 2.5%;
				top: -20px;
				color: #000000;
				margin: 0 auto 0;
				background-color: #FFFFFF;
				border-radius: 8px;
				box-shadow: 0 0 15px 0 #adadad;
			}
			.target ul {
				position: relative;
				top: -20px;
			}
			ul,li{
				list-style: none;
			}
			
			.target ul li{
				width: 30%;
				float: left;
				margin-top: 15px;
			}
			.target p{
				width: 1px;
				height: 35px;
				float: right;
				margin-top: -50px;
				background-color: #F2F2F2;
			}
			
			.task{
				margin-top: 10px;
				background-color: #fff;
			}
			.task p{
				margin: 0;
			}
			.task1{
				padding: 22px 10px;
				font-size: 12px;
				border-bottom: 1px solid #F2F2F2;
			}
			.task1 p{
				width: 3px;
				height: 15px;
				float: left;
				margin-top: 3px;
				background-color: #2289FF;
			}
			.task2{
				padding: 10px 0;
				margin-left: 10px;
				border-bottom: 1px solid #F2F2F2;
			}
			.task2 span{
				float: left;
				margin-top: 8px;
				font-size: 15px;
				padding-left: 15px;
			}
			.task2 p{
				color:#FF8A3D;
				border: 1px solid #FF8A3D;
				padding: 6px;
				font-size: 12px;
				float: right;
				margin-right: 20px;
				border-radius: 5px;
			}
			
			.trapezium {
				position: relative;
				top: -19px;
				width: 120px;
				height: 20px;
				margin: -20px auto 0;
				text-align: center;
				font-size: 15px;
				color: #24A2FF;
				box-shadow: 0 -4px 8px 0 #DDDDDD;
				border-top-left-radius: 20px;
				line-height: 40px;
				border-top-right-radius: 20px;
				background-color: #FFFFFF;
			}
			
			.my_target{
				padding: 5px 10px;
				font-size: 12px;
				color: #FFFFFF;
				text-align: center;
				border-bottom-left-radius: 20px;
				border-top-left-radius: 20px;
				position: absolute;
				right: 0;
				top: 60px;
				box-shadow: 0 0 10px 0 #999999;
				background-color: #24A2FF;
			}
			.my_target img{
				width: 15px;
				height: 15px;
				position: relative;
				top: 3px;
			}
			/* .mui-content{
				min-height: 100vh;
				background-color: #FFFFFF;
			} */
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">目标管理</h1>
		</header>
		<div class="mui-content">
			<div class="my_target" id="my_target_unit">
				<span>
					<img src="../image/target_my.png">
				</span>
				<span id="my_target_title">我的目标</span>
			</div>
			<div class="chart">
				<img src="../image/target.jpg">
			</div>
			<div class="bj">
				<div class="target">
					<div class="trapezium">查看详情</div>
					<ul>
						<li style="text-align: left;">
							<div style="font-size: 12px; margin-left: 10px;">曝光</div>
							<h4 style="font-size: 18px; margin-left: 10px;" id="exposure_rate_number">0/0</h4>
							<div style="font-size: 10px; color: #FF4E47; margin-left: 10px; margin-top: -5px;" id="exposure_rate_text">未达标</div>
							<p></p>
						</li>
						<li>
							<div style="margin-left: 30%;">
								<div style="font-size: 12px;">拓客</div>
								<h4 style="font-size: 18px;" id="new_customer_number">0/0</h4>
								<div style="font-size: 10px; color: #FF4E47;margin-top: -5px;" id="new_customer_text">未达标</div>
								<p></p>
							</div>
						</li>
						<li>
							<div style="margin-left: 30%;">
								<div style="font-size: 12px; margin-right: 10px;">客户跟进</div>
								<h4 style="font-size: 18px; margin-right: 10px;" id="customer_follow_number">0/0</h4>
								<div style="font-size: 10px; color: #FF4E47/*#267CFF*/;margin-top: -5px; margin-right: 10px;" id="customer_follow_text">未达标</div>
							</div>
						</li>
						<div class="clearfix"></div>
					</ul>
					<ul>
						<li style="text-align: left;">
							<div style="font-size: 12px; margin-left: 10px;">有效沟通</div>
							<h4 style="font-size: 18px; margin-left: 10px;" id="communication_number">0/0</h4>
							<div style="font-size: 10px; color: #FF4E47; margin-left: 10px; margin-top: -5px;" id="communication_text">未达标</div>
							<p></p>
						</li>
						<li>
							<div style="margin-left: 30%;">
								<div style="font-size: 12px;">转介绍</div>
								<h4 style="font-size: 18px;" id="share_card_number">0/0</h4>
								<div style="font-size: 10px; color: #FF4E47;margin-top: -5px;" id="share_card_text">未达标</div>
								<p></p>
							</div>
						</li>
						<li>
							<div style="margin-left: 30%;">
								<div style="font-size: 12px; margin-right: 10px;">成交</div>
								<h4 style="font-size: 18px; margin-right: 10px;" id="deal_number">0/0</h4>
								<div style="font-size: 10px; color: #FF4E47/*#267CFF*/;margin-top: -5px; margin-right: 10px;" id="deal_text">未达标</div>
							</div>
						</li>
						<div class="clearfix"></div>
					</ul>
				</div>
			</div>
			<div class="task">
				<!-- <div class="task1">
					<p></p>
					<span style="float: left;margin-left: 10px;font-size: 15px;">任务</span>
					<div style="color: #999999;margin-left: 55px;margin-top: 1px;">做任务赢奖励</div>
				</div>
				<div style="padding-bottom: 60px;">
					<img style="width: 60%;display: block;margin: 10px auto 0;" class="no-friends" src="../image/icon/void-task.png">
					<p style="text-align: center;">暂无任务</p>
				</div> -->
				<!-- <div class="task2">
					<span>推广3人下载APP</span>
					<p>已完成2人下载</p>
					<div class="clearfix"></div>
				</div>
				<div class="task2">
					<span>微信分享3次商品</span>
					<p>去推广</p>
					<div class="clearfix"></div>
				</div>
				<div class="task2">
					<span>更新商品信息</span>
					<p style="border: none;color: #999999;">已完成</p>
					<div class="clearfix"></div>
				</div> -->
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/Zepto.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				beforeback: function() {
					plus.navigator.setStatusBarStyle('dark');
				}
			});
			var userInfo = getUserInfo();
			var date = formatDate('y-m-d', '');
			mui.plusReady(function() {
				eventInit();
				userTargetStatistics();
				check_user_target_state();
			})
			//事件初始化
			function eventInit() {
				window.addEventListener('newTarget', function() {
					userTargetStatistics();
					check_user_target_state();
				})
				//点击的定目标按钮
				document.getElementById('my_target_unit').addEventListener('tap', function() {
					//先检查会员
					checkMember(function(e){
						if (e) {
							fnOpenWin('target_manage_index.html', 'target_manage_index', {
								statusbar: {
									background: '#FFF'
								}
							}, '', 'slide-in-right');
						}
					});
				});
				
				//查看详情
				mui('.mui-content').on('tap', '.trapezium', function() {
					fnOpenWin('target_detail.html', 'target_detail', {
						statusbar: {
							background: '#FFF'
						}
					}, '', 'slide-in-right');
				})
			}

			function userTargetStatistics() {
				mui.post($ajaxUrl + 'target', {
					action: 'detail',
					token: userInfo.token,
					date: date,
					pattern: 1
				}, function(res) {
					logs(res);
					var plan = res.data.plan;
					var finish = res.data.finish;
					for (var index in plan) {
						document.getElementById(index + '_number').innerText = finish[index] + '/' + plan[index];
						var rate = parseFloat((finish[index] / plan[index]).toFixed(1));
						if (rate < 1) {
							document.getElementById(index + '_text').innerText = '未达标';
						} else if (rate >= 1 && rate < 1.1) {
							document.getElementById(index + '_text').innerText = '已达标';
							document.getElementById(index + '_text').style.color = '#267CFF';
						} else if (rate >= 1.1 && rate < 1.5) {
							document.getElementById(index + '_text').innerText = '优秀';
							document.getElementById(index + '_text').style.color = '#267CFF';
						} else {
							document.getElementById(index + '_text').innerText = '英雄';
							document.getElementById(index + '_text').style.color = '#267CFF';
						}
					}
				}, 'json')
			}
			/**
			 * 检查用户目标设置状态
			 */
			function check_user_target_state() {
				var userInfo = getUserInfo();
				var url = $ajaxUrl + "target";
				mui.ajax(url, {
					data: {
						action: 'check_user_target_state',
						token: userInfo.token
					},
					dataType: 'json', //服务器返回json格式数据
					type: 'post', //HTTP请求类型
					timeout: 10000, //超时时间设置为10秒；
					success: function(res) {
						// console.log(JSON.stringify(res));
						//已经设置目标
						if (res.code == '200') {
							$('#my_target_title').html('我的目标');
						}
						//用户未设置目标
						if (res.code == '404') {
							$('#my_target_title').html('设定目标');
						}
					},
					error: function(xhr, type, errorThrown) {
						console.log(JSON.stringify(errorThrown));
					}
				});
			}
		</script>
	</body>
</html>
