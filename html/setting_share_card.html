<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			html,
			body {
				width: 100%;
				/* height: 100%; */
			}

			[v-cloak] {
				display: none;
			}

			.mui-bar-nav~.mui-content {
				min-height: 100vh;
				padding-bottom: 100px;
			}

			.mui-control-content {
				height: auto;
				background-color: #f1f2f3;
			}

			.mui-bar-tab.theme-change {
				height: 90px;
				top: 100vh;
				bottom: auto;
				margin-top: -90px;
				-webkit-box-shadow: 0 0 1px rgba(0, 0, 0, .1);
				box-shadow: 0 0 1px rgba(0, 0, 0, .1);
				z-index: 12;
				position: absolute;
			}

			.mui-bar-tab .mui-tab-item {
				height: 90px;
				position: relative;
				overflow: hidden;
				width: 20%;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				padding: 10px 0;
			}

			.theme-change img {
				height: 80%;
				width: auto;
				transition: all 0.1s ease-in-out;
				-webkit-transition: all 0.1s ease-in-out;
			}

			.theme-change .mui-tab-item.mui-active {
				padding: 0;
			}

			.theme-change .mui-tab-item.mui-active img {
				height: 90%;
			}

			.save-edit {
				height: 44px;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 0 10px;
				z-index: 16;
				font-size: 14px;
				color: #2289FF;
				margin-right: -5px;
			}

			.mui-tab-item {
				touch-action: pan-y;
			}

			.qrimg {
				width: 125px;
				height: auto;
			}

			/* 主题一 */
			.theme1 {
				position: relative;
				height: 580px;
				overflow: hidden;
			}

			.theme1 .bgimg,
			.theme2 .bgimg {
				width: 100%;
				height: auto;
				position: relative;
				z-index: 1;
			}

			.theme-body {
				position: absolute;
				width: 100%;
				height: auto;
				top: 40px;
				bottom: 0;
				z-index: 2;
			}

			.type_desc {
				position: relative;
			}

			.user-head-img {
				width: 72px;
				height: 72px;
				overflow: hidden;
				border-radius: 50%;
			}

			.theme-body1 {
				width: 6.5rem;
				left: 50%;
				margin-left: -3.25rem;
				background: url("../image/share/bg-img06.png")center top no-repeat;
				background-size: contain;
				display: flex;
				align-items: center;
				flex-direction: column;
				padding-top: 50px;
			}

			.theme-body1 .qrimg {
				margin-top: 10px;
			}

			.theme-body1 h2 {
				font-size: 18px;
				font-weight: normal;
				padding: 20px 0;
				margin-bottom: 10px;
				position: relative;
			}

			.theme-body1 h2::after content: '';
			width: 40px;
			height: 2px;
			display: block;
			position: absolute;
			left: 50%;
			margin-left: -20px;
			bottom: 0;
			background-color: #2289FF;
			}

			.input-section {
				/* border: 2px dashed #DDDDDD; */
				margin-bottom: 5px;
				width: 80%;
			}

			.input-section textarea {
				width: 100%;
				overflow: auto;
				word-break: break-all;
				margin: 0;
				border: none;
				background: transparent;
				text-align: center;
				font-size: 0.3rem;
			}

			.theme-body1 .bottom-logo {
				position: absolute;
				bottom: 0.3rem;
				width: 75px;
			}

			/* 第二个主题 */
			.theme2 {
				height: auto;
				min-height: 500px;
				background-color: #ffffff;
			}

			.theme2 .qrimg {
				margin-top: 20px;
			}

			.head-img-cont {
				overflow: hidden;
				height: 6rem;
				position: relative;
				padding: 0;
				line-height: 0;
				z-index: 1;
				margin-bottom: 0;
				background-color: #FFFFFF;
			}

			.head-img-cont .bgimg {
				width: auto;
				height: 6rem;
			}

			.theme-body2 {
				width: 90%;
				left: 5%;
				display: flex;
				align-items: center;
				flex-direction: column;
			}

			.theme-body2 h2 {
				font-size: 18px;
				font-weight: normal;
				padding: 10px 0;
				position: relative;
				color: #FFFFFF;
				text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
			}

			.theme-body2 .user-head-img {
				box-shadow: 0 0 1px 1px rgba(255, 255, 255, 0.6);
			}

			.theme-body2 .input-section {
				border: none;
				color: #FFFFFF;
				margin-bottom: 0;

			}

			.theme-body2 textarea::-webkit-input-placeholder {
				color: #FFFFFF;
			}

			.theme-body2 .qrimg {
				border: 4px solid #FFFFFF;
				border-radius: 10px;
				background-color: #FFFFFF;
				box-shadow: 0 0 5px 1px rgba(0, 0, 0, 0.1);
				margin-bottom: 5px;
			}

			.head-img-cont .circular-bead {
				width: 100%;
				height: auto;
				position: absolute;
				bottom: 0;
				z-index: 3;
			}

			.theme-body2 .bottom-logo {
				margin-top: 20px;
				width: 75px;
			}

			/* 第三个主题 */
			.theme3 {
				width: 100%;
				min-height: 550px;
				line-height: 0;
			}

			.theme3 .bgimg {
				width: 100%;
				height: auto;
				position: relative;
				z-index: 1;
				line-height: 0;
			}

			.theme-body3 {
				width: 100%;
				background-size: contain;
				display: flex;
				align-items: center;
				flex-direction: column;
				box-sizing: border-box;
			}

			.theme-body3 h2 {
				font-size: 18px;
				font-weight: normal;
				padding: 10px 0;
				position: relative;
				color: #FFFFFF;
				text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
			}

			.theme-body3 .qr-cont {
				line-height: 1.4;
				margin-bottom: 1rem;
			}

			.theme-body3 .type_desc {
				color: #FFFFFF;
				margin-bottom: 0;
			}

			.theme-body3 .bottom-logo {
				width: 90px;
				height: auto;
				margin-top: 0.3rem;
			}

			.theme-body3 .input-section {
				margin: 20px 0;
				width: 6rem;
				border: none;
				color: #FFFFFF;
			}

			.theme-body3 textarea::-webkit-input-placeholder {
				color: #FFFFFF;
			}

			/* 第四个主题 */
			.theme4.mui-control-content.mui-active {
				background-color: #FFFFFF;
				min-height: 500px;
				display: flex;
				flex-direction: column;
				align-items: center;
				padding-bottom: 10px;
			}

			.theme4 .bgimg {
				width: 100%;
				max-height: 250px;
				z-index: 1;
			}

			.theme4 .user-head-img {
				position: relative;
				margin-top: -36px;
				z-index: 2;
			}

			.theme4 h2 {
				font-size: 18px;
				font-weight: normal;
				padding: 20px 0;
				position: relative;
				color: #333333;
			}

			.theme4 h2::after {
				content: '';
				width: 40px;
				height: 2px;
				display: block;
				position: absolute;
				left: 50%;
				margin-left: -20px;
				bottom: 0;
				background-color: #2289FF;
			}

			.theme4 .input-section {
				border: none;
			}

			.theme4 .bottom-logo {
				position: absolute;
				left: 0.3rem;
				top: 0.3rem;
				z-index: 3;
				width: 1.5rem;
			}

			.option-btn {
				border-radius: 5px;
				position: absolute;
				right: 0.15rem;
				top: 1.2rem;
				z-index: 9;
				border: 1px dashed #FFFFFF;
				color: #FFFFFF;
				font-size: 0.28rem;
				padding: 0 4px;
				line-height: 1.4;
				text-shadow: 1px 1px 2px #001D5A;
				/* box-shadow: 0 0 2px 1px rgba(0, 0, 0, 0.1) inset, 0 0 2px 1px rgba(0, 0, 0, 0.1); */
				box-shadow: 0 0 2px 1px rgba(0, 0, 0, 0.1) inset;
			}

			.restore-default {
				top: 0.3rem;
			}

			/* 第五个样式 */
			.theme5 {
				width: 100%;
				overflow: hidden;
				position: relative;
				font-size: 0;
				line-height: 0;
				background-color: #0062CC;
			}

			.theme5 .bg-img {
				width: 100%;
				height: auto;
				z-index: 1;
			}

			.theme5-container {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
				z-index: 2;
				display: flex;
				flex-direction: column;
				align-items: center;
				padding-top: 0.8rem;
			}

			.theme5-logo {
				width: 60%;
				height: auto;
				margin-bottom: 2.4rem;
			}

			.theme5 .theme5-area {
				width: 70%;
				background: transparent;
				border: none;
				text-align: center;
				color: #FFFFFF;
			}

			.theme5 .theme5-area::-webkit-input-placeholder {
				text-align: center;
				color: #FFFFFF;
				font-size: 0.36rem;
			}

			.theme5 .qrimg {
				width: 1.8rem;
				bottom: 1rem;
				right: 0.6rem;
				position: absolute;
			}

			.theme5 span {
				position: absolute;
				bottom: 1rem;
				left: 0.6rem;
				color: #FFFFFF;
				font-size: 0.42rem;
			}
		</style>
		<script type="text/javascript">
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">名片样式</h1>
			<div id="shareImg" class="mui-pull-right save-edit">
				<span>保存</span>
			</div>
		</header>
		<div id="mui-content" class="mui-content setting-container" v-cloak>
			<nav id="theme-change" class="mui-bar mui-bar-tab theme-change">
				<a href="#theme1" data-imgtype="1" class="mui-tab-item" :class="card_type==1?'mui-active':''"><img src="../image/share/styles-icon01.png"></a>
				<a href="#theme2" data-imgtype="2" class="mui-tab-item" :class="card_type==2?'mui-active':''"><img src="../image/share/styles-icon02.png"></a>
				<a href="#theme3" data-imgtype="3" class="mui-tab-item" :class="card_type==3?'mui-active':''"><img src="../image/share/styles-icon03.png"></a>
				<a href="#theme4" data-imgtype="4" class="mui-tab-item" :class="card_type==4?'mui-active':''"><img src="../image/share/styles-icon04.png"></a>
				<a href="#theme5" data-imgtype="5" class="mui-tab-item" :class="card_type==5?'mui-active':''"><img src="../image/share/styles-icon05.png"></a>
			</nav>
			<div id="theme1" class="theme1 mui-control-content" :class="card_type==1?'mui-active':''">
				<img class="bgimg" :src="resultData.background_image_1_url||background_image_1">
				<div class="option-btn replace-img ">
					点击替换图片
				</div>
				<div class="option-btn restore-default">
					恢复默认风格
				</div>
				<div class="theme-body theme-body1">
					<img class="user-head-img" :src="userhead">
					<h2>{{username}}</h2>
					<div class="input-section">
						<textarea v-model="signature1" maxlength="26" rows="2" placeholder="添加自定义文字"></textarea>
					</div>
					<img class="qrimg" :src="qrpath">
					<p class="type_desc">{{type_desc}}</p>
					<img class="bottom-logo" src="../image/share/box-shadow-logo.png">
				</div>
			</div>
			<div id="theme2" class="theme2 mui-control-content" :class="card_type==2?'mui-active':''">
				<div class="option-btn replace-img ">
					点击替换图片
				</div>
				<div class="option-btn restore-default">
					恢复默认风格
				</div>
				<div class="head-img-cont">
					<img class="bgimg" :src="resultData.background_image_2_url||background_image_2">
					<img class="circular-bead" src="../image/share/circular-bead-bg.png">
					<!-- <span class="radius"></span> -->
				</div>
				<div class="theme-body theme-body2">
					<img class="user-head-img" :src="userhead">
					<h2>{{username}}</h2>
					<div class="input-section">
						<textarea v-model="signature2" maxlength="26" rows="2" placeholder="添加自定义文字"></textarea>
					</div>
					<img class="qrimg" :src="qrpath">
					<p class="type_desc">{{type_desc}}</p>
					<img class="bottom-logo" src="../image/share/box-shadow-logo.png">
				</div>
			</div>
			<div id="theme3" class="theme4 mui-control-content" :class="card_type==3?'mui-active':''">
				<div class="option-btn replace-img">
					点击替换图片
				</div>
				<div class="option-btn restore-default">
					恢复默认风格
				</div>
				<div style="min-height: 200px;">
					<img class="bgimg" :src="resultData.background_image_3_url||background_image_3">
				</div>
				<img class="user-head-img" :src="userhead">
				<img class="bottom-logo" src="../image/share/box-shadow-logo.png">
				<h2>{{username}}</h2>
				<div class="input-section">
					<textarea v-model="signature3" maxlength="26" rows="2" placeholder="添加自定义文字"></textarea>
				</div>
				<img class="qrimg" :src="qrpath">
				<p class="type_desc">{{type_desc}}</p>
			</div>
			<div id="theme4" class="theme3 mui-control-content" :class="card_type==4?'mui-active':''">
				<div class="option-btn replace-img">
					点击替换图片
				</div>
				<div class="option-btn restore-default">
					恢复默认风格
				</div>
				<img class="bgimg" :src="resultData.background_image_4_url||background_image_4">
				<div class="theme-body theme-body3">
					<img class="user-head-img" :src="userhead">
					<h2>{{username}}</h2>
					<div class="input-section">
						<textarea v-model="signature4" maxlength="26" rows="2" placeholder="这里是添加自定义文字"></textarea>
					</div>
					<div class="qr-cont">
						<img class="qrimg" :src="qrpath">
						<p class="type_desc">{{type_desc}}</p>
					</div>
					<img class="bottom-logo" src="../image/share/box-shadow-logo.png">
				</div>
			</div>
			<div id="theme5" class="theme5 mui-control-content" :class="card_type==5?'mui-active':''">
				<img class="bg-img" :src="resultData.background_image_5_url||background_image_5">
				<div class="theme5-container">
					<img class="theme5-logo" src="../image/share/setting_share_card_dzui.png">
					<textarea class="theme5-area" v-model="signature5" maxlength="26" rows="2" placeholder="添加自定义文字"></textarea>
					<span class="theme5-timer"></span>
					<img class="qrimg" :src="qrpath">
				</div>
				<div class="option-btn replace-img">
					点击替换图片
				</div>
				<div class="option-btn restore-default">
					恢复默认风格
				</div>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var card_type = 1;
			var ratio = 900 / 1440;
			var userInfo = getUserInfo();
			var app = new Vue({
				el: "#mui-content",
				data: {
					card_type: 1,
					userhead: '',
					username: '',
					imgtyp: '1',
					qrpath: '',
					background_image_1: '../image/share/bg-img01.jpg',
					background_image_2: '../image/share/bg-img02.jpg',
					background_image_3: '../image/share/bg-img03.jpg',
					background_image_4: '../image/share/bg-img04.jpg',
					background_image_5: '../image/share/bg-img05.jpg',
					uperimg1: 'images/6/2019/05/bg-img01.jpg',
					uperimg2: 'images/6/2019/05/bg-img02.jpg',
					uperimg3: 'images/6/2019/05/bg-img03.jpg',
					uperimg4: 'images/6/2019/05/bg-img04.jpg',
					uperimg5: 'images/6/2019/05/bg-img05.jpg',
					type_desc: '',
					// 个性签名
					signature1: '',
					signature2: '',
					signature3: '',
					signature4: '',
					signature5: '',
					// 全部资料
					resultData: {}
				},
				methods: {

				},
				mounted: function() {
					// 上传图片的比例
					mui.init({
						beforeback: function() {
							// plus.navigator.setStatusBarStyle("dark");
						}
					})
					mui.plusReady(function() {
						app.userhead = userInfo.avatarUrl;
						app.username = userInfo.nickName;
						var originalHeight = document.documentElement.clientHeight || document.body.clientHeight;
						window.onresize = function() {
							//软键盘弹起与隐藏  都会引起窗口的高度发生变化
							var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
							if (resizeHeight * 1 < originalHeight * 1) {
								//resizeHeight<originalHeight证明窗口被挤压了
								document.getElementById('theme-change').style.zIndex = '-150';
								document.getElementById('theme-change').style.display = 'none';
							} else {
								document.getElementById('theme-change').style.zIndex = '999';
								document.getElementById('theme-change').style.display = 'table';
							}
						}
						//获取二维码图片
						function getQrcodePic() {
							showload(0);
							mui.post($ajaxUrl + 'userqrcode&action=current_qrcode', {
								token: userInfo.token
							}, function(res) {
								// logs(res);
								if (res.errno == 0) {
									var type = res.data.type;
									app.qrpath = $ajaxUrl + 'userqrcode&action=make_qrcode&token=' + userInfo.token + '&url=' + res.data.url;
									if (type == 'redpacket') {
										app.type_desc = '扫描二维码领红包';
									} else if (type == 'card') {
										app.type_desc = '扫描二维码加我好友';
									} else if (type == 'link') {
										app.type_desc = '扫描二维码了解更多精彩';
									} else if (type == 'pic') {
										app.type_desc = '扫描二维码看美图';
									}
								} else {

								}
								setTimeout(function() {
									showload(1);
								}, 1000)
							}, 'json');
						}
						getQrcodePic();
						// 点击底部样式切换
						mui(".theme-change").on('tap', '.mui-tab-item', function() {
							app.imgtyp = this.dataset.imgtype;
							// message(app.imgtyp);
							if (app.imgtyp == '2' || app.imgtyp == '3') {
								ratio = 900 / 599;
							} else if(app.imgtyp == '5'){
								ratio = 1000 / 1452;
							}else{
								ratio = 900 / 1440;
							}
						})
						// 上传背景图片
						mui('.mui-content').on('tap', '.replace-img', function() {
							// if (app.imgtyp == '2' || app.imgtyp == '3') {
							// 	ratio = 900 / 599;
							// } else if(app.imgtyp == '5'){
							// 	ratio = 1000 / 1452;
							// }else{
							// 	ratio = 900 / 1440;
							// }
							var editButtons = new Array();
							editButtons.push({
								title: "拍照上传",
								style: "default"
							});
							editButtons.push({
								title: "从相册选择",
								style: "default"
							});
							plus.nativeUI.actionSheet({
								cancel: "取消",
								buttons: editButtons
							}, function(e) {
								var index = e.index;
								switch (index) {
									case 1:
										getImage(ratio); //拍照
										break;
									case 2:
										galleryImage(ratio); //相册选择
										break;
								}
							});
						});

						// 拍照获取图片
						function getImage() {
							var camera = plus.camera.getCamera();
							camera.captureImage(function(e) {
								plus.io.resolveLocalFileSystemURL(e, function(entry) {
									cropperImg(entry.toLocalURL(), 'setting_share_card', ratio);
									// imageResize(entry.toLocalURL());
									// 其他操作,比如预览展示
								}, function(e) {
									console.log("读取拍照文件错误：" + e.message);
								});
							}, function(s) {
								console.log("error" + s);
							}, {
								filename: "_doc/camera/"
							})
						}
						// 从相册中选择图片 
						function galleryImage(cb) {
							// 从相册中选择图片
							plus.gallery.pick(function(e) {
								cropperImg(e, 'setting_share_card', ratio);
							}, function(e) {
								console.log("取消选择图片");
							}, {
								filter: "image",
								multiple: false,
								maximum: 5,
								system: false,
								onmaxed: function() {
									plus.nativeUI.alert('最多只能选择1张图片');
								}
							});
						}
						window.addEventListener('cropperSuccess', function(event) {
							// logs(app.resultData);
							showload(0, 0, "图片加载中...", "rgba(0,0,0,0.5)");
							app.resultData['background_image_' + app.imgtyp + '_url'] = event.detail.image;
							app['uperimg' + app.imgtyp] = event.detail.filename;
							setTimeout(function() {
								// showload(1);
								showload(1);
							}, Math.floor(Math.random() * 1000 + 1000));
						})
						// 获取当前时间给样式五
						document.querySelector(".theme5-timer").innerText = formatDate('y', '') + " - " + formatDate('m', '');
					})
					// 恢复默认
					mui(".mui-content").on("tap", ".restore-default", function() {
						var pview = plus.webview.currentWebview().opener();
						// message(app.imgtyp);
						app.resultData['background_image_' + app.imgtyp + '_url'] = '../image/share/bg-img0' + app.imgtyp + '.jpg';
						app['background_image_' + app.imgtyp] = '../image/share/bg-img0' + app.imgtyp + '.jpg';
						app['uperimg' + app.imgtyp] = 'images/6/2019/05/bg-img0' + app.imgtyp + '.jpg';
						// app['background_image_' + app.imgtyp]='../image/share/bg-img0'+app.imgtyp+'.jpg';
						mui.post($ajaxUrl + 'userqrcode&action=poster_setting', {
							token: userInfo.token,
							card_type: app.imgtyp,
							background_image: app['uperimg' + app.imgtyp],
							card_text: app['signature' + app.imgtyp]
						}, function(res) {
							// logs(res);
							if (res.errno == 0) {
								message("已恢复默认设置");
								mui.fire(pview, 'changeCard');
								mui.back();
							}
						}, 'json');
					})
					// 保存设置
					mui(".mui-bar").on("tap", ".save-edit", function() {
						var pview = plus.webview.currentWebview().opener();
						mui.post($ajaxUrl + 'userqrcode&action=poster_setting', {
							token: userInfo.token,
							card_type: app.imgtyp,
							background_image: app['uperimg' + app.imgtyp],
							card_text: app['signature' + app.imgtyp]
						}, function(res) {
							// logs(res);
							if (res.errno == 0) {
								mui.fire(pview, 'changeCard');
								mui.back();
							}
						}, 'json');
					})
					// 获取前一次名片样式
					function getBeforeStyle() {
						mui.post($ajaxUrl + 'userqrcode&action=setting_info', {
							token: userInfo.token
						}, function(res) {
							// logs(res);
							var data = res.data;
							if (res.errno == 0) {
								app.resultData = res.data;
								app.imgtyp = res.data.card_type == 0 ? 1 : res.data.card_type;
								app.card_type = res.data.card_type == 0 ? 1 : res.data.card_type;
								app.uperimg1 = data.background_image_1 || app.uperimg1;
								app.uperimg2 = data.background_image_2 || app.uperimg2;
								app.uperimg3 = data.background_image_3 || app.uperimg3;
								app.uperimg4 = data.background_image_4 || app.uperimg4;
								app.uperimg5 = data.background_image_5 || app.uperimg5;
								// 个性签名
								app.signature1 = data.card_text_1;
								app.signature2 = data.card_text_2;
								app.signature3 = data.card_text_3;
								app.signature4 = data.card_text_4;
								app.signature5 = data.card_text_5;
							}
						}, 'json');
					}
					getBeforeStyle();
				}
			})
		</script>
	</body>

</html>
