<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<title> </title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/index.css" rel="stylesheet" />
		<link href="../icomoon/style.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/swiper.min.css">
		<style>
			body {
				background-color: #FFFFFF;
			}

			.clearfix {
				clear: both;
			}

			.message {
				width: 25px;
				height: 22px;
				margin-top: 10px;
			}

			.target {
				width: 95%;
				position: absolute;
				left: 2.5%;
				right: 2.5%;
				top: 163px;
				color: #000000;
				background-color: #FFFFFF;
				border-radius: 8px;
				box-shadow: 0 -8px 18px 2px #1B86E2;
			}

			ul,
			li {
				list-style: none;
			}

			.titlecontent {
				margin-top: 15px;
			}

			.titlecontentL {
				width: 50%;
				float: left;
				text-align: center;
				top: 20px;
			}

			.titlecontent li {
				float: left;
				width: 50%;
			}

			.titlecontentL li img {
				height: 24px;
			}

			.titlecontentR {
				width: 50%;
				float: right;
				/* background-color: #0062CC; */
			}

			.titlecontentR span,
			.titlecontentR p {
				font-size: 12px;
				color: #333333;
				margin-bottom: 0;
			}

			.titlecontentR .city-name {
				padding-left: 10%;
				margin-top: -15px;
				text-align: left;
			}

			.mui-content .Notice {
				height: 40px;
				position: relative;
				padding: 10px;
				font-size: 12px;
				background-color: #f2f2f2;
				overflow: hidden;
				display: flex;
				align-items: center;
				padding-right: 30px;
			}

			.Notice-title {
				margin-right: 15px;
				display: inline-flex;
				align-items: center;
			}

			.Notice .notice-more {
				position: absolute;
				right: 15px;
				top: 12px;
				opacity: 0.3;
			}

			.Notice .notice-more img {
				width: 8px;
			}

			.Background-picture {
				position: relative;
				text-align: center;
			}

			.Background-picture h4 {
				position: absolute;
				top: 46%;
				left: 10%;
				right: 10%;
				font-size: 18px;
			}

			.function {
				width: 90%;
				position: absolute;
				margin-top: -35px;
				margin-left: 5%;
				border-radius: 8px;
				padding: 15px 0 15px 0;
				box-shadow: 0 0 6px 1px rgba(0, 0, 0, 0.2);
				background-color: #fff;
			}

			.functionL {
				width: 50%;
				float: left;
			}

			.functionLc {
				width: 60%;
				color: #000000;
				margin: 0 auto;
				text-align: center;
			}

			.function img {
				height: 18px;
				float: left;
				margin-top: 10px;
			}

			.function p {
				float: left;
				color: #000000;
				margin-left: 15px;
				font-size: 15px;
				margin-top: 10px;
			}

			.functionR {
				width: 50%;
				float: right;
				border-left: 1px solid #F2F2F2;
			}

			.functionRc {
				width: 50%;
				color: #000000;
				margin: 0 auto;
				text-align: center;
			}

			.functional_selection {
				width: 90%;
				margin: 0 auto;
				margin-top: 37px;
				text-align: left;
			}

			.business_card {
				width: 48%;
				padding: 15px 10px;
				float: left;
				margin-top: 25px;
				border-radius: 7px;
				box-shadow: 0 0 6px 1px #D1D1D3;
				background-color: #fff;
				overflow: hidden;
			}

			.business_cardR {
				width: 48%;
				padding: 15px 10px;
				float: right;
				margin-top: 25px;
				border-radius: 7px;
				box-shadow: 0 0 15px 1px #D1D1D3;
				background-color: #fff;
				overflow: hidden;
			}

			.functional_selection img {
				width: 48px;
				float: left;
			}

			.functional_selection p {
				font-size: 15px;
				color: #000;
				margin-top: 5px;
			}

			.functional_selection span {
				font-size: 11px;
				display: block;
				margin-top: -8px;
			}

			#quick {
				width: 80%;
				margin: 0 auto;
				box-shadow: 0 0 15px 3px #D1D1D3;
				border-radius: 20px;
				background-color: #fff;
				display: none;
				margin-top: -133px;
				z-index: 9999;
			}

			#quick li {
				width: 25%;
				float: left;
				margin-top: 15px;
			}

			#quick li img {
				height: 22px;
			}

			#quick li p {
				font-size: 10px;
				color: #000000;
			}

			.jiandou {
				width: 19px;
				position: absolute;
				margin-left: -12px;
			}

			#back {
				position: fixed;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
			}

			#cover {
				position: fixed;
				z-index: 9999;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
				background: #484848 none repeat scroll 0% 0%;
			}

			.code_container {
				position: fixed;
				top: 0;
				bottom: 0;
				width: 100%;
				background-color: rgba(0, 0, 0, 0.5) !important;
				z-index: 9;
				display: none;
			}

			#QR-code {
				width: 74%;
				height: 335px;
				background-color: #fff;
				z-index: 10;
				position: fixed;
				top: 25%;
				left: 13%;
				border-radius: 8px;
				text-align: center;
			}

			.QR-tu {
				width: 217px;
				height: 217px;
				margin: 0 auto;
				padding-top: 30px;
			}

			.QR-tu img {
				width: 100%;
			}

			#QR-code span {
				display: block;
				font-size: 15px;
				margin-top: 50px;
				color: #000000;
				padding-bottom: 10px;
			}

			#QR-code a {
				font-size: 13px;
			}

			.mask {
				height: 100%;
				width: 100%;
				position: absolute;
				top: 0;
				background: #000000;
			}

			.mui-slider-title {
				position: absolute;
				bottom: -40%;
				left: 0;
				width: 100%;
				height: 100%;
				line-height: 30px;
				margin: 0;
				text-align: center;
				vertical-align: middle;
				text-indent: 0;
				opacity: 1;
				background-color: rgba(0, 0, 0, 0);
				color: #FFF;
				font-size: 18px;
			}

			.mui-slider {
				max-height: 238px;
				overflow: hidden;
			}

			.mui-slider img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.noticeMsg {
				overflow: hidden;
				white-space: nowrap;
				height: 50px;
				width: 100%;
				font-size: 15px;
				-webkit-transition: .4s;
				-o-transition: .4s;
				transition: .4s;
				-webkit-trans: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
				background: url(../Images/notice.png) left 10px center no-repeat;
			}

			.noticeMsg ul li {
				padding: 0;
				margin: 0;
			}

			#scroll_begin li,
			#scroll_end li {
				line-height: 32px;
				text-indent: 30px;
			}

			/* 快捷弹窗 */
			.mui-popover .mui-popover-arrow:after {
				background-color: #4c4c4c;
			}

			.mui-popover {
				background-color: #0062CC;
				width: 128px;
			}

			.Pop-up-menu {
				width: 128px;
				border-radius: 5px;
				background-color: #4c4c4c;
				overflow: hidden;
			}

			.Pop-up-menu li {
				padding: 15px 0 10px 0;
				position: relative;
				display: flex;
				align-items: center;
				padding-left: 20px;
			}

			.Pop-up-menu li:after {
				content: '';
				display: block;
				height: 1px;
				background-color: #6a6a6a;
				width: 100%;
				bottom: 0;
				left: 15px;
				position: absolute;
				-webkit-transform: scaleY(0.5);
				transform: scaleY(0.5);
			}

			.Pop-up-menu li:last-of-type:after {
				display: none;
			}

			.Pop-up-menu li img {
				width: 17px;
				height: 16px;
				float: left;
			}

			.Pop-up-menu li span {
				margin-left: 18px;
				font-size: 15px;
				margin-top: -2px;
				float: left;
			}

			.add-btn {
				display: inline-block;
				height: 44px;
			}

			#popover {
				top: 10px !important;
				left: 0 !important;
				right: 0 !important;
			}

			.mui-badge-danger {
				position: absolute;
				right: 5px;
				top: 5px;
				font-size: 10px;
				padding: 3px 5px 1px;
				background-color: #FF0000;
			}

			#message,
			#openPopover {
				position: relative;
				z-index: 13;
				flex-shrink: 0;
				margin: 0;
				padding: 0;
				/* background-color: #2289ff; */
				/* border-right: 1px solid #000000; */
				box-sizing: border-box;
			}

			.open-message,
			#openPopover {
				position: relative;
				height: 42px;
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 13;
				flex-shrink: 0;
			}

			#message {
				padding-left: 20px;
				padding-right: 10px;
			}

			#openPopover {
				margin-top: -3px;
				padding-right: 20px;
				padding-left: 10px;
			}

			.mui-bar {
				padding: 0;
			}



			body {
				padding-top: constant(safe-area-inset-top);
			}

			.mui-bar.mui-bar-nav {
				top: constant(safe-area-inset-top);
			}

			.titlecontentR .weather-info {
				margin-top: -10px;
				margin-right: 10px;
			}

			.titlecontentR .weather-info p {
				font-size: 12px;
				color: #333333;
				margin-bottom: 0;
				padding: 0;
				line-height: 1.2;
				flex-grow: 1;
				text-align: center;
				margin-top: 0;
			}

			.weather-img {
				position: relative;
				width: 60px;
				height: 50px;
				margin: 0 auto;
			}

			.weather-img .icon {
				position: relative;
				width: 50px;
				height: 50px;
				left: 0;
				margin: 0 auto;
			}

			.flex-left-cont {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.mui-bar-nav~.mui-content {
				padding-top: 121px;
			}

			.mui-slider-item {
				touch-action: pan-y;
			}

			.bar-top {
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				height: 44px;
				overflow: hidden;
			}

			.mui-bar .mui-title {
				display: flex;
				font-size: 14px;
				color: #ababab;
				position: relative;
				flex-grow: 1;
				align-items: center;
				justify-content: center;
				left: 0;
				right: 0;
				overflow: visible;
				background: #f2f2f2;
				border-radius: 5px;
				height: 28px;
				margin: -2px 0 0 18px;
			}

			.mui-bar .mui-title .mui-icon {
				color: #ababab;
			}

			.mui-bar.active {
				z-index: 999;
			}

			.team-list {
				top: 44px;
				position: absolute;
				height: auto;
				z-index: 12;
				width: 100%;
				display: none;
				max-height: 200px;
				overflow-y: scroll;
			}

			.team-list .mui-table-view-cell {
				padding: 0;
				width: 100%;
			}

			.team-list .mui-table-view-cell:after {
				left: 0;
				background-color: #DDDDDD;
			}

			.mui-title .mui-icon {
				font-size: 20px;
				color: #333333;
			}

			.mui-backdrop {
				background-color: rgba(0, 0, 0, 0);
			}

			.Notice .swiper-container {
				height: 40px;
				max-width: 300px;
				flex-grow: 1;
			}

			.Notice .swiper-container .swiper-slide {
				height: 40px;
				align-items: center;
				font-size: 12px;
				color: #333333;
				width: 100%;
				line-height: 40px;
			}

			.Notice .notice-cont {
				width: 100%;
				overflow: hidden;
			}

			.banner-container {
				position: relative;
				width: 100%;
				height: 220px;
				overflow: hidden;
			}

			.banner-container .swiper-wrapper,
			.banner-container .swiper-slide {
				height: 100%;
			}

			.banner-container .swiper-slide img {
				width: 100%;
				height: auto;
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>
	<body>
		<div style="margin-bottom: 50px;" id="mui-content" v-cloak>
			<header class="mui-bar mui-bar-nav" style="height:120px; background-color: #fff;box-shadow: 0 0 0 #fff;">
				<div class="bar-top">
					<div class="mui-title">
						<span class="mui-icon mui-icon-search"></span>
						<span>搜索</span>
					</div>
					<div id="message" class="open-message">
						<img src="../image/index-message-icon.png" alt="" style="width: 25px;height: 22px;">
						<span class="mui-badge mui-badge-danger" style="display: none;z-index: 14;" id="unread_message">0</span>
					</div>
					<a href="#topPopover" class="add-btn" id="openPopover">
						<img src="../image/index-add-icon.png" style="width: 20px;height: 20px;">
					</a>
				</div>
				<div class="titlecontent mui-clearfix">
					<div class="titlecontentL">
						<li id="scan">
							<img src="../image/index-scan.png">
							<p>扫一扫</p>
						</li>
						<li id="payment_code">
							<img src="../image/index-receipt-code.png">
							<p>收款码</p>
						</li>
					</div>
					<div class="titlecontentR">
						<p class="city-name" id="city">昆明市</p>
						<!-- <div class="icon sun-shower">
							<div class="cloud"></div>
							<div class="sun">
								<div class="rays"></div>
							</div>
							<div class="rain"></div>
						</div> -->
						<div class="flex-left-cont">
							<div class="weather-img" id="weather_img">
								<div class="icon sun-shower">
									<div class="cloud"></div>
									<div class="sun">
										<div class="rays"></div>
									</div>
								</div>
							</div>
							<div class="weather-info">
								<p>今天</p>
								<p>
									<font id="temperature">-°~-°</font>
								</p>
								<p>
									<font id="weather">-</font>
								</p>
							</div>
						</div>
					</div>
				</div>
			</header>
			<div class="mui-content">
				<div class="Notice">
					<div class="Notice-title">
						<img src="../image/notice4.png" style="width:18px" alt="">
					</div>
					<div id="notice_container" class="notice-cont">
						<div class="swiper-container" id="notice_swiper">
							<div class="swiper-wrapper"></div>
						</div>
					</div>
					<div class="notice-more">
						<img src="../image/iconrighth.png">
					</div>
				</div>
				<!-- 轮播 -->
				<div class="swiper-container banner-container" id="banner_swiper">
					<div class="swiper-wrapper">
						<div class="swiper-slide" v-for="(b,i) in banner" :key="i" @tap="openLinkPage(b)">
							<img :src="b.pic">
						</div>
					</div>
				</div>
				<div class="function mui-clearfix" style="z-index: 1;">
					<div class="functionL" id="qrcode_setting">
						<div class="functionLc">
							<img src="../image/idnex-message.png">
							<p>码上成交</p>
							<div class="clearfix"></div>
						</div>
					</div>
					<div class="functionR" id="redpack_setting">
						<a href="javascript: void(0);">
							<div class="functionRc">
								<img src="../image/redpack.png">
								<p>发红包</p>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
				</div>
				<div class="functional_selection mui-clearfix">
					<div class="business_card mui-clearfix" id="card">
						<img src="../image/business-card.png">
						<div style="float: left;margin-left: 10px;">
							<p>V名片</p>
							<span style="color: #000;">科技范介绍</span>
						</div>
						<!-- <div class="heitiao">主题</div> -->
					</div>
					<div class="business_cardR mui-clearfix" id="new_customer">
						<img src="../image/customers.png">
						<div style="float: left;margin-left: 15px;">
							<p>团队</p>
							<span style="color: #000;">团队的力量</span>
						</div>
					</div>
					<div class="business_card mui-clearfix" id="shop">
						<img src="../image/Shopping-Mall.png">
						<div style="float: left;margin-left: 15px;">
							<p>商城</p>
							<span style="color: #000;">多渠道资源</span>
						</div>
					</div>
					<div class="business_cardR mui-clearfix" id="target">
						<img src="../image/target.png">
						<div style="float: left;margin-left: 15px;">
							<p>目标&任务</p>
							<span style="color: #000;">释放小宇宙</span>
						</div>
						<!-- <div class="heitiao" style="background-color: #05D6DF;">设置</div> -->
					</div>
				</div>
			</div>
		</div>
		<div class="code_container">
			<div id="QR-code">
				<div class="QR-tu">
					<img src="../image/QR.png" id="qrcode_pic">
				</div>
				<span>二维码类型（<i id="qrcode_type">名片</i>）</span>
				<a id="card_setting" style="float: left;margin-left: 45%;">设置</a>
				<img id="hide_qrcode" src="../image/Close.png" style="width: 28px;height: 28px;float: left;margin-top: 50px;margin-left: 45%;">
				<div class="clearfix"></div>
			</div>
		</div>
		<div id="topPopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="Pop-up-menu">
				<li id="quik_sharing">
					<img src="../image/share.png">
					<span>分享</span>
					<div class="clearfix"></div>
				</li>
				<li id="quik_receipt">
					<img src="../image/receipt.png" style="height: 17px;">
					<span>收款码</span>
					<div class="clearfix"></div>
				</li>
				<li style="border-bottom: none;" id="quik_scan">
					<img src="../image/scan.png">
					<span>扫一扫</span>
					<div class="clearfix"></div>
				</li>
			</div>
		</div>
	</body>
	<script src="../js/mui.js"></script>
	<script src="../js/util.js"></script>
	<script src="../js/swiper.min.js"></script>
	<!-- <script src="../js/Zepto.min.js"></script> -->
	<script src="../js/vue.min.js"></script>
	<script>
		var mask = mui.createMask(function() {
				plus.navigator.setStatusBarStyle('dark');
			}),
			default_team_id = '',
			noticeLen = 0,
			noticeIndex = 0,
			notice = {},
			qrType = 'card',
			userInfo = getUserInfo();

		var app = new Vue({
			el: "#mui-content",
			data: {
				banner: []
			},
			mounted: function() {
				mui.init({
					swipeBack: false,
					keyEventBind: {
						backbutton: false,
						menubutton: true
					},
					pullRefresh: {
						container: ".mui-content",
						down: {
							style: 'circle',
							color: '#2289FF',
							offset: mui.os.ios ? '0px' : '-50px',
							callback: function() {
								getNotice();
								weatherInit(); //天气初始化
								slideInit(true); //幻灯片初始化 
							}
						}
					}
				});

				mui.plusReady(function() {
					mui.post($ajaxUrl + 'appadv', {
						position: 2,
					}, function(res) {
						var datas = res.data;
						// logs(res);
						if (res.errno == 0) {
							var alert_advertising = plus.webview.create("alert_advertising.html", "alert_advertising", {
								background: "transparent",
								top: "0px",
								bottom: "0px",
								width: "100%",
								height: "100%",
								zindex: 1000,
							}, {
								data: datas
							});
							alert_advertising.addEventListener('loaded', function() {
								alert_advertising.show('none', 100);
							}, false);
						}
					}, 'json');


					if (plus.device.model === 'iPhoneX') {
						logs("运行在iphoneX上");
					}
					var banner = getcache('banner');
					if (banner != null) {
						app.banner = banner;
						setTimeout(function() {
							sliderPlay();
						}, 1000)
					}
					plus.navigator.setStatusBarStyle('dark');
					getNotice();
					weatherInit(); //天气初始化
					slideInit(false); //幻灯片初始化
					//监听消息数量 首页广播
					window.addEventListener('messgeNumber', function(e) {
						var tipObj = document.getElementById('unread_message');
						if (e.detail.number) {
							tipObj.innerText = e.detail.number;
							tipObj.style.display = 'block';
						} else {
							tipObj.style.display = 'none';
						}
					})

					//打开扫一扫
					document.getElementById('scan').addEventListener('tap', function() {
						var paymentPage = plus.webview.create('scan.html', 'scan', {
							top: '0',
							bottom: '0',
							scrollIndicator: 'none',
							statusbar: {
								background: '#000'
							}
						});
						paymentPage.show('slide-in-right');
						setStatusBar('#2289FF', 'light');
					});

					//打开收款码页面
					document.getElementById('payment_code').addEventListener('tap', function() {
						var paymentPage = plus.webview.create('payment_code.html', 'payment_code', {
							top: '0',
							bottom: '0',
							scrollIndicator: 'none',
							statusbar: {
								background: '#2289FF'
							}
						});
						paymentPage.show('slide-in-right');
						setStatusBar('#2289FF', 'light');
					});

					//打开设置界面
					document.getElementById('qrcode_setting').addEventListener('tap', function() {
						var settingPage = plus.webview.create('qrcode_setting.html', 'qrcode_setting', {
							top: '0',
							bottom: '0',
							scrollIndicator: 'none',
							statusbar: {
								background: '#2289FF'
							}
						});
						settingPage.show('slide-in-right');
						setStatusBar('#2289FF', 'light');
					})

					//打开设置界面
					document.getElementById('redpack_setting').addEventListener('tap', function() {
						fnOpenWin('redpacket_setting.html', 'redpacket_setting', {
							statusbar: {
								background: '#FFF'
							}
						}, {
							from: 'home'
						}, 'slide-in-right');
					})

					//打开二维码
					mui('.mui-content').on('tap', '#card', function() {
						mui.get($ajaxUrl + 'member', {
							action: 'check_user_info',
							token: userInfo.token
						}, function(res) {
							if (res.errno == 0) {
								openPage('friends_detail.html', 'friends_detail', '#f7f7f7', {
									fid: userInfo.id
								})
							} else {
								openPage('card_setting.html', 'card_setting', '#FFF', {
									fid: userInfo.id
								})
							}
						}, 'json');
					})

					//打开商城
					mui('.mui-content').on('tap', '#shop', function() {
						checkMember(function(e) {
							if (e) {
								fnOpenWin('shop_index.html', 'shop_index', {
									statusbar: {
										background: '#F7F7F7'
									}
								}, {
									page: 'home'
								}, 'slide-in-right');
								setStatusBar('', 'dark');
							}
						})
					})

					//打开目标
					mui('.mui-content').on('tap', '#target', function() {
						fnOpenWin('target.html', 'target', {
							statusbar: {
								background: '#FFF'
							}
						}, {
							page: 'home'
						}, 'slide-in-right');
					})
					//关闭二维码
					document.getElementById('hide_qrcode').addEventListener('tap', function() {
						hideQrcode();
					})

					//跳转团队详情
					document.getElementById('new_customer').addEventListener('tap', function() {
						openPage('team_list.html', 'team_list', '#f7f7f7');
					})
					//查看公告
					mui('.Notice').on('tap', '.swiper-slide', function() {
						var idx = this.dataset.idx;
						noticeDeail(idx);
					})

					// 设置二维码
					document.getElementById('card_setting').addEventListener('tap', function() {
						qrcodeTypeSetting(qrType);
					})

					//查看消息
					document.getElementById('message').addEventListener('tap', function() {
						fnOpenWin('message.html', 'message', {
							statusbar: {
								background: '#FFF'
							}
						}, {
							prePage: 'home'
						}, 'slide-in-right');
					})

					//快捷分享
					document.getElementById('quik_sharing').addEventListener('tap', function() {
						share({
							title: '旺客',
							content: '旺天下之客,让营销更简单!',
							thumbs: ['https://app.wangkeapp.cn/attachment/headimg_6.jpg'],
							href: $ajaxUrl + 'download'
						}, 'web');
						mui('#popover').popover('hide');
					})

					//快捷扫一扫
					document.getElementById('quik_scan').addEventListener('tap', function() {
						fnOpenWin('scan.html', 'scan', {
							statusbar: {
								background: '#000'
							}
						}, '', 'slide-in-right')
						setStatusBar('#2289FF', 'light');
						mui('#popover').popover('hide');
					})

					//快捷收款
					document.getElementById('quik_receipt').addEventListener('tap', function() {
						fnOpenWin('payment_code.html', 'payment_code', {
							statusbar: {
								background: '#2289FF'
							}
						}, '', 'slide-in-right');
						setStatusBar('#2289FF', 'light');
						mui('#popover').popover('hide');
					})
				});
			}
		})


		//获取地理位置
		function weatherInit() {
			plus.geolocation.getCurrentPosition(function(p) {
				getTodayWeather(p.coords.longitude + ',' + p.coords.latitude);
			}, function(e) {
				message('获取地理位置失败!', 'center');
				console.log(e.message);
				getTodayWeather('102.746571,24.980774');
			});
		}

		//获取轮播图
		function slideInit(refresh) {
			// if (!refresh) {
			// 	setTimeout(function() {
			// 		showload(1);
			// 	}, 100)
			// 	showload(0);
			// }
			mui.post($ajaxUrl + 'carousel', {
				position: 1
			}, function(res) {
				if (res.errno == 0) {
					var carousel = res.data;
					app.banner = res.data;
					cacheData("banner", app.banner);
					setTimeout(function() {
						sliderPlay();
					}, 1000)
				} else {
					console.log(res.message);
				}

				if (refresh) {
					setTimeout(function() {
						mui('.mui-content').pullRefresh().endPulldownToRefresh();
					}, 1000)
				}
				// if (!refresh) {
				// 	setTimeout(function() {
				// 		showload(1);
				// 	}, 2000)
				// }
			}, 'json')
		}

		//获取当前天气
		function getTodayWeather(LatandLong) {
			var baidukey = 'S4Z3Zvt623P9TMYDOLF041qMLwxGl2vg';
			var jsonUrl = "http://api.map.baidu.com/telematics/v3/weather?location=" + LatandLong + "&output=json&ak=" +
				baidukey + "";
			mui.ajax(jsonUrl, {
				dataType: 'json',
				type: 'get',
				timeout: 10000,
				success: function(data) {
					if (data.status == "success") {
						var city = data.results[0].currentCity;
						document.getElementById('city').innerHTML = city;
						document.getElementById('temperature').innerHTML = data.results[0].weather_data[0].temperature;
						document.getElementById('weather').innerHTML = data.results[0].weather_data[0].weather;
						var weather = data.results[0].weather_data[0].weather;
						var str = '';
						if (weather.indexOf("晴") != -1) {
							if (weather.indexOf("云") != -1) {
								str +=
									'<div class="icon sun-shower"><div class="cloud"></div><div class="sun"><div class="rays"></div></div></div>';
							} else if (weather.indexOf("雨") != -1) {
								str +=
									'<div class="icon sun-shower"><div class="cloud"></div><div class="sun"><div class="rays"></div></div><div class="rain"></div></div>';
							} else if (weather.indexOf('雪') != -1) {
								str +=
									'<div class="icon flurries"><div class="cloud"></div><div class="sun"><div class="rays"></div></div><div class="snow"><div class="flake"></div></div>';
							} else {
								str += '<div class="icon sun-shower"><div class="sun"><div class="rays"></div></div></div>';
							}
						} else if (weather.indexOf("云") != -1) {
							if (weather.indexOf("雨") != -1) {
								str += '<div class="icon rainy"><div class="cloud"></div><div class="rain"></div></div>';
							} else {
								str += '<div class="icon cloudy"><div class="cloud">< /div><div class="cloud"></div></div>';
							}
						} else if (weather.indexOf("雨") != -1) {
							str += '<div class="icon rainy"><div class="cloud"></div><div class="rain"></div></div>';
						} else if (weather.indexOf("雪") != -1) {
							str +=
								'<div class="icon flurries"><div class="cloud"></div><div class="snow"><div class="flake"></div><div class="flake"></div></div></div>';
						}
						document.getElementById('weather_img').innerHTML = str;
					}
				},
				error: function(xhr, type, error) {
					mui.toast("网络异常,请稍候再试");
				}
			});
		}


		//获取公告
		function getNotice() {
			mui.post($ajaxUrl + 'notice', {
				action: 'list'
			}, function(res) {
				if (res.errno == 0) {
					notice = res.data;
					noticeLen = notice.length;
					var str = '';
					for (var i = 0; i < noticeLen; i++) {
						str += '<div class="swiper-slide mui-ellipsis" data-idx=' + i + '>' + notice[i].title + '</div>';
					}
					document.querySelector(".Notice .swiper-wrapper").innerHTML = str;
					if (noticeLen > 1) {
						scrollInit();
					}
				} else {
					document.querySelector(".Notice").style.background = "#FF0000";
					document.querySelector(".Notice").style.display = "none"; // !important
				}
			}, 'json')
		}

		//公告滚动初始化
		function scrollInit() {
			var mySwiper = new Swiper('#notice_swiper', {
				direction: 'vertical',
				loop: true,
				autoplay: {
					delay: 5000,
					stopOnLastSlide: false,
					disableOnInteraction: false,
				},
			})
		}

		//轮播滚动初始化
		function sliderPlay() {
			var mySwiper = new Swiper('#banner_swiper', {
				loop: true,
				autoplay: {
					delay: 5000,
					stopOnLastSlide: false,
					disableOnInteraction: false,
				}
			})
		}

		//查看公告详情
		function noticeDeail(idx) {
			var detailPage = plus.webview.create('notice_detail.html', 'notice_detail', {
				top: '0',
				bottom: '0',
				scrollIndicator: 'none',
				statusbar: {
					background: '#FFFFFF'
				}
			}, {
				notice: notice[idx],
				page: 'my'
			});
			detailPage.show('slide-in-right');
			setStatusBar('', 'dark');
		}

		// 跳转搜索
		mui('.mui-bar').on('tap', '.mui-title', function() {
			openPage('home_search.html', 'home_search', '#ededed');
		})

		function openLinkPage(o) {
			var link = o.link,
				link_type = o.link_type;
			logs("触发了方法");
			logs(link);
			if (link == '') {
				logs("没有链接")
				return false;
			}
			if (link_type == 1) {
				mui.get($ajaxUrl + 'util', {
					action: 'url_title',
					url: link
				}, function(res) {
					fnOpenWin('webview.html', 'webview', {
						statusbar: {
							background: '#FFF'
						}
					}, {
						title: res.data,
						statusBarStyle: 'dark',
						url: link
					}, 'fade-in');
				}, 'json');
			} else {
				plus.share.getServices(function(s) {
					var shareService = {};
					for (var i in s) {
						var t = s[i];
						shareService[t.id] = t;
					}
					// 更新分享列表
					var ss = shareService['weixin'];
					closeSelf();
					ss ? ss.launchMiniProgram({
						id: 'gh_9fa5f42ab939',
						path: link,
						type: '0', //0-正式版； 1-测试版； 2-体验版
						webUrl: 'https://app.wangkeapp.cn'
					}) : message('打开小程序失败!');
				}, function(e) {
					message('当前环境不支持打开小程序!')
				});
			}
		}
	</script>
</html>
