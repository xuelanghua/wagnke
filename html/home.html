<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<title>首页</title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/index.css" rel="stylesheet" />
		<link href="../icomoon/style.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/swiper.min.css">
		<style>
			.clearfix {
				clear: both;
			}

			.message {
				width: 25px;
				height: 22px;
				margin-top: 10px;
			}

			.target {
				width: 95%;
				position: absolute;
				left: 2.5%;
				right: 2.5%;
				top: 163px;
				color: #000000;
				background-color: #FFFFFF;
				border-radius: 8px;
				box-shadow: 0 -8px 18px 2px #1B86E2;
			}

			ul,
			li {
				list-style: none;
			}

			.titlecontent {
				margin-top: 15px;
			}

			.titlecontentL {
				width: 50%;
				float: left;
				text-align: center;
			}

			.titlecontent li {
				float: left;
				width: 50%;
			}

			.titlecontentL li img {
				height: 24px;
			}

			.titlecontentR {
				width: 50%;
				float: right;
				/* background-color: #0062CC; */
			}

			.titlecontentR span,
			.titlecontentR p {
				font-size: 12px;
				color: #333333;
				margin-bottom: 0;
			}

			.titlecontentR .city-name {
				padding-left: 10%;
				margin-top: -15px;
				text-align: left;
			}

			.Notice {
				height: 41px;
				overflow: hidden;
				/* margin-top: 77px; */
				padding: 10px;
				font-size: 12px;
				color: #000000;
				background-color: #DDDEDE;
				display: none;
			}

			.Notice-title {
				float: left;
			}

			.Notice span {
				float: left;
				margin-left: 15px;
			}

			.Notice img {
				float: right;
				width: 8px;
				margin-top: 3px;
			}

			.Background-picture {
				position: relative;
				text-align: center;
			}

			.Background-picture h4 {
				position: absolute;
				top: 46%;
				left: 10%;
				right: 10%;
				font-size: 18px;
			}

			.function {
				width: 90%;
				position: absolute;
				margin-top: -35px;
				margin-left: 5%;
				border-radius: 8px;
				padding: 15px 0 15px 0;
				box-shadow: 0 0 6px 1px rgba(0, 0, 0, 0.2);
				background-color: #fff;
			}

			.functionL {
				width: 50%;
				float: left;
			}

			.functionLc {
				width: 60%;
				color: #000000;
				margin: 0 auto;
				text-align: center;
			}

			.function img {
				height: 18px;
				float: left;
				margin-top: 10px;
			}

			.function p {
				float: left;
				color: #000000;
				margin-left: 15px;
				font-size: 15px;
				margin-top: 10px;
			}

			.functionR {
				width: 50%;
				float: right;
				border-left: 1px solid #F2F2F2;
			}

			.functionRc {
				width: 50%;
				color: #000000;
				margin: 0 auto;
				text-align: center;
			}

			.functional_selection {
				width: 90%;
				margin: 0 auto;
				margin-top: 37px;
				text-align: left;
			}

			.business_card {
				width: 48%;
				padding: 15px 10px;
				float: left;
				margin-top: 25px;
				border-radius: 7px;
				box-shadow: 0 0 6px 1px #D1D1D3;
				background-color: #fff;
				overflow: hidden;
			}

			.business_cardR {
				width: 48%;
				padding: 15px 10px;
				float: right;
				margin-top: 25px;
				border-radius: 7px;
				box-shadow: 0 0 15px 1px #D1D1D3;
				background-color: #fff;
				overflow: hidden;
			}

			.functional_selection img {
				width: 48px;
				float: left;
			}

			.functional_selection p {
				font-size: 15px;
				color: #000;
				margin-top: 5px;
			}

			.functional_selection span {
				font-size: 11px;
				display: block;
				margin-top: -8px;
			}

			#quick {
				width: 80%;
				margin: 0 auto;
				box-shadow: 0 0 15px 3px #D1D1D3;
				border-radius: 20px;
				background-color: #fff;
				display: none;
				margin-top: -133px;
				z-index: 9999;
			}

			#quick li {
				width: 25%;
				float: left;
				margin-top: 15px;
			}

			#quick li img {
				height: 22px;
			}

			#quick li p {
				font-size: 10px;
				color: #000000;
			}

			.jiandou {
				width: 19px;
				position: absolute;
				margin-left: -12px;
			}

			#back {
				position: fixed;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
			}

			#cover {
				position: fixed;
				z-index: 9999;
				top: 0;
				left: 0;
				display: none;
				width: 100%;
				height: 100%;
				opacity: 0.5;
				background: #484848 none repeat scroll 0% 0%;
			}

			.code_container {
				position: fixed;
				top: 0;
				bottom: 0;
				width: 100%;
				background-color: rgba(0, 0, 0, 0.5) !important;
				z-index: 9;
				display: none;
			}

			#QR-code {
				width: 74%;
				height: 335px;
				background-color: #fff;
				z-index: 10;
				position: fixed;
				top: 25%;
				left: 13%;
				border-radius: 8px;
				text-align: center;
			}

			.QR-tu {
				width: 217px;
				height: 217px;
				margin: 0 auto;
				padding-top: 30px;
			}

			.QR-tu img {
				width: 100%;
			}

			#QR-code span {
				display: block;
				font-size: 15px;
				margin-top: 50px;
				color: #000000;
				padding-bottom: 10px;
			}

			#QR-code a {
				font-size: 13px;
			}

			.mask {
				height: 100%;
				width: 100%;
				position: absolute;
				top: 0;
				background: #000000;
			}

			.mui-slider-title {
				position: absolute;
				bottom: -40%;
				left: 0;
				width: 100%;
				height: 100%;
				line-height: 30px;
				margin: 0;
				text-align: center;
				vertical-align: middle;
				text-indent: 0;
				opacity: 1;
				background-color: rgba(0, 0, 0, 0);
				color: #FFF;
				font-size: 18px;
			}

			.noticeMsg {
				overflow: hidden;
				white-space: nowrap;
				height: 50px;
				width: 100%;
				font-size: 15px;
				-webkit-transition: .4s;
				-o-transition: .4s;
				transition: .4s;
				-webkit-transform: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
				background: url(../Images/notice.png) left 10px center no-repeat;
			}

			.noticeMsg ul li {
				padding: 0;
				margin: 0;
			}

			#scroll_begin li,
			#scroll_end li {
				line-height: 32px;
				text-indent: 30px;
			}

			/* 快捷弹窗 */
			.mui-popover .mui-popover-arrow:after {
				width: 0;
			}

			.mui-popover {
				margin-left: 60%;
				margin-top: 40px;
			}

			.Pop-up-menu {
				width: 128px;
				float: right;
				margin-right: 22px;
				border-radius: 5px;
				background-color: #4c4c4c;
			}

			.Pop-up-menu li {
				padding: 15px 0 10px 0;
				margin-left: 10px;
				border-bottom: 1px solid #6a6a6a;
			}

			.Pop-up-menu li img {
				width: 17px;
				height: 16px;
				float: left;
			}

			.Pop-up-menu li span {
				margin-left: 18px;
				font-size: 15px;
				margin-top: -2px;
				float: left;
			}

			.mui-backdrop {
				background-color: transparent !important;
			}

			.add-btn {
				display: inline-block;
				position: absolute;
				/* background-color: #007AFF; */
				width: 60px;
				height: 44px;
				margin-right: -10px;
				padding-right: 5px;
				z-index: 16;
				right: 0;
			}

			#popover {
				top: 10px !important;
				left: 0 !important;
				right: 0 !important;
			}

			.mui-badge-danger {
				position: absolute;
				right: 5px;
				top: 5px;
				font-size: 10px;
				padding: 3px 5px 1px;
				background-color: #FF0000;
			}

			#message,
			#openPopover {
				position: absolute;
				z-index: 13;
				/* background-color: #20D81F; */
			}

			.mui-bar {
				padding: 0;
			}

			.open-message,
			#openPopover {
				position: absolute;
				padding: 0 15px;
				height: 42px;
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 13;
				/* background-color: #0062CC; */
				flex-shrink: 0;
			}

			body {
				padding-top: constant(safe-area-inset-top);
			}

			.mui-bar.mui-bar-nav {
				top: constant(safe-area-inset-top);
			}

			.titlecontentR .weather-info {
				margin-top: -10px;
			}

			.titlecontentR .weather-info p {
				font-size: 12px;
				color: #333333;
				margin-bottom: 0;
				padding: 0;
				line-height: 1.2;
				flex-grow: 1;
				text-align: center;
				margin-top: 0;
			}

			.weather-img {
				position: relative;
				width: 60px;
				height: 50px;
				margin: 0 auto;
			}

			.weather-img .icon {
				position: relative;
				width: 50px;
				height: 50px;
				left: 0;
				margin: 0 auto;
			}

			.flex-left-cont {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.mui-bar-nav~.mui-content {
				padding-top: 121px;
			}

			.mui-slider-item {
				touch-action: pan-y;
			}

			.bar-top {
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			.mui-bar .mui-title {
				display: inline-flex;
				font-size: 16px;
				color: #333333;
				position: relative;
				flex-grow: 1;
				align-items: center;
				justify-content: center;
				left: 0;
				right: 0;
				overflow: visible;
			}

			.team-list {
				top: 44px;
				position: absolute;
				height: auto;
				z-index: 12;
				width: 100%;
				display: none;
			}

			.team-list .mui-table-view-cell {
				padding: 0;
				width: 100%;
			}

			.team-list .mui-table-view-cell:after {
				left: 0;
				background-color: #DDDDDD;
			}

			.mui-title .mui-icon {
				font-size: 20px;
				color: #333333;
			}

			.mui-backdrop {
				z-index: 9;
			}
		</style>
	</head>
	<body>
		<div style="margin-bottom: 50px;">
			<header class="mui-bar mui-bar-nav" style="height:120px; background-color: #fff;box-shadow: 0 0 0 #fff;">
				<div class="bar-top">
					<div id="message" class="open-message">
						<img src="../image/index-message-icon.png" alt="" class="mui-pull-left" style="width: 25px;height: 22px;">
						<span class="mui-badge mui-badge-danger" style="display: none;z-index: 14;" id="unread_message">0</span>
					</div>
					<div class="mui-title">
						<span id="team_name">旺客</span>
						<span class="mui-icon mui-icon-arrowup mui-icon-arrowdown"></span>
						<div class="team-list">
							<ul class="mui-table-view" id="team-list"></ul>
						</div>
					</div>
					<a href="#popover" class="add-btn" id="openPopover">
						<img src="../image/index-add-icon.png" style="width: 20px;height: 20px;">
					</a>
				</div>
				<!-- <a href="#popover" id="openPopover">
					<img src="../image/index-add-icon.png" class="mui-pull-right" style="width: 20px;height: 20px;margin-top: 11px;margin-right: 10px;">
				</a> -->
				<div class="titlecontent mui-clearfix">
					<div class="titlecontentL">
						<li id="scan">
							<img src="../image/index-scan.png">
							<p>扫一扫</p>
						</li>
						<li id="payment_code">
							<img src="../image/index-receipt-code.png">
							<p>收款码</p>
						</li>
					</div>
					<div class="titlecontentR">
						<p class="city-name" id="city">昆明市</p>
						<!-- <div class="icon sun-shower">
							<div class="cloud"></div>
							<div class="sun">
								<div class="rays"></div>
							</div>
							<div class="rain"></div>
						</div> -->
						<div class="flex-left-cont">
							<div class="weather-img" id="weather_img">
								<div class="icon sun-shower">
									<div class="cloud"></div>
									<div class="sun">
										<div class="rays"></div>
									</div>
								</div>
							</div>
							<div class="weather-info">
								<p>今天</p>
								<p>
									<font id="temperature">-°~-°</font>
								</p>
								<p>
									<font id="weather">-</font>
								</p>
							</div>
						</div>
					</div>
				</div>
			</header>
			<div class="mui-content">
				<div class="Notice">
					<div class="Notice-title"><img src="../image/notice4.png" style="width:18px" alt=""></div>
					<span id="notice_container"></span>
					<img src="../image/iconrighth.png">
					<div class="clearfix"></div>
				</div>
				<div class="mui-slider" id="slider_container">
					<div class="mui-slider-group">
						<div class="mui-slider-item">
							<a href="javascript: void(0);">
								<img src="../image/home_adv.jpg" />
								<p class="mui-slider-title">只要精神不滑坡,办法总比困难多</p>
							</a>
						</div>
					</div>
				</div>

				<div class="function" style="z-index: 1;">
					<div class="functionL" id="qrcode_setting">
						<div class="functionLc">
							<img src="../image/idnex-message.png">
							<p>码上成交</p>
							<div class="clearfix"></div>
						</div>
					</div>
					<div class="functionR" id="redpack_setting">
						<a href="javascript: void(0);">
							<div class="functionRc">
								<img src="../image/redpack.png">
								<p>发红包</p>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
					<div class="clearfix"></div>
				</div>

				<div class="functional_selection">
					<div class="business_card" id="card">
						<img src="../image/business-card.png">
						<div style="float: left;margin-left: 10px;">
							<p>V名片</p>
							<span style="color: #000;">科技范自我介绍</span>
						</div>
						<div class="heitiao">雷达</div>
						<div class="clearfix"></div>
					</div>
					<div class="business_cardR" id="new_customer">
						<img src="../image/customers.png">
						<div style="float: left;margin-left: 15px;">
							<p>团队详情</p>
							<span style="color: #000;">团队的力量</span>
						</div>
						<div class="clearfix"></div>
					</div>
					<div class="business_card" id="shop">
						<img src="../image/Shopping-Mall.png">
						<div style="float: left;margin-left: 15px;">
							<p>商城</p>
							<span style="color: #000;">个性化小程序</span>
						</div>
						<div class="clearfix"></div>
					</div>
					<div class="business_cardR" id="target">
						<img src="../image/target.png">
						<div style="float: left;margin-left: 15px;">
							<p>目标&任务</p>
							<span style="color: #000;">释放小宇宙</span>
						</div>
						<!-- <div class="heitiao" style="background-color: #05D6DF;">设置</div> -->
						<div class="clearfix"></div>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
		<div class="code_container">
			<div id="QR-code">
				<div class="QR-tu">
					<img src="../image/QR.png" id="qrcode_pic">
				</div>
				<span>二维码类型（<i id="qrcode_type">名片</i>）</span>
				<a id="card_setting" style="float: left;margin-left: 45%;">设置</a>
				<img id="hide_qrcode" src="../image/Close.png" style="width: 28px;height: 28px;float: left;margin-top: 50px;margin-left: 45%;">
				<div class="clearfix"></div>
			</div>
		</div>
		<div id="popover" class="mui-popover">
			<div class="Pop-up-menu">
				<li id="quik_sharing">
					<img src="../image/share.png">
					<span>分享</span>
					<div class="clearfix"></div>
				</li>
				<li id="quik_receipt">
					<img src="../image/receipt.png" style="height: 17px;">
					<span>收款码</span>
					<div class="clearfix"></div>
				</li>
				<li style="border-bottom: none;" id="quik_scan">
					<img src="../image/scan.png">
					<span>扫一扫</span>
					<div class="clearfix"></div>
				</li>
			</div>
		</div>
	</body>
	<script src="../js/mui.js"></script>
	<script src="../js/util.js"></script>
	<script src="../js/swiper.min.js"></script>
	<script src="../js/Zepto.min.js"></script>
	<script>
		var mask = mui.createMask(function() {
			$(".mui-title .mui-icon").removeClass("mui-icon-arrowdown");
			$(".team-list").slideUp();
		});
		var default_team_id = '';
		mui.init({
			swipeBack: false,
			keyEventBind: {
				backbutton: false,
				menubutton: true
			},
			pullRefresh: {
				container: ".mui-content",
				down: {
					style: 'circle',
					color: '#2289FF',
					callback: function() {
						getNotice();
						weatherInit(); //天气初始化
						slideInit(true); //幻灯片初始化 
						getTeamList();//获取团队
					}
				}
			}
		});

		var noticeLen = 0;
		var noticeIndex = 0;
		var notice = {};
		var qrType = 'card';
		var userInfo = getUserInfo();
		mui.plusReady(function() {

			if (plus.device.model === 'iPhoneX') {
				logs("运行在iphoneX上");
			}

			// var self = plus.webview.currentWebview();
			// self.setStyle({
			// 	bottom: 51
			// })
			getNotice();
			weatherInit(); //天气初始化
			slideInit(false); //幻灯片初始化
			//监听消息数量 首页广播
			window.addEventListener('messgeNumber', function(e) {
				var tipObj = document.getElementById('unread_message');
				if (e.detail.number) {
					tipObj.innerText = e.detail.number;
					tipObj.style.display = 'block';
				} else {
					tipObj.style.display = 'none';
				}
				// alert(e.detail.number);
			})

			//打开扫一扫
			var scan = document.getElementById('scan');
			scan.addEventListener('tap', function() {
				var paymentPage = plus.webview.create('scan.html', 'scan', {
					top: '0',
					bottom: '0',
					scrollIndicator: 'none',
					statusbar: {
						background: '#000'
					}
				});
				paymentPage.show('slide-in-right');
				setStatusBar('#2289FF', 'light');
			});

			//打开收款码页面
			var payment_code = document.getElementById('payment_code');
			payment_code.addEventListener('tap', function() {
				var paymentPage = plus.webview.create('payment_code.html', 'payment_code', {
					top: '0',
					bottom: '0',
					scrollIndicator: 'none',
					statusbar: {
						background: '#2289FF'
					}
				});
				paymentPage.show('slide-in-right');
				setStatusBar('#2289FF', 'light');
			});

			//打开设置界面
			document.getElementById('qrcode_setting').addEventListener('tap', function() {
				var settingPage = plus.webview.create('qrcode_setting.html', 'qrcode_setting', {
					top: '0',
					bottom: '0',
					scrollIndicator: 'none',
					statusbar: {
						background: '#2289FF'
					}
				});
				settingPage.show('slide-in-right');
				setStatusBar('#2289FF', 'light');
			})

			//打开设置界面
			document.getElementById('redpack_setting').addEventListener('tap', function() {
				fnOpenWin('redpacket_setting.html', 'redpacket_setting', {
					statusbar: {
						background: '#FFF'
					}
				}, {
					from: 'home'
				}, 'slide-in-right');
			})

			//打开二维码
			mui('.mui-content').on('tap', '#card', function() {
				// var type = this.dataset.type;
				// showQrcode('card');
				// message(userInfo.id);
				mui.get($ajaxUrl + 'member', {
					action: 'check_user_info',
					token: userInfo.token
				}, function(res) {
					if (res.errno == 0) {
						openPage('friends_detail.html', 'friends_detail', '#f7f7f7', {
							fid: userInfo.id
						})
					} else {
						openPage('card_setting.html', 'card_setting', '#FFF', {
							fid: userInfo.id
						})
					}
				}, 'json');
			})

			//打开商城
			mui('.mui-content').on('tap', '#shop', function() {
				// var tips = plus.webview.create("tipsmodel/opening_model.html", "opening_model", {
				// 	background: "transparent"
				// }, "");
				// tips.show();
				var activation = checkMember();
				if (activation) {
					fnOpenWin('shop_index.html', 'shop_index', {
						statusbar: {
							background: '#F7F7F7'
						}
					}, {
						page: 'home'
					}, 'slide-in-right');
					setStatusBar('', 'dark');
				}
			})

			//打开目标
			mui('.mui-content').on('tap', '#target', function() {
				fnOpenWin('target.html', 'target', {
					statusbar: {
						background: '#FFF'
					}
				}, {
					page: 'home'
				}, 'slide-in-right');
			})
			//关闭二维码
			document.getElementById('hide_qrcode').addEventListener('tap', function() {
				hideQrcode();
			})

			//查看新增客户
			// document.getElementById('new_customer').addEventListener('tap', function() {
			// 	mui.fire(plus.webview.getWebviewById('H54F3E71F'), 'newCustomer');
			// 	mui.fire(plus.webview.getWebviewById('chat'), 'newCustomer');
			// })

			//跳转团队详情
			document.getElementById('new_customer').addEventListener('tap', function() {
				if (default_team_id) {
					openPage('team_detail.html', 'team_detail', '#f7f7f7', {
						teamid: default_team_id
					});
				}else{
					openPage('join_team.html', 'join_team.html', '#f7f7f7');
				}
			})
			//查看公告
			mui('.mui-content').on('tap', '.Notice', function() {
				noticeDeail();
			})

			// 设置二维码
			document.getElementById('card_setting').addEventListener('tap', function() {
				qrcodeTypeSetting(qrType);
			})

			//查看消息
			document.getElementById('message').addEventListener('tap', function() {
				fnOpenWin('message.html', 'message', {
					statusbar: {
						background: '#FFF'
					}
				}, {
					prePage: 'home'
				}, 'slide-in-right');
			})

			//快捷分享
			document.getElementById('quik_sharing').addEventListener('tap', function() {
				share({
					title: '旺客',
					content: '旺天下之客,让营销更简单!',
					thumbs: ['https://app.wangkeapp.cn/attachment/headimg_6.jpg'],
					href: $ajaxUrl + 'download'
				}, 'web');
				mui('#popover').popover('hide');
			})

			//快捷扫一扫
			document.getElementById('quik_scan').addEventListener('tap', function() {
				fnOpenWin('scan.html', 'scan', {
					statusbar: {
						background: '#000'
					}
				}, '', 'slide-in-right')
				setStatusBar('#2289FF', 'light');
				mui('#popover').popover('hide');
				// document.getElementById('popover').classList.add('mui-hidden'); 
			})

			//快捷收款
			document.getElementById('quik_receipt').addEventListener('tap', function() {
				fnOpenWin('payment_code.html', 'payment_code', {
					statusbar: {
						background: '#2289FF'
					}
				}, '', 'slide-in-right');
				setStatusBar('#2289FF', 'light');
				mui('#popover').popover('hide');
				// document.getElementById('popover').classList.add('mui-hidden');
			})
			// 获取团队信息
			getTeamList();
		});

		//获取地理位置
		function weatherInit() {
			plus.geolocation.getCurrentPosition(function(p) {
				getTodayWeather(p.coords.longitude + ',' + p.coords.latitude);
			}, function(e) {
				message('获取地理位置失败!', 'center');
				console.log(e.message);
				getTodayWeather('102.746571,24.980774');
			});
		}

		//获取轮播图
		function slideInit(refresh) {
			if (!refresh) {
				setTimeout(function() {
					// showload(1);
					showload(1);
				}, 100)
				// showload(0);
				showload(0);
			}
			mui.post($ajaxUrl + 'carousel', {
				position: 1
			}, function(res) {
				// logs(res);
				if (res.errno == 0) {
					var carousel = res.data;
					var len = carousel.length;
					var str = '';
					if (len == 1) {
						str += '<div class="mui-slider-group">';
						str += '<div class="mui-slider-item"><a href="' + carousel[0].link + '"><img src="' + carousel[0].pic +
							'" /><p class="mui-slider-title">' + carousel[0].title + '</p></a></div>';
						str += '</div>';
					} else {
						str += '<div class="mui-slider-group mui-slider-loop">';
						str += '<div class="mui-slider-item mui-slider-item-duplicate"><a href="' + carousel[len - 1].link +
							'"><img src="' + carousel[len - 1].pic + '" /><p class="mui-slider-title">' + carousel[len - 1].title +
							'</p></a></div>';
						for (var i = 0; i < len; i++) {
							str += '<div class="mui-slider-item"><a href="' + carousel[i].link + '"><img src="' + carousel[i].pic +
								'" /><p class="mui-slider-title">' + carousel[i].title + '</p></a></div>';
						}
						str += '<div class="mui-slider-item mui-slider-item-duplicate"><a href="' + carousel[0].link + '"><img src="' +
							carousel[0].pic + '" /><p class="mui-slider-title">' + carousel[0].title + '</p></a></div>';
						str += '</div>';
					}
					document.getElementById('slider_container').innerHTML = str;

					setTimeout(function() {
						sliderPlay();
					}, 2000)
				} else {
					console.log(res.message);
				}
				if (refresh) {
					setTimeout(function() {
						mui('.mui-content').pullRefresh().endPulldownToRefresh();
					}, 1000)
				}
				if (!refresh) {
					setTimeout(function() {
						// showload(1);
						showload(1);
					}, 2000)
				}
			}, 'json')
		}

		//获取当前天气
		function getTodayWeather(LatandLong) {
			var baidukey = 'S4Z3Zvt623P9TMYDOLF041qMLwxGl2vg';
			var jsonUrl = "http://api.map.baidu.com/telematics/v3/weather?location=" + LatandLong + "&output=json&ak=" +
				baidukey + "";
			mui.ajax(jsonUrl, {
				dataType: 'json',
				type: 'get',
				timeout: 10000,
				success: function(data) {
					// logs(data);
					if (data.status == "success") {
						var city = data.results[0].currentCity;
						// var city = "红河哈尼族自治州天气不错";
						// if (city.length > 3) {
						// 	city = city.substr(0, 3) + '...';
						// }
						document.getElementById('city').innerHTML = city;
						document.getElementById('temperature').innerHTML = data.results[0].weather_data[0].temperature;
						document.getElementById('weather').innerHTML = data.results[0].weather_data[0].weather;
						var weather = data.results[0].weather_data[0].weather;
						var str = '';
						if (weather.indexOf("晴") != -1) {
							if (weather.indexOf("云") != -1) {
								str +=
									'<div class="icon sun-shower"><div class="cloud"></div><div class="sun"><div class="rays"></div></div></div>';
							} else if (weather.indexOf("雨") != -1) {
								str +=
									'<div class="icon sun-shower"><div class="cloud"></div><div class="sun"><div class="rays"></div></div><div class="rain"></div></div>';
							} else if (weather.indexOf('雪') != -1) {
								str +=
									'<div class="icon flurries"><div class="cloud"></div><div class="sun"><div class="rays"></div></div><div class="snow"><div class="flake"></div></div>';
							} else {
								str += '<div class="icon sun-shower"><div class="sun"><div class="rays"></div></div></div>';
							}
						} else if (weather.indexOf("云") != -1) {
							if (weather.indexOf("雨") != -1) {
								str += '<div class="icon rainy"><div class="cloud"></div><div class="rain"></div></div>';
							} else {
								str += '<div class="icon cloudy"><div class="cloud">< /div><div class="cloud"></div></div>';
							}
						} else if (weather.indexOf("雨") != -1) {
							str += '<div class="icon rainy"><div class="cloud"></div><div class="rain"></div></div>';
							// str += '<div class="icon rainy"><div class="cloud"></div><div class="rain"></div></div>';
						} else if (weather.indexOf("雪") != -1) {
							str +=
								'<div class="icon flurries"><div class="cloud"></div><div class="snow"><div class="flake"></div><div class="flake"></div></div></div>';
						}
						document.getElementById('weather_img').innerHTML = str;
					}
				},
				error: function(xhr, type, error) {
					mui.toast("网络异常,请稍候再试");
				}
			});
		}

		//轮播图轮播设置
		function sliderPlay() {
			mui('.mui-slider').slider({
				interval: 2500 //自动轮播周期，若为0则不自动播放，默认为0；
			});
		}
		//展示二维码
		function showQrcode(type) {
			mui.post($ajaxUrl + 'userqrcode&action=make_url', {
				type: type,
				token: userInfo.token
			}, function(res) {
				if (res.errno == 0) {
					var qrcodeType = {
						'redpacket': '红包',
						'card': '名片',
						'link': '自定义',
						'pic': '图片',
						'article': '文章红包',
						'shop': '商城'
					};
					if (res.data.type != 'shop') {
						document.getElementById('qrcode_setting').style.display = 'block';
						qrType = res.data.type;
					} else {
						document.getElementById('qrcode_setting').style.display = 'none';
					}
					var url = $ajaxUrl + 'userqrcode&action=make_qrcode&token=' + userInfo.token + '&url=' + res.data.url;
					document.getElementById('qrcode_type').innerHTML = qrcodeType[res.data.type];
					document.getElementById('qrcode_pic').setAttribute('src', url);
					document.getElementsByClassName('code_container')[0].style.display = 'block';
				} else if (res.errno == 1) {
					plus.nativeUI.toast(res.msg);
				} else if (res.errno == 2) {
					var settingPage = plus.webview.create('qrcode_setting.html', 'qrcode_setting', {
						top: '0',
						bottom: '0',
						scrollIndicator: 'none',
						statusbar: {
							background: '#2289FF'
						}
					});
					settingPage.show('slide-in-bottom');
					setStatusBar('#2289FF', 'light');
				}
			}, 'json');
		}

		//隐藏二维码
		function hideQrcode() {
			document.getElementsByClassName('code_container')[0].style.display = 'none';
		}

		//获取公告
		function getNotice() {
			mui.post($ajaxUrl + 'notice', {
				action: 'list'
			}, function(res) {
				if (res.errno == 0) {
					notice = res.data;
					noticeLen = notice.length;
					var str = '<div class="swiper-container"><div class="swiper-wrapper">';
					for (var i = 0; i < noticeLen; i++) {
						str += '<div class="swiper-slide notice_' + i + '" data-id="' + notice[i].id + '">' + notice[i].title +
							'</div>';
					}
					str += '</div></div>';
					document.getElementById('notice_container').innerHTML = str;
					document.getElementsByClassName('Notice')[0].style.display = 'block';
					if (noticeLen > 1) {
						scrollInit();
					}
				} else {
					console.log(res.message);
				}
			}, 'json')
		}

		//公告滚动初始化
		function scrollInit() {
			var mySwiper = new Swiper('.swiper-container', {
				autoplay: true, //可选选项，自动滑动
				loop: true,
				direction: 'vertical',
				speed: 5000,
				autoHeight: true,
				watchOverflow: true,
				on: {
					slideChange: function() {
						var index = this.activeIndex;
						if (index <= noticeLen) {
							noticeIndex = index - 1;
						} else {
							noticeIndex = 0;
						}
					},
				}
			})
		}

		//查看公告详情
		function noticeDeail() {
			var detailPage = plus.webview.create('notice_detail.html', 'notice_detail', {
				top: '0',
				bottom: '0',
				scrollIndicator: 'none',
				statusbar: {
					background: '#FFF'
				}
			}, {
				notice: notice[noticeIndex],
				page: 'home'
			});
			detailPage.show('slide-in-right');
		}

		//设置二维码类型
		function qrcodeTypeSetting(type) {
			var newPage = plus.webview.create(type + '_setting.html', type + '_setting', {
				top: '0',
				bottom: '0',
				scrollIndicator: 'none',
				statusbar: {
					background: '#FFF'
				}
			}, {
				'from': 'home'
			});
			newPage.show('slide-in-bottom');
			hideQrcode();
		}
		//获取团队信息
		var teamchange = true;

		function getTeamList() {
			mui.post($ajaxUrl + 'team&action=personal_team_list', {
				token: userInfo.token,
			}, function(res) {
				logs(res);
				if (res.errno == 0) {
					logs(res.data);
					var data = res.data;
					if (data.length > 1) {
						var html = "";
						for (var i in data) {
							if (data[i].is_default == 1) {
								document.getElementById("team_name").innerText = data[i].name;
								default_team_id = data[i].team_id;
							}
							html += '<li class="mui-table-view-cell" data-tid=' + data[i].team_id + '>' + data[i].name + '</li>';
						}
						document.getElementById("team-list").innerHTML = html;
					} else if (data.length == 1 && data != "") {
						default_team_id = data[0].team_id;
						document.getElementById("team_name").innerText = data[0].name;
						mui(".mui-title .mui-icon")[0].style.display = "none";
						teamchange = false;
					} else {
						document.getElementById("team_name").innerText = "旺客"
						mui(".mui-title .mui-icon")[0].style.display = "none";
						teamchange = false;
						default_team_id=0;
					}
				} else {}
			}, 'json');
		}
		//切换团队
		mui('.mui-bar').on('tap', '.mui-title', function() {
			if (teamchange) {
				mask.show();
				$(".mui-title .mui-icon").toggleClass("mui-icon-arrowdown");
				$(".team-list").slideToggle();
			}

		})
		// 切换团队名称
		mui('.mui-bar').on('tap', '.mui-table-view-cell', function() {
			default_team_id = this.dataset.tid;
			var _self = this;
			mui.post($ajaxUrl + 'team&action=set_default_team', {
				token: userInfo.token,
				team_id: default_team_id
			}, function(res) {
				if (res.errno == 0) {
					$("#team_name").text(_self.innerText);
				} else {
					message("切换失败，请稍后重试");
				}
			}, 'json');
		})
	</script>
</html>
