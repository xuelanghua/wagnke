<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>团队列表</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../iconfont/iconfont.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/vip-page.css" />
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			.team-list {
				position: relative;
			}

			.sign-tags {
				position: absolute;
				right: 0;
				top: 0;
				z-index: 9;
				width: 0.75rem;
				height: auto;
			}

			.rank-num {
				font-size: 0.24rem;
				color: #333333;
				display: inline-flex;
				align-items: center;
			}

			.rank-sign {
				width: 0.27rem;
				margin-right: 5px;
			}

			.mui-content.team-list-container {
				padding-bottom: 100px;
			}

			.opction-cont {
				position: relative;
				display: flex;
				justify-content: space-between;
				height: 0.85rem;
				margin-top: 0.1rem;
			}

			.opction-cont:before {
				content: "";
				display: block;
				width: 100%;
				height: 1px;
				background-color: #DDDDDD;
				top: 0;
				left: 0;
				position: absolute;
				-webkit-transform: scaleY(0.5);
				transform: scaleY(0.5);
			}

			.opction-btn {
				height: 100%;
				flex-grow: 1;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 0.24rem;
				position: relative;
			}

			.opction-btn.grayness {
				opacity: 0.3;
			}

			.opction-btn:nth-of-type(2):after,
			.opction-btn:last-of-type:after {
				content: "";
				display: inline-block;
				width: 1px;
				height: 40%;
				background-color: #DDDDDD;
				top: 30%;
				left: 0;
				position: absolute;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
			}

			.opction-cont img {
				height: 0.29rem;
				margin-right: 0.13rem;
			}

			.inside-top {
				padding: 0.2rem 0.3rem 0;
			}

			.team-list-container .operation-section {
				z-index: 10;
			}

			.mui-backdrop {
				background-color: rgba(0, 0, 0, 0);
			}

			/* 搜索框 */
			.search-cont.active .search-input {
				border-radius: 14px;
				flex-grow: 1;
			}

			.search-cont {
				width: auto;
				display: flex;
				align-items: center;
				position: relative;
			}

			.search-cont.active {
				position: relative;
				width: 100%;
			}

			.search-cont .mui-icon-search {
				position: absolute;
				left: 5px;
				font-size: 22px;
				z-index: 9;
			}

			.search-cont .search-input {
				border-radius: 14px;
				text-align: left;
				width: 20px;
				position: relative;
				height: 28px;
				-webkit-transition: all 0.2s ease-in-out;
				transition: all 0.2s ease-in-out;
				flex-shrink: 0;
			}

			input[type=search] {
				background-color: #e8e8e8;
			}

			.search-cont.active .search-input {
				padding-left: 40px;
				padding-right: 30px;
				background-color: #e8e8e8;
				flex-shrink: 0;
				border-radius: 14px;
				flex-grow: 1;
			}

			.search-cont.active:after {
				content: '';
				background-color: rgba(0, 0, 0, 0.1);
				width: 1px;
				height: auto;
				bottom: 30%;
				top: 30%;
				left: 32px;
				position: absolute;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
			}

			.search-cont input::-webkit-input-placeholder {
				color: #999999;
				font-size: 0.24rem;
			}

			.search-cont form {
				display: flex;
				align-items: center;
				position: relative;
				width: 100%;
			}

			.search-cont .mui-icon-clear {
				right: 48px;
				position: absolute;
				font-size: 20px;
				color: #999999;
			}

			.mui-action-back.mui-icon.mui-icon-left-nav {
				margin-left: 0;
			}

			.mui-bar-nav {
				display: flex;
				align-items: center;
			}

			.mui-bar-nav.mui-bar .mui-action-back {
				padding-left: 0;
				padding-right: 20px;
			}

			.mui-bar .mui-title {
				position: relative;
				flex-grow: 1;
				margin: 0;
				left: 0;
				right: 0;
			}

			.mui-bar-nav.mui-bar .mui-icon-search {
				margin: 0;
				padding: 0;
			}

			.cancel-btn {
				display: inline-flex;
				height: 44px;
				padding: 5px;
				align-items: center;
				justify-content: center;
				font-size: 16px;
				color: #666666;
			}
			.void-data-tips{
				padding: 20%;
				text-align: center;
			}
			.void-data-tips img{
				width: 100%;
			}
		</style>
		<script>
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
		</script>
	</head>

	<body>
		<div id="mui-content" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
				<div class="mui-title choice-team" v-show="!isSearch">
					<span id="team_name">{{teamName}}</span>
					<span :class="clsName"></span>
				</div>
				<div class="mui-input-row search-cont" :class="[isSearch?'active':'']">
					<form action="" onsumit="return false">
						<span class="mui-icon mui-icon-search"></span>
						<input class="search-input" v-model="keyword" type="search" id="search" placeholder="输入团队名称">
						<span class="mui-icon mui-icon-clear" v-show="keyword" @tap="keyword=''"></span>
						<span v-show="isSearch" class="cancel-btn">取消</span>
					</form>
				</div>
			</header>

			<div class="mui-content team-list-container">
				<div class="my-join-team" v-if="joinFlag">
					<h2><i></i>正式团队</h2>
					<ul>
						<li class="team-list" v-for="(list, index) in joinList" :key="index">
							<!-- <img class="sign-tags" src="../image/icon/sign-tags-data-b.png" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)"> -->
							<div class="inside">
								<i class="adorn"></i>
								<div class="inside-top" @tap="detail(list.team_id,list.type)">
									<div class="team-title">
										{{list.name}}
										<span class="mui-badge mui-badge-primary">
											<span class="iconfont icon-friends"></span>
											{{list.current_number}} 人
										</span>
									</div>
									<div class="time-person">
										<span class="rank-num">
											<img class="rank-sign" :src="'../image/icon/rank'+list.level+'.png'">
											<span v-if="list.level==0">佰级别收入</span>
											<span v-if="list.level==1">仟级别收入</span>
											<span v-if="list.level==2">萬级别收入</span>
											<span v-if="list.level==3">拾萬级别收入</span>
											<span v-if="list.level==4">佰萬级别收入</span>
											<span v-if="list.level==5">仟萬级别收入</span>
										</span>
										<span v-if="list.rank>0" class="rank-num">排名：{{list.rank}}</span>
										<span v-else class="rank-num">暂无排名</span>
										<span class="create-person">创建人：{{list.captain_name.name || list.captain_name.nickName}}</span>
									</div>
								</div>
								<div class="opction-cont">
									<div class="opction-btn" @tap="groupsChat(list.team_id, list.name,list.type)">
										<img src="../image/icon/team-list-opction02.png">
										<span>群聊</span>
									</div>
									<div class="opction-btn" @tap="courseList(list.team_id,list.is_captain)">
										<img src="../image/icon/team-list-opction03.png">
										<span>团队课程</span>
									</div>
									<div class="opction-btn" :class="list.data_status==0&&list.is_captain==0?'grayness':''" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
										<img src="../image/icon/team-list-opction01.png">
										<span>数据</span>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<div class="my-team" v-if="createFlag">
					<h2><i></i>数据团队</h2>
					<ul>
						<li class="team-list" v-for="(list, index) in createList" :key="index">
							<!-- <img class="sign-tags" :src="list.data_status==1?'../image/icon/sign-tags-data-y.png':'../image/icon/sign-tags-detail-y.png'"
						 @tap="teamDetail(list.team_id,list.data_status,list.is_captain)"> -->
							<div class="inside">
								<i class="adorn"></i>
								<div class="inside-top" @tap="detail(list.team_id,list.type)">
									<div class="team-title">
										{{list.name}}
										<span class="mui-badge mui-badge-primary">
											<span class="iconfont icon-friends"></span>
											{{list.current_number}} 人
										</span>
									</div>
									<div class="time-person">
										<span class="create-time">创建时间：{{list.create_time}}</span>
										<span class="create-time">创建人：{{list.captain_name.name||list.captain_name.nickName}}</span>
									</div>
								</div>
								<div class="opction-cont">
									<div class="opction-btn" @tap="groupsChat(list.team_id, list.name,list.type)">
										<img src="../image/icon/team-list-opction02.png">
										<span>群聊</span>
									</div>
									<div class="opction-btn" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
										<img src="../image/icon/team-list-opction01.png">
										<span>数据</span>
									</div>
								</div>
							</div>
						</li>
					</ul>
					<div v-else>
						暂未创建团队
					</div>
				</div>
				<div class="void-data-tips" v-if="void_seach">
					<img src="../image/icon/void-seach-result.png" >
					<p>没有搜索到相关团队~</p>
				</div>
				<div class="operation-section" v-show="!isSearch">
					<span class="create-team">创建团队</span>
					<span class="join-team">加入团队</span>
				</div>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			var team_list = [],
				teams = null,
				team_type = "",
				mask = mui.createMask(function() {
					teams.hide("slide-out-top");
					plus.navigator.setStatusBarStyle('dark');
				});
			mui.init({
				swipeBack: true,
				beforeback: function() {
					var per = plus.webview.currentWebview().opener();
					if (per.id == "user") {
						setStatusBar('', 'light');
					}
				}
			});

			var userInfo = getUserInfo();
			var app = new Vue({
				el: '#mui-content',
				data: {
					createList: [],
					joinList: [],
					createFlag: false,
					joinFlag: false,
					teamLists: {},
					userSelf: "",
					clsName: 'mui-icon mui-icon-arrowdown',
					teamName: '旺客',
					keyword: '',
					isSearch: false,
					void_seach:false
					// userSelf:userInfo.nickName
				},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						getTeamList();
						getPersonTeam();
						mui('.mui-content').on('tap', '.create-team', function() {
							if (userInfo.group_id < 2) {
								message('您没有创建团队的权限!');
								return;
							}
							openPage('create_team.html', 'create_team', '#f7f7f7', '')
						})

						mui('.mui-content').on('tap', '.join-team', function() {
							openPage('join_team.html', 'join_team', '#f7f7f7', '')
						})
					})
				},
				methods: {
					// 团队详情
					detail: function(team_id, type) {
						// 1正式团队 2数据团队
						if (type == 1) {
							openPage('team_detail.html', 'team_detail', '#f7f7f7', {
								teamid: team_id
							});
						} else {
							openPage('other_team_detail.html', 'other_team_detail', '#f7f7f7', {
								teamid: team_id
							});
						}
					},
					teamDetail: function(team_id, data_status, is_captain) {
						if (data_status == 1 || is_captain == 1) {
							fnOpenWin('webview.html', 'webview', {
								statusbar: {
									background: '#FFFFFF'
								}
							}, {
								tid: team_id,
								title: '团队',
								statusBarStyle: 'dark',
								url: 'https://app.wangkeapp.cn/addons/longbing_card/dist?uniacid=6&id=' + team_id +
									'&m=longbing_card'
							}, 'slide-in-right');
						} else {
							// 不做跳转
						}
					},
					// 群聊
					groupsChat: function(id, name, type) {
						openPage('team_chat.html', 'team_chat', '#f7f7f7', {
							tid: id,
							teamName: name,
							teamType: type
						});
					}
				}
			})

			// 获取团队列表
			function getTeamList() {
				mui.post($ajaxUrl + 'team&action=team_list', {
					token: userInfo.token,
					team_name: app.keyword
				}, function(res) {
					logs(res);
					if (res.errno == 0) {
						var teamList = res.data;
						var createList = new Array();
						var joinList = new Array();
						mui.each(teamList, function(index, item) {
							if (item.type == 2) {
								createList.push(item);
							} else {
								joinList.push(item);
							}
						});
						app.createList = createList;
						app.joinList = joinList;
						if (createList.length > 0) {
							app.createFlag = true;
						} else {
							app.createFlag = false;
						}
						if (joinList.length > 0) {
							app.joinFlag = true;
						} else {
							app.joinFlag = false;
						}
						app.void_seach=false;
					} else {
						if(app.keyword){
							app.createFlag=false;
							app.joinFlag=false;
							app.void_seach=true;
						}else{
							app.void_seach=false;
						}
					}
				}, 'json');
			}
			window.addEventListener('refreshTeamList', function() {
				getTeamList();
			});

			// 课程列表
			function courseList(tid, role) {
				openPage('team_course_list.html', 'team_course_list', '#f7f7f7', {
					tid: tid,
					role: role
				});
			}
			//获取团队名称列表
			var teamchange = true;

			function getPersonTeam() {
				mui.post($ajaxUrl + 'team&action=personal_team_list', {
					token: userInfo.token,
				}, function(res) {
					if (res.errno == 0) {
						var data = res.data;
						if (data.length > 1) {
							team_list = data;
							teamchange = true;
							for (var i = 0; i < data.length; i++) {
								if (data[i].is_default == 1) {
									app.teamName = data[i].name;
									break;
								}
							}
						} else if (data.length == 1 && data != "") {
							team_type = data[0].type;
							app.teamName = data[0].name;
							default_team_id = data[0].team_id;
							mui(".choice-team .mui-icon")[0].style.display = "none";
							teamchange = false;
						} else {
							app.teamName = "旺客"
							mui(".choice-team .mui-icon")[0].style.display = "none";
							teamchange = false;
							default_team_id = 0;
						}
					} else {
						app.teamName = "旺客"
						mui(".choice-team .mui-icon")[0].style.display = "none";
						teamchange = false;
						default_team_id = 0;
					}
				}, 'json');
			}
			//切换团队
			mui('.mui-bar').on('tap', '.choice-team', function() {
				app.clsName = 'mui-icon mui-icon-arrowup'
				if (teamchange) {
					mask.show();
					if (teams) {
						teams.show('slide-in-top');
					} else {
						teams = plus.webview.create('select_team.html', 'select_team', {
							background: "transparent",
							dock: 'top',
							hardwareAccelerated: true,
							height: '40%',
							statusbar: {
								background: '#FFFFFF',
								color: '#000000'
							}
						}, {
							team_list: team_list
						});
						teams.show('slide-in-top');
					}
				}
			})
			window.addEventListener('choiceName', function(e) {
				if (e.detail.names) {
					app.teamName = e.detail.names;
				}
				app.clsName = 'mui-icon mui-icon-arrowdown';
				mask.close();
			})
			// 点击搜索按钮
			mui(".mui-bar").on('tap', ".mui-icon-search", function() {
				app.isSearch = true;
				mui(".search-cont input")[0].focus();
			})
			// 点击取消
			mui(".mui-bar").on('tap', ".cancel-btn", function() {
				app.keyword='';
				getTeamList();
				app.isSearch = false;
				mui(".search-cont input")[0].blur();
			})
			// 点击键盘的搜索
			document.getElementById("search").addEventListener("keypress", function(event) {
				if (event.keyCode == "13" && app.keyword != '') {
					document.activeElement.blur();
					getTeamList();
					event.preventDefault();
				} else {
					message("请输入团队名称！");
					event.preventDefault();
				}
			});
		</script>
	</body>

</html>
