<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>团队列表</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../iconfont/iconfont.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/vip-page.css" />
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			.team-list {
				position: relative;
			}

			.sign-tags {
				position: absolute;
				right: 0;
				top: 0;
				z-index: 9;
				width: 0.75rem;
				height: auto;
			}

			.rank-num {
				font-size: 0.24rem;
				color: #333333;
				display: inline-flex;
				align-items: center;
			}

			.rank-sign {
				width: 0.27rem;
				margin-right: 5px;
			}

			.mui-content.team-list-container {
				padding-bottom: 100px;
			}

			.opction-cont {
				position: relative;
				display: flex;
				justify-content: space-between;
				height: 0.85rem;
				margin-top: 0.1rem;
			}

			.opction-cont:before {
				content: "";
				display: block;
				width: 100%;
				height: 1px;
				background-color: #DDDDDD;
				top: 0;
				left: 0;
				position: absolute;
				-webkit-transform: scaleY(0.5);
				transform: scaleY(0.5);
			}

			.opction-btn {
				height: 100%;
				flex-grow: 1;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				font-size: 0.24rem;
				position: relative;
			}

			.opction-btn:nth-of-type(2):after,
			.opction-btn:last-of-type:after {
				content: "";
				display: inline-block;
				width: 1px;
				height: 40%;
				background-color: #DDDDDD;
				top: 30%;
				left: 0;
				position: absolute;
				-webkit-transform: scaleX(0.5);
				transform: scaleX(0.5);
			}

			.opction-cont img {
				height: 0.29rem;
				margin-right: 0.13rem;
			}

			.inside-top {
				padding: 0.2rem 0.3rem 0;
			}
		</style>
		<script>
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">团队列表</h1>
		</header>

		<div class="mui-content team-list-container" v-cloak>
			<div class="my-team" v-if="createFlag">
				<h2><i></i>数据团队</h2>
				<ul>
					<li class="team-list" v-for="(list, index) in createList" :key="index">
						<!-- <img class="sign-tags" :src="list.data_status==1?'../image/icon/sign-tags-data-y.png':'../image/icon/sign-tags-detail-y.png'"
						 @tap="teamDetail(list.team_id,list.data_status,list.is_captain)"> -->

						<div class="inside">
							<i class="adorn"></i>
							<div class="inside-top">
								<div class="team-title">
									{{list.name}}
									<span class="mui-badge mui-badge-primary">
										<span class="iconfont icon-friends"></span>
										{{list.current_number}} 人
									</span>
								</div>
								<div class="time-person">
									<span class="create-time">创建时间：{{list.create_time}}</span>
									<span class="create-time">创建人：{{list.captain_name.name||list.captain_name.nickName}}</span>
								</div>
							</div>
							<div class="opction-cont">
								<div class="opction-btn" @tap="groupsChat(list.team_id, list.name)">
									<img src="../image/icon/team-list-opction02.png">群聊
								</div>
								<div class="opction-btn" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
									<img src="../image/icon/team-list-opction01.png">数据
								</div>
							</div>
						</div>
					</li>
				</ul>
				<div v-else>
					暂未创建团队
				</div>
			</div>
			<div class="my-join-team" v-if="joinFlag">
				<h2><i></i>正式团队</h2>
				<ul>
					<li class="team-list" v-for="(list, index) in joinList" :key="index">
						<!-- <img class="sign-tags" src="../image/icon/sign-tags-data-b.png" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)"> -->
						<div class="inside">
							<i class="adorn"></i>
							<div class="inside-top">
								<div class="team-title">
									{{list.name}}
									<span class="mui-badge mui-badge-primary">
										<span class="iconfont icon-friends"></span>
										{{list.current_number}} 人
									</span>
								</div>
								<div class="time-person">
									<span  class="rank-num">
										<img class="rank-sign" :src="'../image/icon/rank'+list.level+'.png'">
										<span v-if="list.level==0">佰级别收入</span>
										<span v-if="list.level==1">仟级别收入</span>
										<span v-if="list.level==2">萬级别收入</span>
										<span v-if="list.level==3">拾萬级别收入</span>
										<span v-if="list.level==4">佰萬级别收入</span>
										<span v-if="list.level==5">仟萬级别收入</span>
									</span>
									<span v-if="list.rank>0" class="rank-num">排名：{{list.rank}}</span>
									<span v-else class="rank-num">暂无排名</span>
									<span class="create-person">创建人：{{list.captain_name.name || list.captain_name.nickName}}</span>
								</div>
							</div>
							<div class="opction-cont">
								<div class="opction-btn" @tap="groupsChat(list.team_id, list.name)">
									<img src="../image/icon/team-list-opction02.png">群聊
								</div>
								<div class="opction-btn" @tap="creatCourse(list.team_id,list.is_captain)">
									<img src="../image/icon/team-list-opction03.png">创建培训
								</div>
								<div class="opction-btn" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
									<img src="../image/icon/team-list-opction01.png">数据
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div class="operation-section">
				<span class="create-team">创建团队</span>
				<span class="join-team">加入团队</span>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				beforeback: function() {
					setStatusBar('', 'light');
				}
			});

			var userInfo = getUserInfo();
			var app = new Vue({
				el: '.mui-content',
				data: {
					createList: [],
					joinList: [],
					createFlag: false,
					joinFlag: false,
					teamLists: {},
					userSelf: ""
					// userSelf:userInfo.nickName
				},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						getTeamList();
						mui('.mui-content').on('tap', '.create-team', function() {
							if (userInfo.group_id < 2) {
								message('您没有创建团队的权限!');
								return;
							}
							openPage('create_team.html', 'create_team', '#f7f7f7', '')
						})

						mui('.mui-content').on('tap', '.join-team', function() {
							openPage('join_team.html', 'join_team', '#f7f7f7', '')
						})
					})
				},
				methods: {
					teamDetail: function(team_id, data_status, is_captain) {
						if (data_status == 1 || is_captain == 1) {
							fnOpenWin('webview.html', 'webview', {
								statusbar: {
									background: '#FFFFFF'
								}
							}, {
								tid: team_id,
								title: '团队',
								statusBarStyle: 'dark',
								url: 'https://app.wangkeapp.cn/addons/longbing_card/dist?uniacid=6&id=' + team_id +
									'&m=longbing_card'
							}, 'slide-in-right');
						} else {
							openPage('team_detail.html', 'team_detail', '#f7f7f7', {
								teamid: team_id
							});
						}
					},
					// 群聊
					groupsChat: function(id, name) {
						openPage('team_chat.html', 'team_chat', '#f7f7f7', {
							tid: id,
							teamName: name
						});
					}
				}
			})

			function getTeamList() {
				mui.post($ajaxUrl + 'team&action=team_list', {
					token: userInfo.token
				}, function(res) {
					// logs(res);
					if (res.errno == 0) {
						var teamList = res.data;
						var createList = new Array();
						var joinList = new Array();
						mui.each(teamList, function(index, item) {
							if (item.type == 2) {
								createList.push(item);
							} else {
								joinList.push(item);
							}
							// app.createList = createList;
							// app.joinList = joinList;
						});
						// logs(createList);
						logs(joinList);
						app.createList = createList;
						app.joinList = joinList;
						if (createList.length > 0) {
							app.createFlag = true;
						} else {
							app.createFlag = false;
						}
						if (joinList.length > 0) {
							app.joinFlag = true;
						} else {
							app.joinFlag = false;
						}
					}
				}, 'json');
			}
			window.addEventListener('refreshTeamList', function() {
				getTeamList();
			});
			// 创建课程
			function creatCourse(tid, role) {
				if (role == 1) {
					openPage('create_course.html', 'create_course', '#f7f7f7', {
						tid: tid,
						title: '创建课程'
					});
				} else {
					alert("您不是本团队的创建者，无创建课程权限，请悉知。")
				}
			}
		</script>
	</body>

</html>
