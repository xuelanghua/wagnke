<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>团队列表</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../iconfont/iconfont.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/vip-page.css" />
		<style type="text/css">
			[v-cloak] {
				display: none;
			}

			.team-list {
				position: relative;
			}

			.sign-tags {
				position: absolute;
				right: 0;
				top: 0;
				z-index: 9;
				width: 0.75rem;
				height: auto;
			}

			.rank-num {
				font-size: 0.24rem;
				color: #333333;
				display: inline-flex;
				align-items: center;
			}

			.rank-sign {
				width: 0.27rem;
				margin-right: 5px;
			}
			.mui-content.team-list-container{
				padding-bottom: 100px;
			}
		</style>
		<script>
			// 初始化字体大小
			var viewport = document.documentElement.clientWidth;
			if (viewport > 750) {
				viewport = 750
			}
			document.documentElement.style.fontSize = viewport / 7.5 + "px";
			// 初始化字体大小结束
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<div class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></div>
			<h1 class="mui-title">团队列表</h1>
		</header>

		<div class="mui-content team-list-container" v-cloak>
			<div class="my-team" v-if="createFlag">
				<h2><i></i>数据团队</h2>
				<ul>
					<template v-for="(list, index) in createList" :key="index">
						<li class="team-list" v-if="list.is_captain==1">
							<img class="sign-tags" :src="list.data_status==1?'../image/icon/sign-tags-data-y.png':'../image/icon/sign-tags-detail-y.png'" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
							<div class="inside" @tap="groupsChat(list.team_id, list.name)">
								<i class="adorn"></i>
								<div class="team-title">
									{{list.name}}
									<span class="mui-badge mui-badge-primary">
										<span class="iconfont icon-friends"></span>
										{{list.current_number}} 人
									</span>
								</div>
								<div class="time-person">
									<span class="create-time">创建时间：{{list.create_time}}</span>
									<span class="create-time">创建人：{{list.captain_name.name||list.captain_name.nickName}}</span>
								</div>
							</div>
						</li>
					</template>
				</ul>
				<div v-else>
					暂未创建团队
				</div>
			</div>
			<div class="my-join-team">
				<h2><i></i>正式团队</h2>
				<ul>
					<template v-for="(list, index) in joinList" :key="index">
						<li class="team-list">
							<img class="sign-tags" src="../image/icon/sign-tags-data-b.png" @tap="teamDetail(list.team_id,list.data_status,list.is_captain)">
							<div class="inside" @tap="groupsChat(list.team_id, list.name)">
								<i class="adorn"></i>
								<div class="team-title">
									{{list.name}}
									<span class="mui-badge mui-badge-primary">
										<span class="iconfont icon-friends"></span>
										{{list.current_number}} 人
									</span>
								</div>
								<div class="time-person">
									<span v-if="list.grade"  class="rank-num"><img class="rank-sign" :src="'../image/icon/rank'+list.grade+'.png'">千级别收入</span>
									<span v-if="list.ranking" class="rank-num">排名：{{list.ranking}}</span>
									<span class="create-person">创建人：{{list.captain_name.name || list.captain_name.nickName}}</span>
								</div>
							</div>
						</li>
					</template>
				</ul>
			</div>
			<div class="operation-section">
				<span class="create-team">创建团队</span>
				<span class="join-team">加入团队</span>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/vue.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true,
				beforeback: function() {
					setStatusBar('', 'light');
				}
			});

			var userInfo = getUserInfo();
			var app = new Vue({
				el: '.mui-content',
				data: {
					createList: null,
					joinList: [{
						is_captain: '0',
						name: '明天你好',
						current_number: '200',
						create_time: '2019-06-19',
						captain_name: {
							name: '刘备备',
							nickName: ''
						},
						grade: '1',
						ranking: '200'
					}],
					createFlag: false,
					joinFlag: false,
					teamLists: {},
					userSelf: "刘贝呗"
					// userSelf:userInfo.nickName
				},
				mounted: function() {
					mui.plusReady(function() {
						var self = plus.webview.currentWebview();
						getTeamList();
						mui('.mui-content').on('tap', '.create-team', function() {
							if (userInfo.group_id < 2) {
								message('您没有创建团队的权限!');
								return;
							}
							openPage('create_team.html', 'create_team', '#f7f7f7', '')
						})

						mui('.mui-content').on('tap', '.join-team', function() {
							openPage('join_team.html', 'join_team', '#f7f7f7', '')
						})
					})
				},
				methods: {
					teamDetail: function(team_id,data_status,is_captain) {
						if (data_status == 1 || is_captain == 1) {
							fnOpenWin('webview.html', 'webview', {
								statusbar: {
									background: '#FFFFFF'
								}
							}, {
								tid: team_id,
								title: '团队',
								statusBarStyle: 'dark',
								url: 'https://app.wangkeapp.cn/addons/longbing_card/dist?uniacid=6&id=' + team_id +
									'&m=longbing_card'
							}, 'slide-in-right');
						} else {
							openPage('team_detail.html', 'team_detail', '#f7f7f7', {
								teamid: team_id
							});
						}
					},
					// 群聊
					groupsChat: function(id, name) {
						openPage('team_chat.html','team_chat','#f7f7f7',{
							tid:id,
							teamName: name
						});
					}
				}
			})

			function getTeamList() {
				mui.post($ajaxUrl + 'team&action=team_list', {
					token: userInfo.token
				}, function(res) {
					logs(res);
					if (res.errno == 0) {
						var teamList = res.data;
						var createList = new Array();
						var joinList = new Array();
						mui.each(teamList, function(index, item) {
							if (item.type == 2) {
								createList.push(item);
							} else {
								joinList.push(item);
							}
							// app.createList = createList;
							// app.joinList = joinList;
						})
						app.createList = createList;
						app.joinList = joinList;
						if (createList.length > 0) {
							app.createFlag = true;
						} else {
							app.createFlag = false;
						}
						if (joinList.length > 0) {
							app.joinFlag = true;
						} else {
							app.joinFlag = false;
						}
					}
				}, 'json');
			}
			window.addEventListener('refreshTeamList', function() {
				getTeamList();
			});
		</script>
	</body>

</html>
